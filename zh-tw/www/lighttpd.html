<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>第 3 章 Lighttpd</title><link rel="stylesheet" type="text/css" href="/docbook.css" /><meta name="generator" content="DocBook XSL Stylesheets V1.76.1" /><meta name="keywords" content="lamp,lnmp,famp,fnmp, cgi,fastcgi,wsgi, apache,lighttpd,nginx,tomcat, awstatus, webalizer" /><link rel="home" href="index.html" title="Netkiller Linux Web 手札" /><link rel="up" href="index.html" title="Netkiller Linux Web 手札" /><link rel="prev" href="lamp.error.html" title="4. Error Prompt" /><link rel="next" href="lighttpd.config.html" title="2. /etc/lighttpd/lighttpd.conf" /><script xmlns="" type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-11694057-1']);
  _gaq.push(['_setDomainName', 'netkiller.sourceforge.net']);
  _gaq.push(['_setAllowHash', 'false']);
  _gaq.push(['_setAllowLinker', true]);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">第 3 章 Lighttpd</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="lamp.error.html">上一頁</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="lighttpd.config.html">下一頁</a></td></tr></table><hr /></div><table xmlns="" width="100%" border="0"><tr><td align="left"><a href="http://netkiller.sourceforge.net/">Home</a> |
                <a href="http://netkiller.github.com/">Mirror</a> |
                <a href="/search.html">Search</a></td><td align="right"><form id="searchbox_008589143145807374698:f5uprauilyy" action="/search.html"><input type="hidden" name="cx" value="008589143145807374698:f5uprauilyy" /><input type="hidden" name="cof" value="FORID:11" /><input name="q" type="text" size="25" style="border-top-width: 1px; border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-top-style: solid; border-right-style: solid; border-bottom-style: solid; border-left-style: solid; border-top-color: rgb(126, 157, 185); border-right-color: rgb(126, 157, 185); border-bottom-color: rgb(126, 157, 185); border-left-color: rgb(126, 157, 185); padding-top: 2px; padding-right: 2px; padding-bottom: 2px; padding-left: 2px; background-image: url(http://www.google.com/cse/intl/en/images/google_custom_search_watermark.gif); background-attachment: initial; background-origin: initial; background-clip: initial; background-color: rgb(255, 255, 255); background-position: 0% 50%; background-repeat: no-repeat no-repeat; " /><input type="submit" name="sa" value="Search" /><input name="siteurl" type="hidden" value="http://netkiller.sourceforge.net/" /></form><script type="text/javascript" src="http://www.google.com/coop/cse/brand?form=searchbox_008589143145807374698%3Af5uprauilyy"></script></td></tr></table><div class="chapter" title="第 3 章 Lighttpd"><div class="titlepage"><div><div><h2 class="title"><a id="lighttpd"></a>第 3 章 Lighttpd</h2></div></div></div><div class="toc"><p><strong>目錄</strong></p><dl><dt><span class="section"><a href="lighttpd.html#lighttpd.install">1. 安裝Lighttpd</a></span></dt><dd><dl><dt><span class="section"><a href="lighttpd.html#lighttpd.install.apt-get">1.1. quick install with aptitude</a></span></dt><dt><span class="section"><a href="lighttpd.html#lighttpd.install.yum">1.2. yum install</a></span></dt><dt><span class="section"><a href="lighttpd.html#lighttpd.compile">1.3. to compile and then install lighttpd</a></span></dt><dd><dl><dt><span class="section"><a href="lighttpd.html#idp363568">1.3.1. shell script</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="lighttpd.config.html">2. /etc/lighttpd/lighttpd.conf</a></span></dt><dd><dl><dt><span class="section"><a href="lighttpd.config.html#lighttpd.server.max-fds">2.1. max-worker / max-fds</a></span></dt><dt><span class="section"><a href="lighttpd.config.html#lighttpd.accesslog.filename">2.2. accesslog.filename</a></span></dt><dt><span class="section"><a href="lighttpd.config.html#lighttpd.etags">2.3. ETags</a></span></dt><dt><span class="section"><a href="lighttpd.config.html#lighttpd.server.tag">2.4. server.tag</a></span></dt></dl></dd><dt><span class="section"><a href="lighttpd.module.html">3. Module</a></span></dt><dd><dl><dt><span class="section"><a href="lighttpd.module.html#mod_simple_vhost">3.1. simple_vhost</a></span></dt><dt><span class="section"><a href="lighttpd.module.html#ssl">3.2. ssl</a></span></dt><dt><span class="section"><a href="lighttpd.module.html#redirect">3.3. redirect</a></span></dt><dt><span class="section"><a href="lighttpd.module.html#rewrite">3.4. rewrite</a></span></dt><dd><dl><dt><span class="section"><a href="lighttpd.module.html#lighttpd.rewrite.qsa">3.4.1. Lighttpd Rewrite QSA</a></span></dt></dl></dd><dt><span class="section"><a href="lighttpd.module.html#alias">3.5. alias</a></span></dt><dt><span class="section"><a href="lighttpd.module.html#auth">3.6. auth</a></span></dt><dt><span class="section"><a href="lighttpd.module.html#compress">3.7. compress</a></span></dt><dt><span class="section"><a href="lighttpd.module.html#expire">3.8. expire</a></span></dt><dt><span class="section"><a href="lighttpd.module.html#status">3.9. status</a></span></dt><dt><span class="section"><a href="lighttpd.module.html#setenv">3.10. setenv</a></span></dt><dd><dl><dt><span class="section"><a href="lighttpd.module.html#idp413264">3.10.1. Automatic Decompression</a></span></dt></dl></dd><dt><span class="section"><a href="lighttpd.module.html#lighttpd.fastcgi">3.11. fastcgi</a></span></dt><dd><dl><dt><span class="section"><a href="lighttpd.module.html#idp415152">3.11.1. enable fastcgi</a></span></dt><dd><dl><dt><span class="section"><a href="lighttpd.module.html#lighttpd.fastcgi.spawn-fcgi">3.11.1.1. spawn-fcgi</a></span></dt><dt><span class="section"><a href="lighttpd.module.html#lighttpd.fastcgi.php-fpm">3.11.1.2. php-fpm</a></span></dt></dl></dd><dt><span class="section"><a href="lighttpd.module.html#fastcgi.php">3.11.2. PHP</a></span></dt><dd><dl><dt><span class="section"><a href="lighttpd.module.html#idp421472">3.11.2.1. 編譯安裝PHP</a></span></dt><dt><span class="section"><a href="lighttpd.module.html#idp433696">3.11.2.2. apt-get install</a></span></dt></dl></dd><dt><span class="section"><a href="lighttpd.module.html#fastcgi.python">3.11.3. Python</a></span></dt><dd><dl><dt><span class="section"><a href="lighttpd.module.html#django">3.11.3.1. Django</a></span></dt><dt><span class="section"><a href="lighttpd.module.html#idp443376">3.11.3.2. Python Imaging Library</a></span></dt></dl></dd><dt><span class="section"><a href="lighttpd.module.html#fastcgi.perl">3.11.4. Perl</a></span></dt><dd><dl><dt><span class="section"><a href="lighttpd.module.html#idp455808">3.11.4.1. Installing lighttpd and FastCGI for Catalyst</a></span></dt></dl></dd><dt><span class="section"><a href="lighttpd.module.html#fastcgi.ruby">3.11.5. Ruby</a></span></dt></dl></dd><dt><span class="section"><a href="lighttpd.module.html#user-agent">3.12. user-agent</a></span></dt></dl></dd><dt><span class="section"><a href="lighttpd.other.html">4. 其他模組</a></span></dt><dd><dl><dt><span class="section"><a href="lighttpd.other.html#mod_secdownload">4.1. mod_secdownload 防盜鏈</a></span></dt></dl></dd><dt><span class="section"><a href="lighttpd.example.html">5. Example</a></span></dt><dd><dl><dt><span class="section"><a href="lighttpd.example.html#idp467776">5.1. s-maxage</a></span></dt></dl></dd></dl></div><div class="section" title="1. 安裝Lighttpd"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="lighttpd.install"></a>1. 安裝Lighttpd</h2></div></div></div><div class="section" title="1.1. quick install with aptitude"><div class="titlepage"><div><div><h3 class="title"><a id="lighttpd.install.apt-get"></a>1.1. quick install with aptitude</h3></div></div></div><p>if you OS is Ubuntu/Debian </p><span class="command"><strong>apt-get install lighttpd</strong></span><pre class="screen">
netkiller@shenzhen:~$ sudo apt-get install lighttpd
		</pre><p>the config file in /etc/lighttpd</p><pre class="screen">
netkiller@shenzhen:~/document/Docbook/Linux$ find /etc/lighttpd/
/etc/lighttpd/
/etc/lighttpd/lighttpd.conf
/etc/lighttpd/conf-enabled
/etc/lighttpd/conf-available
/etc/lighttpd/conf-available/10-userdir.conf
/etc/lighttpd/conf-available/10-fastcgi.conf
/etc/lighttpd/conf-available/10-cgi.conf
/etc/lighttpd/conf-available/README
/etc/lighttpd/conf-available/10-ssl.conf
/etc/lighttpd/conf-available/10-proxy.conf
/etc/lighttpd/conf-available/10-auth.conf
/etc/lighttpd/conf-available/10-simple-vhost.conf
/etc/lighttpd/conf-available/10-ssi.conf
		</pre><p>Enabling and disabling modules could be done by provided e.g.</p><pre class="screen">
/usr/sbin/lighty-enable-mod fastcgi
/usr/sbin/lighty-disable-mod fastcgi
		</pre><p>when you enabled a mod please force-reload it</p><pre class="screen">
netkiller@shenzhen:/etc/lighttpd$ sudo lighty-enable-mod fastcgi
Available modules: auth cgi fastcgi proxy simple-vhost ssi ssl userdir
Already enabled modules: userdir
Enabling fastcgi: ok
Run /etc/init.d/lighttpd force-reload to enable changes
netkiller@shenzhen:/etc/lighttpd$ sudo /etc/init.d/lighttpd force-reload
 * Stopping web server lighttpd                                                                                                                                                                                                                                                                                       [ OK ]
 * Starting web server lighttpd
		</pre></div><div class="section" title="1.2. yum install"><div class="titlepage"><div><div><h3 class="title"><a id="lighttpd.install.yum"></a>1.2. yum install</h3></div></div></div><pre class="screen">
# yum install lighttpd lighttpd-fastcgi -y
# chkconfig lighttpd on
		</pre><p>創建緩存目錄</p><pre class="screen">
# mkdir -p /var/cache/lighttpd/compress
# chown lighttpd:lighttpd -R /var/cache/lighttpd
		</pre><p>禁用ipv6</p><pre class="screen">
# vim /etc/lighttpd/lighttpd.conf

#server.use-ipv6 = "enable"
		</pre></div><div class="section" title="1.3. to compile and then install lighttpd"><div class="titlepage"><div><div><h3 class="title"><a id="lighttpd.compile"></a>1.3. to compile and then install lighttpd</h3></div></div></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>下載相關軟件</p><p><a class="ulink" href="http://www.lighttpd.net/download/lighttpd-1.4.15.tar.gz" target="_top">立即下載</a></p><pre class="screen">
$ sudo apt-get install libpcre3*

cd /usr/local/src/
wget http://www.lighttpd.net/download/lighttpd-1.4.15.tar.gz
tar zxvf lighttpd-1.4.15.tar.gz
cd lighttpd-1.4.15
				</pre></li><li class="listitem"><p>編譯安裝</p><pre class="screen">
./configure --prefix=/usr/local/lighttpd-1.4.15 \
--with-bzip2 \
--with-memcache
make
make install
				</pre></li><li class="listitem"><p>創建目錄與配置檔案</p><pre class="screen">
ln -s /usr/local/lighttpd-1.4.15/ /usr/local/lighttpd
mkdir -p /www/pages
mkdir /www/logs
mkdir /usr/local/lighttpd/htdocs
mkdir /usr/local/lighttpd/logs
mkdir /usr/local/lighttpd/etc
cp ./doc/lighttpd.conf /usr/local/lighttpd/etc/
cd /usr/local/lighttpd/
				</pre></li><li class="listitem"><p>配置lighttpd.conf</p><span class="command"><strong>vi etc/lighttpd.conf</strong></span><p>找到 server.modules</p><p>刪除 mod_fastcgi 前的註釋</p><p>跟據你的需求修改下面定義</p><p>server.document-root = "/usr/local/lighttpd/htdocs/"</p><p>server.errorlog  = "/usr/local/lighttpd/logs/lighttpd.error.log"</p><p>accesslog.filename = "/usr/local/lighttpd/logs/access.log"</p><p>註釋 $HTTP["url"]</p><pre class="screen">
#$HTTP["url"] =~ "\.pdf$" {
#  server.range-requests = "disable"
#}
				</pre></li><li class="listitem"><p>運行lighttpd</p><pre class="screen">
/usr/local/lighttpd/sbin/lighttpd -f /usr/local/lighttpd/etc/lighttpd.conf
				</pre><p>測試</p><p>curl http://ip/ 因為/www/pages/下沒有HTML頁面所以返回:</p><p>404 - Not Found</p></li></ol></div><div class="section" title="1.3.1. shell script"><div class="titlepage"><div><div><h4 class="title"><a id="idp363568"></a>1.3.1. shell script</h4></div></div></div><p>lighttpd script</p><div class="example"><a id="idp364240"></a><p class="title"><strong>例 3.1. /etc/init.d/lighttpd</strong></p><div class="example-contents"><pre class="screen">
					
#!/bin/bash
# lighttpd init file for web server
#
# chkconfig: - 100 100
# description: Security, speed, compliance, and flexibility--all of these describe LightTPD which is rapidly redefining efficiency of a webserver;
#				as it is designed and optimized for high performance environments.
# author: Neo Chen&lt;openunix@163.com&gt;
#
# processname: $PROG
# config:
# pidfile: /var/run/lighttpd

# source function library
. /etc/init.d/functions

PREFIX=/usr/local/lighttpd
PROG=$PREFIX/sbin/lighttpd
OPTIONS="-f /usr/local/lighttpd/etc/lighttpd.conf"
USER=daemon
RETVAL=0
prog="lighttpd"

start() {
        echo -n $"Starting $prog: "
        if [ $UID -ne 0 ]; then
                RETVAL=1
                failure
        else
                daemon --user=$USER $PROG $OPTIONS
                RETVAL=$?
                [ $RETVAL -eq 0 ] &amp;&amp; touch /var/lock/subsys/lighttpd
        fi;
        echo
        return $RETVAL
}

stop() {
        echo -n $"Stopping $prog: "
        if [ $UID -ne 0 ]; then
                RETVAL=1
                failure
        else
                killproc $PROG
                RETVAL=$?
                [ $RETVAL -eq 0 ] &amp;&amp; rm -f /var/lock/subsys/lighttpd
        fi;
        echo
        return $RETVAL
}

reload(){
        echo -n $"Reloading $prog: "
        killproc $PROG -HUP
        RETVAL=$?
        echo
        return $RETVAL
}

restart(){
	stop
	start
}

condrestart(){
    [ -e /var/lock/subsys/lighttpd ] &amp;&amp; restart
    return 0
}

case "$1" in
  start)
	start
	;;
  stop)
	stop
	;;
  restart)
	restart
        ;;
  reload)
	reload
        ;;
  condrestart)
	condrestart
	;;
  status)
        status lighttpd
	RETVAL=$?
        ;;
  *)
	echo $"Usage: $0 {start|stop|status|restart|condrestart|reload}"
	RETVAL=1
esac

exit $RETVAL
					
					</pre></div></div><br class="example-break" /></div></div></div></div><div xmlns="" id="disqus_thread"></div><script xmlns="" type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */

            if(document.domain == 'netkiller.github.com'){
            var disqus_shortname = 'netkiller'; // required: replace example with your forum shortname
            }else{
			var disqus_shortname = 'neochan';
            }

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script><noscript xmlns="">Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript><a xmlns="" href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="lamp.error.html">上一頁</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="lighttpd.config.html">下一頁</a></td></tr><tr><td width="40%" align="left" valign="top">4. Error Prompt </td><td width="20%" align="center"><a accesskey="h" href="index.html">起始頁</a></td><td width="40%" align="right" valign="top"> 2. /etc/lighttpd/lighttpd.conf</td></tr></table></div></body></html>
