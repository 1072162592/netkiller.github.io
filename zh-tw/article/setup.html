<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>CentOS 6.4 + nginx-1.2.5 + php-5.4.15 + MySQL-5.5.31</title><link rel="stylesheet" type="text/css" href="article.css" /><meta name="generator" content="DocBook XSL Stylesheets V1.76.1" /><meta name="description" content="在工作中，需要經常為新系統安裝軟件，重複而簡單，但又不得不作，我將過去幾年中工作中臨時寫的腳本這裡了一下，能夠實現半自動化安裝標本，只需要Ctrl+C, Ctrl+V 快速粘貼複製，即可快速完成安裝" /><meta name="keywords" content="linux, apache, lighttpd, nginx, php, ,  " /><script xmlns="" type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-11694057-1']);
  _gaq.push(['_setDomainName', 'netkiller.sourceforge.net']);
  _gaq.push(['_setAllowHash', 'false']);
  _gaq.push(['_setAllowLinker', true]);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script></head><body><table xmlns="" width="100%" border="0"><tr><td align="left"><a href="http://netkiller.github.io/">Home</a> |
        <a href="http://netkiller.sourceforge.net/">Mirror</a> |
        <a href="/search.html">Search</a> |
        <a href="http://netkiller-github-com.iteye.com/">ITEYE 博客</a> |
        <a href="http://my.oschina.net/neochen/">OSChina 博客</a> |
        <a href="http://rline.blog.51cto.com/">51CTO 博客</a></td><td><div id="bdshare" class="bdshare_t bds_tools_32 get-codes-bdshare"><a class="bds_fbook"></a><a class="bds_twi"></a><a class="bds_ms"></a><a class="bds_msn"></a><a class="bds_buzz"></a><a class="bds_linkedin"></a><a class="bds_deli"></a><a class="bds_qzone"></a><a class="bds_qq"></a><a class="bds_tqq"></a><a class="bds_tqf"></a><a class="bds_tsina"></a><a class="bds_baidu"></a><a class="bds_renren"></a><a class="bds_t163"></a><a class="bds_tfh"></a><a class="bds_douban"></a><a class="bds_hi"></a><a class="bds_tieba"></a><a class="bds_tsohu"></a><a class="bds_kaixin001"></a><span class="bds_more"></span><a class="shareCount"></a></div><script type="text/javascript" id="bdshare_js" data="type=tools"></script><script type="text/javascript" id="bdshell_js"></script><script type="text/javascript">
	document.getElementById("bdshell_js").src = "http://bdimg.share.baidu.com/static/js/shell_v2.js?cdnversion=" + new Date().getHours();
</script></td><td></td></tr></table><div xml:lang="zh-cn" class="article" title="CentOS 6.4 + nginx-1.2.5 + php-5.4.15 + MySQL-5.5.31" lang="zh-cn"><div class="titlepage"><div><div><h2 class="title"><a id="idp800"></a>CentOS 6.4 + nginx-1.2.5 + php-5.4.15 + MySQL-5.5.31</h2></div><div><h3 class="subtitle"><em>redis-2.4.10</em></h3></div><div><div class="author"><h3 class="author"><span class="honorific">Mr</span>. <span class="firstname">Neo Chen</span> <span class="surname">(netkiller)</span>, <span class="lineage">陳景峰(BG7NYT)</span></h3><div class="affiliation"><div class="address"><p><br />
				<span class="country">中國</span><span class="state">廣東省</span><span class="city">深圳市</span><span class="street">龍華新區民治街道溪山美地</span><br />
				<span class="postcode">518131</span><br />
				<span class="phone">+86 13113668890</span><br />
				<span class="fax">+86 755 29812080</span><br />
				<code class="email">&lt;<a class="email" href="mailto:netkiller@msn.com">netkiller@msn.com</a>&gt;</code><br />
			</p></div></div></div></div><div><p class="copyright">版權 © 2011, 2012, 2013 http://netkiller.github.com</p></div><div><p class="pubdate">$Date: 2013-05-31 19:25:25 +0800 (Fri, 31 May 2013) $</p></div><div><div class="abstract" title="摘要"><p class="title"><strong>摘要</strong></p>
			<p>在工作中，需要經常為新系統安裝軟件，重複而簡單，但又不得不作，我將過去幾年中工作中臨時寫的腳本這裡了一下，能夠實現半自動化安裝標本，只需要Ctrl+C, Ctrl+V 快速粘貼複製，即可快速完成安裝</p>
		</div></div><div><div class="abstract" title="我的系列文檔"><a id="abstract"></a><p class="title"><strong>我的系列文檔</strong></p><p>
		</p><table border="0" summary="Simple list" class="simplelist"><tr><td>
				<a class="ulink" href="../architect/index.html" target="_top">Netkiller Architect 手札</a>
			</td><td>
				<a class="ulink" href="../developer/index.html" target="_top">Netkiller Developer 手札</a>
			</td><td>
				<a class="ulink" href="../testing/index.html" target="_top">Netkiller Testing 手札</a>
			</td><td>
				<a class="ulink" href="../cryptography/index.html" target="_top">Netkiller Cryptography 手札</a>
			</td><td>
				<a class="ulink" href="../version/index.html" target="_top">Netkiller Version 手札</a>
			</td></tr><tr><td>
				<a class="ulink" href="../linux/index.html" target="_top">Netkiller Linux 手札</a>
			</td><td>
				<a class="ulink" href="../debian/index.html" target="_top">Netkiller Debian 手札</a>
			</td><td>
				<a class="ulink" href="../centos/index.html" target="_top">Netkiller CentOS 手札</a>
			</td><td>
				<a class="ulink" href="../freebsd/index.html" target="_top">Netkiller FreeBSD 手札</a>
			</td><td>
				<a class="ulink" href="../security/index.html" target="_top">Netkiller Security 手札</a>
			</td></tr><tr><td>
				<a class="ulink" href="../www/index.html" target="_top">Netkiller Web 手札</a>
			</td><td>
				<a class="ulink" href="../monitoring/index.html" target="_top">Netkiller Monitoring 手札</a>
			</td><td>
				<a class="ulink" href="../storage/index.html" target="_top">Netkiller Storage 手札</a>
			</td><td>
				<a class="ulink" href="../mail/index.html" target="_top">Netkiller Mail 手札</a>
			</td><td>
				<a class="ulink" href="../shell/index.html" target="_top">Netkiller Shell 手札</a>
			</td></tr><tr><td>
				<a class="ulink" href="../database/index.html" target="_top">Netkiller Database 手札</a>
			</td><td>
				<a class="ulink" href="../postgresql/index.html" target="_top">Netkiller PostgreSQL 手札</a>
			</td><td>
				<a class="ulink" href="../mysql/index.html" target="_top">Netkiller MySQL 手札</a>
			</td><td>
				<a class="ulink" href="../nosql/index.html" target="_top">Netkiller NoSQL 手札</a>
			</td><td>
				<a class="ulink" href="../ldap/index.html" target="_top">Netkiller LDAP 手札</a>
			</td></tr><tr><td>
				<a class="ulink" href="../network/index.html" target="_top">Netkiller Network 手札</a>
			</td><td>
				<a class="ulink" href="../cisco/index.html" target="_top">Netkiller Cisco IOS 手札</a>
			</td><td>
				<a class="ulink" href="../multimedia/index.html" target="_top">Netkiller Multimedia 手札</a>
			</td><td>
				<a class="ulink" href="../docbook/index.html" target="_top">Netkiller Docbook 手札</a>
			</td><td>
				<a class="ulink" href="../oss/index.html" target="_top">Netkiller 開源軟件 手札</a>
			</td></tr></table><p>
	</p></div></div></div><hr /></div><div class="toc"><p><strong>目錄</strong></p><dl><dt><span class="section"><a href="#idp11136">1. CentOS 6.3 64bit Minior 安裝後 新機初始化常用軟件包安裝</a></span></dt><dd><dl><dt><span class="section"><a href="#idp61344">1.1. /etc/resolv.conf</a></span></dt><dt><span class="section"><a href="#idp63600">1.2. /etc/security/limits.conf</a></span></dt><dt><span class="section"><a href="#idp67664">1.3. /etc/sysctl.conf</a></span></dt><dt><span class="section"><a href="#idp70096">1.4. history 格式設置</a></span></dt><dt><span class="section"><a href="#idp72144">1.5. /etc/fstab</a></span></dt></dl></dd><dt><span class="section"><a href="#idp76720">2. 常用網絡軟件服務安裝</a></span></dt><dd><dl><dt><span class="section"><a href="#idp77536">2.1. ntp</a></span></dt><dt><span class="section"><a href="#idp81280">2.2. net-snmp</a></span></dt><dt><span class="section"><a href="#idp83328">2.3. nagios</a></span></dt><dt><span class="section"><a href="#idp85616">2.4. rsync</a></span></dt><dt><span class="section"><a href="#idp88048">2.5. vsftpd</a></span></dt></dl></dd><dt><span class="section"><a href="#idp90192">3. MySQL-5.5.31</a></span></dt><dt><span class="section"><a href="#idp93232">4. php-5.4.15</a></span></dt><dd><dl><dt><span class="section"><a href="#idp102096">4.1. 配置php.ini</a></span></dt><dt><span class="section"><a href="#idp107824">4.2. 配置 php-fpm</a></span></dt><dt><span class="section"><a href="#idp112832">4.3. 將php加入PATH環境變數</a></span></dt><dt><span class="section"><a href="#idp114592">4.4. PHP　Extension - APC</a></span></dt><dt><span class="section"><a href="#idp117952">4.5. phpredis</a></span></dt><dt><span class="section"><a href="#idp118208">4.6. mongo</a></span></dt><dt><span class="section"><a href="#idp128912">4.7. 編譯中遇到問題如何處理？</a></span></dt></dl></dd><dt><span class="section"><a href="#idp93488">5. nginx-1.2.5</a></span></dt><dd><dl><dt><span class="section"><a href="#idp141232">5.1. /etc/nginx/nginx.conf</a></span></dt><dt><span class="section"><a href="#idp143488">5.2. host 配置</a></span></dt></dl></dd><dt><span class="section"><a href="#idp135072">6. redis-2.4.10</a></span></dt><dt><span class="section"><a href="#idp153984">7. MongoDB</a></span></dt></dl></div>
	
	<div class="section" title="1. CentOS 6.3 64bit Minior 安裝後 新機初始化常用軟件包安裝"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="idp11136"></a>1. CentOS 6.3 64bit Minior 安裝後 新機初始化常用軟件包安裝</h2></div></div></div>
		
		<pre class="screen">
		
lokkit --disabled --selinux=disabled

yum update -y
rpm --import http://apt.sw.be/RPM-GPG-KEY.dag.txt
rpm -K http://packages.sw.be/rpmforge-release/rpmforge-release-0.5.2-2.el6.rf.x86_64.rpm
rpm -i http://packages.sw.be/rpmforge-release/rpmforge-release-0.5.2-2.el6.rf.x86_64.rpm

yum install -y telnet wget rsync
yum install -y system-config-network-tui
yum install -y bind-utils
yum install -y vim-enhanced

yum install -y openssh-clients
yum remove dhclient -y
		
		</pre>
		<div class="section" title="1.1. /etc/resolv.conf"><div class="titlepage"><div><div><h3 class="title"><a id="idp61344"></a>1.1. /etc/resolv.conf</h3></div></div></div>
			
			<p>配置DNS</p>
			<pre class="screen">
			
echo -ne "
search example.com
nameserver 208.67.222.222
nameserver 202.67.220.220
nameserver 8.8.8.8
nameserver 4.4.4.4
" &gt; /etc/resolv.conf
			
			</pre>
		</div>
		<div class="section" title="1.2. /etc/security/limits.conf"><div class="titlepage"><div><div><h3 class="title"><a id="idp63600"></a>1.2. /etc/security/limits.conf</h3></div></div></div>
			
			<p>修改檔案打開數</p>
			<pre class="screen">
			
cat &gt;&gt; /etc/security/limits.conf &lt;&lt;EOF
root 	soft nofile 65536
root 	hard nofile 65536
www	soft nofile 65536
www 	hard nofile 65536
mysql	soft nofile 65536
mysql 	hard nofile 65536
EOF
			
			</pre>
			<p>下面更省事，但不建議使用*通配符，這樣任何用戶都不限制。</p>
			<pre class="screen">
			
echo -ne "

* soft nofile 65536
* hard nofile 65536
" &gt;&gt; /etc/security/limits.conf
			
			</pre>
			<p>而上面我市針對www用戶設置，也就是web伺服器，其他用戶是受限的。</p>
		</div>
		<div class="section" title="1.3. /etc/sysctl.conf"><div class="titlepage"><div><div><h3 class="title"><a id="idp67664"></a>1.3. /etc/sysctl.conf</h3></div></div></div>
			
			<p>內核參數調整</p>
			<pre class="screen">
			
cat &gt;&gt; /etc/sysctl.conf &lt;&lt;EOF

net.ipv4.ip_local_port_range = 1024 65500
net.ipv4.tcp_syncookies = 1
net.ipv4.tcp_tw_reuse = 1
net.ipv4.tcp_tw_recycle = 1
net.ipv4.tcp_fin_timeout = 60
net.ipv4.tcp_keepalive_time = 1200
net.ipv4.tcp_max_syn_backlog = 8192
net.ipv4.tcp_max_tw_buckets = 4096
EOF
			
			</pre>
		</div>
		<div class="section" title="1.4. history 格式設置"><div class="titlepage"><div><div><h3 class="title"><a id="idp70096"></a>1.4. history 格式設置</h3></div></div></div>
			
			<p>設置history格式，是他能夠記錄命令的輸入時間</p>
			<pre class="screen">
			
cat &gt;&gt; /etc/bashrc &lt;&lt;EOF

export HISTTIMEFORMAT="%Y-%m-%d-%H:%M:%S "
EOF
			
			</pre>
		</div>
		<div class="section" title="1.5. /etc/fstab"><div class="titlepage"><div><div><h3 class="title"><a id="idp72144"></a>1.5. /etc/fstab</h3></div></div></div>
			
			<p>我一般分區規劃是，/系統根分區,swap交換分區,/www數據分區，同時 禁止寫入atime時間,因為/www頻繁請求會影響IO </p>
			<p>臨時mount</p>
			<pre class="screen">
mount -o remount,noatime,nodiratime /dev/sda3 /mnt/your
			</pre>
			<p>LABEL 方式</p>
			<pre class="screen">
LABEL=/www                 /www                       ext3    defaults,noatime,nodiratime        1 1
			</pre>
			<p>UUID 方式</p>
			<pre class="screen">
UUID=eeff3e86-7964-4a48-ac02-51ea167ea6b2 /www        ext4    defaults,noatime,nodiratime        1 2
			</pre>
			<p>至此，Linux 的OS部分安裝配置與優化完成。</p>
		</div>

	</div>
	<div class="section" title="2. 常用網絡軟件服務安裝"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="idp76720"></a>2. 常用網絡軟件服務安裝</h2></div></div></div>
		

		<div class="section" title="2.1. ntp"><div class="titlepage"><div><div><h3 class="title"><a id="idp77536"></a>2.1. ntp</h3></div></div></div>
			
			<p>ntp 服務同步伺服器的時間，需要安裝。</p>
			<pre class="screen">
# redhat 5.6 cp /etc/ntp.conf.original /etc/ntp.conf
yum install ntp -y
			</pre>
			<p>指定ntp伺服器，如果你沒有ntp server,下面步驟不用執行</p>
			<pre class="screen">
			
cp /etc/ntp.conf /etc/ntp.conf.original
vim /etc/ntp.conf &lt;&lt;VIM &gt; /dev/null 2&gt;&amp;1
:22,24s/^/#/
:25,25s/^/\rserver 172.16.3.51\rserver 172.16.3.52\r/
:wq
VIM
			
			</pre>
			<pre class="screen">
service ntpd start
chkconfig ntpd on
			</pre>
		</div>

		<div class="section" title="2.2. net-snmp"><div class="titlepage"><div><div><h3 class="title"><a id="idp81280"></a>2.2. net-snmp</h3></div></div></div>
			
			<p>用於伺服器的狀態監控</p>
			<pre class="screen">
			
yum install net-snmp -y
vi /etc/snmp/snmpd.conf &lt;&lt;VIM &gt; /dev/null 2&gt;&amp;1
:62,62s/systemview/all/
:85,85s/^#//
:wq
VIM
service snmpd start
chkconfig snmpd on
			
			</pre>
		</div>
		<div class="section" title="2.3. nagios"><div class="titlepage"><div><div><h3 class="title"><a id="idp83328"></a>2.3. nagios</h3></div></div></div>
			
			<p>伺服器故障警告</p>
			<pre class="screen">
			
yum install -y nrpe nagios-plugins
vi /etc/nagios/nrpe.cfg &lt;&lt;VIM &gt; /dev/null 2&gt;&amp;1
:%s/allowed_hosts=127.0.0.1/allowed_hosts=172.16.1.2/
:wq
VIM

cat &gt;&gt; /etc/nagios/nrpe.cfg &lt;&lt;EOF

#command[check_http]=/usr/lib64/nagios/plugins/check_http -I 127.0.0.1 -p 80 -u http://www.example.com/index.html
command[check_swap]=/usr/lib64/nagios/plugins/check_swap -w 20% -c 10%
command[check_all_disks]=/usr/lib64/nagios/plugins/check_disk -w 20% -c 10% -e
EOF

chkconfig nrpe on
service nrpe start
			
			</pre>
		</div>

		<div class="section" title="2.4. rsync"><div class="titlepage"><div><div><h3 class="title"><a id="idp85616"></a>2.4. rsync</h3></div></div></div>
			
			<p>我使用rsync來實現應用的部署。</p>
			<pre class="screen">
			
yum install xinetd rsync -y

vim /etc/xinetd.d/rsync &lt;&lt;VIM &gt; /dev/null 2&gt;&amp;1
:%s/yes/no/
:wq
VIM

cat &gt; /etc/rsyncd.conf &lt;&lt;EOD
uid = root
gid = root
use chroot = no
max connections = 8
pid file = /var/run/rsyncd.pid
lock file = /var/run/rsync.lock
log file = /var/log/rsyncd.log

hosts deny=*
hosts allow=192.168.2.0/255.255.255.0

[www]
    uid = www
    gid = www
    path = /www
    ignore errors
    read only = no
    list = no
    auth users = www
    secrets file = /etc/rsyncd.passwd
EOD

cat &gt;&gt; /etc/rsyncd.passwd &lt;&lt;EOF
www:xxxxxxxxxxxxxxxx
EOF

chmod 600 /etc/rsyncd.*
chmod 600 /etc/rsyncd.passwd

service xinetd restart
			
			</pre>
		</div>

		<div class="section" title="2.5. vsftpd"><div class="titlepage"><div><div><h3 class="title"><a id="idp88048"></a>2.5. vsftpd</h3></div></div></div>
			
			<p>根據你的需要，選裝。</p>
			<pre class="screen">
			
yum install -y vsftpd
adduser --home-dir /www/target/logs/ --shell /sbin/nologin --password logs.xiu.com logs
echo logs &gt;&gt; /etc/vsftpd/chroot_list

vim /etc/vsftpd/vsftpd.conf &lt;&lt;VIM &gt; /dev/null 2&gt;&amp;1
:%s/#chroot_list_enable=YES/chroot_list_enable=YES/
:%s/#chroot_list_file/chroot_list_file/
VIM

chkconfig vsftpd on
service vsftpd start
			
			</pre>
		</div>

	</div>
	<div class="section" title="3. MySQL-5.5.31"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="idp90192"></a>3. MySQL-5.5.31</h2></div></div></div>
		
		<p>卸載舊的包，然後準備好rpm檔案</p>
		<pre class="screen">
rpm -e --nodeps mysql-libs
yum localinstall MySQL-*
		</pre>
		<p>安裝後查看如下</p>
		<pre class="screen">
# rpm -qa | grep MySQL
MySQL-client-5.5.31-1.el6.x86_64
MySQL-shared-5.5.31-1.el6.x86_64
MySQL-devel-5.5.31-1.el6.x86_64
MySQL-shared-compat-5.5.31-1.el6.x86_64
MySQL-server-5.5.31-1.el6.x86_64
		</pre>
	</div>
	<div class="section" title="4. php-5.4.15"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="idp93232"></a>4. php-5.4.15</h2></div></div></div>
		
		<p>由於redhat與centosYUM源中尚未提供php-fpm所以我採用編譯安裝，網上有一些愛好者製作過php-fpm的rpm包。是否使用你自己那注意。</p>
		<p>安裝fedora的YUM源，我們需要一些devel包。</p>
		<pre class="screen">
rpm -Uvh http://dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-7.noarch.rpm
		</pre>
		<p>安裝編譯器與開發包</p>
		<pre class="screen">
yum install gcc gcc-c++ make automake autoconf -y
yum install curl-devel libmcrypt-devel gd-devel libjpeg-devel libpng-devel libXpm-devel libxml2-devel libxslt-devel mhash-devel recode-devel openssl-devel -y
		</pre>
		<p>安裝下面三個rpm包，編譯php不需要server與client兩個包</p>
		<pre class="screen">
MySQL-shared-5.5.31-1.el6.x86_64
MySQL-devel-5.5.31-1.el6.x86_64
MySQL-shared-compat-5.5.31-1.el6.x86_64
		</pre>
		<p>將其放置在一個目錄中，使用下面命令即可安裝</p>
		<pre class="screen">
yum localinstall MySQL-*
		</pre>
		<p>前面的準備工作就緒後，便可以進入到php的安裝階段</p>
		<pre class="screen">
		
tar zxvf php-5.4.15.tar.gz
cd php-5.4.15

./configure --prefix=/srv/php-5.4.15 \
--with-config-file-path=/srv/php-5.4.15/etc \
--with-config-file-scan-dir=/srv/php-5.4.15/etc/conf.d \
--enable-fpm \
--with-fpm-user=www \
--with-fpm-group=www \
--with-curl \
--with-gd \
--with-jpeg-dir \
--with-png-dir \
--with-freetype-dir \
--with-zlib-dir \
--with-iconv \
--with-mcrypt \
--with-mysql \
--with-mysqli=/usr/bin/mysql_config \
--with-pdo-mysql \
--with-mysql-sock=/var/lib/mysql/mysql.sock \
--with-openssl=shared \
--with-mhash=shared \
--with-xsl=shared \
--with-recode=shared \
--with-pear \
--enable-sockets \
--enable-soap \
--enable-mbstring \
--enable-gd-native-ttf \
--enable-zip \
--enable-xml \
--enable-bcmath \
--enable-calendar \
--enable-shmop \
--enable-dba \
--enable-wddx \
--disable-debug


make &amp;&amp; make install
		
		</pre>

		<div class="section" title="4.1. 配置php.ini"><div class="titlepage"><div><div><h3 class="title"><a id="idp102096"></a>4.1. 配置php.ini</h3></div></div></div>
			

			<p>備份配置檔案，防止不小心改錯而又找不出問題出在哪裡。</p>
			<pre class="screen">
mkdir -p /srv/php-5.4.15/etc/conf.d
cp php.ini-* /srv/php-5.4.15/etc/
cp /srv/php-5.4.15/etc/php.ini-development /srv/php-5.4.15/etc/php.ini
cp /srv/php-5.4.15/etc/pear.conf{,.original}
ln -s /srv/php-5.4.15/ /srv/php
			</pre>
			<p>php預設提供兩個配置檔案模板php.ini-development用於開發和測試環境；php.ini-production用於生產環境。他們差異是php.ini-development會顯示調試信息，即 error_display = On. </p>
			<pre class="screen">
# ls php.ini-*
php.ini-development  php.ini-production
			</pre>
			<p>下面更改僅供參考，需要根據你的具體情況配置，不要照搬。</p>
			<pre class="screen">
			
vim /srv/php-5.4.15/etc/php.ini &lt;&lt;EOF &gt; /dev/null 2&gt;&amp;1
:%s#expose_php = On#expose_php = Off#
:%s$;open_basedir = $open_basedir = /www/:/tmp/:/srv/php-5.4.15/lib/php/:/srv/php-5.4.15/bin/$
:%s/memory_limit = 128M/memory_limit = 16M/
:%s!;include_path = ".:/php/includes"!include_path = ".:/srv/php-5.4.15/lib/php:/srv/php-5.4.15/share"!
:%s:extension_dir = "./":extension_dir = "/srv/php-5.4.15/lib/php/extensions":
:%s/upload_max_filesize = 2M/upload_max_filesize = 8M/
:%s/;cgi.fix_pathinfo=0/cgi.fix_pathinfo=1/
:%s$;date.timezone =$date.timezone = Asia/Hong_Kong$
:1367,1367s/session.save_handler = files/session.save_handler = redis/
:1368,1368s#^#session.save_path = "tcp://127.0.0.1:6379"\r#
:1415,1368s/session.name = PHPSESSID/session.name = JSESSIONID/
:wq
EOF
			
			</pre>
		</div>
		<div class="section" title="4.2. 配置 php-fpm"><div class="titlepage"><div><div><h3 class="title"><a id="idp107824"></a>4.2. 配置 php-fpm</h3></div></div></div>
			
			<p>安裝啟動腳本</p>
			<pre class="screen">
cp ./sapi/fpm/init.d.php-fpm /etc/init.d/php-fpm
chmod +x /etc/init.d/php-fpm

chkconfig --add php-fpm
chkconfig php-fpm on
chkconfig --list php-fpm
			</pre>
			<p>修改配置檔案</p>
			<pre class="screen">
			
cp /srv/php-5.4.15/etc/php-fpm.conf.default /srv/php-5.4.15/etc/php-fpm.conf

vim /srv/php-5.4.15/etc/php-fpm.conf &lt;&lt;end &gt; /dev/null 2&gt;&amp;1
:25,25s/;//
:32,32s/;//
:wq
end
			
			</pre>
			<p>察看配置項</p>
			<pre class="screen">
# grep -v '^;' /srv/php-5.4.15/etc/php-fpm.conf | grep -v '^$'
[global]
pid = run/php-fpm.pid


[www]
user = www
group = www
listen = 127.0.0.1:9000

pm = dynamic
pm.max_children = 5
pm.start_servers = 2
pm.min_spare_servers = 1
pm.max_spare_servers = 3
			</pre>
		</div>
		<div class="section" title="4.3. 將php加入PATH環境變數"><div class="titlepage"><div><div><h3 class="title"><a id="idp112832"></a>4.3. 將php加入PATH環境變數</h3></div></div></div>
			
			<pre class="screen">
			
vim  ~/.bash_profile &lt;&lt;END &gt; /dev/null 2&gt;&amp;1
:%s#bin#bin:/srv/php/bin#
:wq
END
			
			</pre>
		</div>
		<div class="section" title="4.4. PHP　Extension - APC"><div class="titlepage"><div><div><h3 class="title"><a id="idp114592"></a>4.4. PHP　Extension - APC</h3></div></div></div>
			
			<p>Apc</p>
			<pre class="screen">
			
pecl install apc

cat &gt; /srv/php-5.4.15/etc/conf.d/apc.ini &lt;&lt;EOF
extension=apc.so
EOF
			
			</pre>
			<p>查看安裝情況</p>
			<pre class="screen">
# /srv/php/bin/php -m | grep apc
apc
			</pre>
		</div>

		<div class="section" title="4.5. phpredis"><div class="titlepage"><div><div><h3 class="title"><a id="idp117952"></a>4.5. phpredis</h3></div></div></div>
			
			<p>安裝git版本控制客戶端</p>
			<pre class="screen">
yum install git
			</pre>
			<p>從github倉庫中克隆一份代碼到本地</p>
			<pre class="screen">
git clone git://github.com/nicolasff/phpredis.git
			</pre>
			<p>編譯安裝phpredis； 我暫時沒有找到 pecl的phpredis源</p>
			<pre class="screen">
			
cd phpredis
phpize
./configure --with-php-config=/srv/php-5.4.15/bin/php-config
make &amp;&amp; make install
			
			</pre>
			<p>創建配置檔案</p>
			<pre class="screen">
			
cat &gt; /srv/php-5.4.15/etc/conf.d/redis.ini &lt;&lt;EOF
extension=redis.so
EOF
			
			</pre>
			<p>查看安裝情況</p>
			<pre class="screen">
# php -m | grep redis
redis
			</pre>
		</div>
		<div class="section" title="4.6. mongo"><div class="titlepage"><div><div><h3 class="title"><a id="idp118208"></a>4.6. mongo</h3></div></div></div>
			
			<p>pecl 安裝  mongo</p>
			<pre class="screen">
pecl install mongo
			</pre>
			<p>創建配置檔案</p>
			<pre class="screen">
			
cat &gt; /srv/php-5.4.15/etc/conf.d/mongo.ini &lt;&lt;EOF
extension=mongo.so
EOF
			
			</pre>
			<pre class="screen">
# php -m | grep mongo
mongo
			</pre>
		</div>
		<div class="section" title="4.7. 編譯中遇到問題如何處理？"><div class="titlepage"><div><div><h3 class="title"><a id="idp128912"></a>4.7. 編譯中遇到問題如何處理？</h3></div></div></div>
			
			<p>下面我們來模擬一個場景，例如 configure的時候出現下面提示</p>
			<pre class="screen">
configure: error: Can not find recode.h anywhere under yes /usr/local /usr /opt.
			</pre>
			<p>提示找不到recode。h檔案，很好辦，首先搜索recode包</p>
			<pre class="screen">
[root@haproxy php-5.4.15]# yum search recode                                                                                                                                                                                                                        |  327 B     00:00
============================ N/S Matched: recode ====================================
php-recode.x86_64 : A module for PHP applications for using the recode library
recode-devel.i686 : Header files and static libraries for development using recode
recode-devel.x86_64 : Header files and static libraries for development using recode
recode.i686 : Conversion between character sets and surfaces
recode.x86_64 : Conversion between character sets and surfaces

  Name and summary matches only, use "search all" for everything.
			</pre>
			<p>然後安裝devel包,記住之需要安裝devel包即可，其他都是多餘。</p>
			<pre class="screen">
[root@haproxy php-5.4.15]# yum install recode-devel -y
			</pre>
			<p>然後重新運行configure</p>
		</div>
	</div>
	<div class="section" title="5. nginx-1.2.5"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="idp93488"></a>5. nginx-1.2.5</h2></div></div></div>
		
		<p>為web伺服器創建一個用戶，我喜歡使用www,id為80更容易記，同時將一個單獨分區掛在/www上用戶存放web應用程序。</p>
		<pre class="screen">
groupadd -g 80 www
adduser -o --home /www --uid 80 --gid 80 -c "Web Application" www
		</pre>
		<p>添加nginx的YUM源</p>
		<pre class="screen">
		
cat &gt; /etc/yum.repos.d/nginx.repo &lt;&lt;EOF
[nginx]
name=nginx repo
baseurl=http://nginx.org/packages/centos/6/x86_64/
gpgcheck=0
enabled=1
EOF
		
		</pre>
		<p>開始安裝nginx</p>
		<pre class="screen">
		
yum search nginx

yum install -y nginx
chkconfig nginx on
service nginx start
		
		</pre>
		<p>如果你不懂編譯器優化，建議你使用rpm方案。在不優化的情況下編譯出來程序很臃腫。</p>
		<p></p>
		<pre class="screen">
# rpm -qa | grep nginx
nginx-1.2.5-1.el6.ngx.x86_64
		</pre>
		<div class="section" title="5.1. /etc/nginx/nginx.conf"><div class="titlepage"><div><div><h3 class="title"><a id="idp141232"></a>5.1. /etc/nginx/nginx.conf</h3></div></div></div>
			
			<p>隱藏nginx版本號</p>
			<pre class="screen">
vim /etc/nginx/nginx.conf

http {
...
    server_tokens off;
}
			</pre>
		</div>
		<div class="section" title="5.2. host 配置"><div class="titlepage"><div><div><h3 class="title"><a id="idp143488"></a>5.2. host 配置</h3></div></div></div>
			
			<pre class="screen">
mkdir -p /www/www.mydomain.com/htdocs

cd /etc/nginx/conf.d
cp default.conf www.mydomain.com.conf
vim www.mydomain.com.conf
			</pre>

			<pre class="screen">
server {
    listen       80;
    server_name  www.mydomain.com;

    charset utf-8;
    access_log  /var/log/nginx/www.mydomain.com.access.log  main;

    location / {
        root   /www/www.mydomain.com/htdocs;
        index  index.html index.php;
    }

    #error_page  404              /404.html;

    # redirect server error pages to the static page /50x.html
    #
    error_page   500 502 503 504  /50x.html;
    location = /50x.html {
        root   /usr/share/nginx/html;
    }

    # proxy the PHP scripts to Apache listening on 127.0.0.1:80
    #
    #location ~ \.php$ {
    #    proxy_pass   http://127.0.0.1;
    #}

    # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000
    #
    location ~ \.php$ {
        root           html;
        fastcgi_pass   127.0.0.1:9000;
        fastcgi_index  index.php;
        fastcgi_param  SCRIPT_FILENAME  /www/www.mydomain.com/htdocs$fastcgi_script_name;
        include        fastcgi_params;
    }

    # deny access to .htaccess files, if Apache's document root
    # concurs with nginx's one
    #
    location ~ /\.ht {
        deny  all;
    }
}
			</pre>
			<p>創建測試頁面</p>
			<pre class="screen">
			
cat &gt;&gt; /www/www.mydomain.com/htdocs/index.php &lt;&lt;PHP
&lt;?php
phpinfo();
PHP
			
			</pre>
			<p>啟動伺服器</p>
			<pre class="screen">
service php-fpm start
service nginx start
			</pre>
			<p>檢查index.php輸出</p>
			<pre class="screen">
# curl -H HOST:www.mydomain.com http://127.0.0.1/index.php
			</pre>
		</div>
	</div>
	<div class="section" title="6. redis-2.4.10"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="idp135072"></a>6. redis-2.4.10</h2></div></div></div>
		
		<p>安裝fedora的YUM源，</p>
		<pre class="screen">
rpm -Uvh http://dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-7.noarch.rpm
		</pre>
		<p>安裝redis</p>
		<pre class="screen">
# yum install redis

# chkconfig redis on

# service redis start
		</pre>
	</div>
	<div class="section" title="7. MongoDB"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="idp153984"></a>7. MongoDB</h2></div></div></div>
		
		<pre class="screen">
# yum install mongodb-server

# chkconfig mongod on

# service mongod start
		</pre>
	</div>
</div><div xmlns="" id="disqus_thread"></div><script xmlns="" type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */

            if(document.domain == 'netkiller.github.com'){
            var disqus_shortname = 'netkiller'; // required: replace example with your forum shortname
            }else{
			var disqus_shortname = 'neochan';
            }

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script><noscript xmlns="">Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript><a xmlns="" href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a></body></html>