<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>实操 Web Cache</title><link rel="stylesheet" type="text/css" href="journal.css" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><meta name="description" content="http://netkiller.github.io/www/index.html " /><meta name="keywords" content="If-Modified-Since, Last-Modified, , " /><script xmlns="" type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-11694057-1']);
  _gaq.push(['_setDomainName', 'netkiller.sourceforge.net']);
  _gaq.push(['_setAllowHash', 'false']);
  _gaq.push(['_setAllowLinker', true]);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script></head><body><table xmlns="" width="100%" border="0"><tr><td align="left"><a href="http://netkiller.github.io/">Home</a> |
        <a href="http://netkiller.sourceforge.net/">Mirror</a> |
        <a href="/search.html">Search</a> |
        <a href="http://netkiller-github-com.iteye.com/">ITEYE 博客</a> |
        <a href="http://my.oschina.net/neochen/">OSChina 博客</a> |
        <a href="http://rline.blog.51cto.com/">51CTO 博客</a></td><td></td><td></td></tr></table><div xml:lang="zh-cn" class="article" lang="zh-cn"><div class="titlepage"><div><div><h2 class="title"><a id="idp54739136"></a>实操 Web Cache</h2></div><div><h3 class="subtitle"><em>http://netkiller.github.io/journal/cache.html</em></h3></div><div><div class="author"><h3 class="author"><span class="honorific">Mr</span>. <span class="firstname">Neo Chen</span> <span class="surname">(netkiller)</span>, <span class="lineage">陈景峰(BG7NYT)</span></h3><div class="affiliation">
			<div class="address"><p><br />
				<span class="country">中国</span><span class="state">广东省</span><span class="city">深圳市</span><span class="street">龙华新区民治街道溪山美地</span><br />
				<span class="postcode">518131</span><br />
				<span class="phone">+86 13113668890</span><br />
				<span class="fax">+86 755 29812080</span><br />
				<code class="email">&lt;<a class="email" href="mailto:netkiller@msn.com">netkiller@msn.com</a>&gt;</code><br />
			</p></div>
		</div></div></div><div><p class="releaseinfo">$Id$</p></div><div><p class="copyright">版权 © 2011, 2012, 2013, 2014 http://netkiller.github.io</p></div><div><p class="pubdate">$Date$</p></div><div><div class="abstract"><p class="title"><strong>摘要</strong></p>
			<p>http://netkiller.github.io/www/index.html</p>
			<p></p>
		</div></div><div><div class="abstract"><a id="abstract"></a><p class="title"><strong>我的系列文档</strong></p>
	
	<table border="0" summary="Simple list" class="simplelist"><tr><td>
			<a class="ulink" href="../architect/index.html" target="_top">Netkiller Architect 手札</a>
		</td><td>
			<a class="ulink" href="../developer/index.html" target="_top">Netkiller Developer 手札</a>
		</td><td>
			<a class="ulink" href="../php/index.html" target="_top">Netkiller PHP 手札</a>
		</td><td>
			<a class="ulink" href="../python/index.html" target="_top">Netkiller Python 手札</a>
		</td><td>
			<a class="ulink" href="../testing/index.html" target="_top">Netkiller Testing 手札</a>
		</td><td>
			<a class="ulink" href="../cryptography/index.html" target="_top">Netkiller Cryptography 手札</a>
		</td></tr><tr><td>
			<a class="ulink" href="../linux/index.html" target="_top">Netkiller Linux 手札</a>
		</td><td>
			<a class="ulink" href="../debian/index.html" target="_top">Netkiller Debian 手札</a>
		</td><td>
			<a class="ulink" href="../centos/index.html" target="_top">Netkiller CentOS 手札</a>
		</td><td>
			<a class="ulink" href="../freebsd/index.html" target="_top">Netkiller FreeBSD 手札</a>
		</td><td>
			<a class="ulink" href="../shell/index.html" target="_top">Netkiller Shell 手札</a>
		</td><td>
			<a class="ulink" href="../security/index.html" target="_top">Netkiller Security 手札</a>
		</td></tr><tr><td>
			<a class="ulink" href="../www/index.html" target="_top">Netkiller Web 手札</a>
		</td><td>
			<a class="ulink" href="../monitoring/index.html" target="_top">Netkiller Monitoring 手札</a>
		</td><td>
			<a class="ulink" href="../storage/index.html" target="_top">Netkiller Storage 手札</a>
		</td><td>
			<a class="ulink" href="../mail/index.html" target="_top">Netkiller Mail 手札</a>
		</td><td>
			<a class="ulink" href="../docbook/index.html" target="_top">Netkiller Docbook 手札</a>
		</td><td>
			<a class="ulink" href="../version/index.html" target="_top">Netkiller Version 手札</a>
		</td></tr><tr><td>
			<a class="ulink" href="../database/index.html" target="_top">Netkiller Database 手札</a>
		</td><td>
			<a class="ulink" href="../postgresql/index.html" target="_top">Netkiller PostgreSQL 手札</a>
		</td><td>
			<a class="ulink" href="../mysql/index.html" target="_top">Netkiller MySQL 手札</a>
		</td><td>
			<a class="ulink" href="../nosql/index.html" target="_top">Netkiller NoSQL 手札</a>
		</td><td>
			<a class="ulink" href="../ldap/index.html" target="_top">Netkiller LDAP 手札</a>
		</td><td>
			<a class="ulink" href="../network/index.html" target="_top">Netkiller Network 手札</a>
		</td></tr><tr><td>
			<a class="ulink" href="../cisco/index.html" target="_top">Netkiller Cisco IOS 手札</a>
		</td><td>
			<a class="ulink" href="../h3c/index.html" target="_top">Netkiller H3C 手札</a>
		</td><td>
			<a class="ulink" href="../multimedia/index.html" target="_top">Netkiller Multimedia 手札</a>
		</td><td> </td><td> </td><td> </td></tr></table>
	

</div></div></div><hr /></div><div class="toc"><p><strong>目录</strong></p><dl class="toc"><dt><span class="section"><a href="#idp54740448">1. If-Modified-Since / Last-Modified</a></span></dt><dd><dl><dt><span class="section"><a href="#idp54821216">1.1. 静态文件</a></span></dt><dt><span class="section"><a href="#idp54830032">1.2. 动态文件</a></span></dt><dt><span class="section"><a href="#idp54836944">1.3. 通过rewrite伪静态处理</a></span></dt></dl></dd><dt><span class="section"><a href="#idp54841952">2. ETag / If-None-Match</a></span></dt><dd><dl><dt><span class="section"><a href="#idp54844832">2.1. 静态文件</a></span></dt><dt><span class="section"><a href="#idp54848176">2.2. 动态程序</a></span></dt></dl></dd><dt><span class="section"><a href="#idp54848432">3. Expires / Cache-Control</a></span></dt><dd><dl><dt><span class="section"><a href="#idp54861360">3.1. 静态文件</a></span></dt><dt><span class="section"><a href="#idp54865168">3.2. 动态文件</a></span></dt></dl></dd></dl></div>
	

 	<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="idp54740448"></a>1. If-Modified-Since / Last-Modified</h2></div></div></div>
 		
 		<p>If-Modified-Since 小于 Last-Modified 返回 HTTP/1.1 200 OK, 否则返回 HTTP/1.0 304 Not Modified</p>

 		<div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp54821216"></a>1.1. 静态文件</h3></div></div></div>
			
			<p>静态文件自动产生 Last-Modified 头</p>
			<pre class="screen">
# curl -I http://192.168.6.9/index.html
HTTP/1.1 200 OK
Server: nginx/1.0.15
Date: Thu, 27 Feb 2014 07:36:03 GMT
Content-Type: text/html
Content-Length: 6
Last-Modified: Thu, 27 Feb 2014 07:29:50 GMT
Connection: keep-alive
Accept-Ranges: bytes
			</pre>
			<p>图片文件</p>
			<pre class="screen">
# curl -I http://192.168.6.9/image.png
HTTP/1.1 200 OK
Server: nginx/1.0.15
Date: Thu, 27 Feb 2014 07:37:18 GMT
Content-Type: image/png
Content-Length: 41516
Last-Modified: Thu, 27 Feb 2014 07:36:59 GMT
Connection: keep-alive
Accept-Ranges: bytes
			</pre>
			<p>每次浏览器请求文件会携带  If-Modified-Since 头，将当前时间发送给服务器，与服务器的Last-Modified时间对对比，如果大于Last-Modified时间，返回HTTP/1.0 304 Not Modified不会重新打开文件，否则重新读取文件并返回内容</p>
			<pre class="screen">
# curl -H "If-Modified-Since: Fir, 28 Feb 2014 07:42:55 GMT" -I http://www.163.com/
HTTP/1.0 304 Not Modified
Date: Thu, 27 Feb 2014 07:51:20 GMT
Content-Type: text/html; charset=GBK
Expires: Thu, 27 Feb 2014 07:51:34 GMT
Cache-Control: max-age=80
Age: 54
X-Via: 1.0 fjpt182:1 (Cdn Cache Server V2.0)
Connection: keep-alive
			</pre>

			<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">注意</h3>
	 			
	 			<p>每一个WEB服务器的实现方式不一样，每个浏览器的实现方式也不同，例如我们对nginx与lighttpd测试，使用curl发送If-Modified-Since头，nginx 无法返回304始终返回200，而lighttpd 可以返回304</p>
	 			<pre class="screen">
				
# curl -H "If-Modified-Since: Fri, 29 Feb 2014 08:42:55 GMT" -I -v  http://192.168.6.9/index.html
* About to connect() to 192.168.6.9 port 80 (#0)
*   Trying 192.168.6.9... connected
* Connected to 192.168.6.9 (192.168.6.9) port 80 (#0)
&gt; HEAD /index.html HTTP/1.1
&gt; User-Agent: curl/7.19.7 (x86_64-redhat-linux-gnu) libcurl/7.19.7 NSS/3.14.0.0 zlib/1.2.3 libidn/1.18 libssh2/1.4.2
&gt; Host: 192.168.6.9
&gt; Accept: */*
&gt; If-Modified-Since: Fri, 29 Feb 2014 08:42:55 GMT
&gt;
&lt; HTTP/1.1 200 OK
HTTP/1.1 200 OK
&lt; Server: nginx/1.0.15
Server: nginx/1.0.15
&lt; Date: Thu, 27 Feb 2014 08:15:20 GMT
Date: Thu, 27 Feb 2014 08:15:20 GMT
&lt; Content-Type: text/html
Content-Type: text/html
&lt; Content-Length: 6
Content-Length: 6
&lt; Last-Modified: Thu, 27 Feb 2014 07:29:50 GMT
Last-Modified: Thu, 27 Feb 2014 07:29:50 GMT
&lt; Connection: keep-alive
Connection: keep-alive
&lt; Accept-Ranges: bytes
Accept-Ranges: bytes

&lt;
* Connection #0 to host 192.168.6.9 left intact
* Closing connection #0
				
				</pre>
	 			<p>lighttpd 会正常返回304</p>
	 			<pre class="screen">
				
# curl -H "If-Modified-Since: Fri, 28 Feb 2014 08:42:55 GMT" -I http://192.168.6.2/index.html
HTTP/1.1 304 Not Modified
Content-Type: text/html
Accept-Ranges: bytes
ETag: "4021085363"
Last-Modified: Thu, 20 Feb 2014 09:45:00 GMT
Date: Thu, 27 Feb 2014 08:10:49 GMT
Server: lighttpd/1.4.31
				
				</pre>
				<p>在使用 Chrome / Firefox 浏览器测试一下，你很发现都能实现返回 304，包括 nginx.说明nginx 如果想返回304需要提供其他HTTP头，而不能仅仅推送 If-Modified-Since</p>
	 		</div>

		</div>
		<div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp54830032"></a>1.2. 动态文件</h3></div></div></div>
			
			<p>动态文件没有 Last-Modified 头，我们可以伪造一个</p>
			<pre class="screen">
			
# curl -I http://192.168.6.9/index.php
HTTP/1.1 200 OK
Server: nginx/1.0.15
Date: Thu, 27 Feb 2014 07:57:59 GMT
Content-Type: text/html
Connection: keep-alive
			
			</pre>
			<p>在程序中加入HTTP头推送操作,Last-Modified时间是27号，当前时间是28号，我们要让Last-Modified 小于当前时间才行。</p>
			<pre class="screen">
			
# cat index.php
&lt;?php
header('Last-Modified: Thu, 27 Feb 2014 08:39:35 GMT' );
//header('Last-Modified: ' .gmdate('D, d M Y H:i:s') . ' GMT' );
?&gt;
Hello
			
			</pre>
			<p>现在你将看到 Last-Modified</p>
			<pre class="screen">
			
# curl -I http://192.168.6.9/index.php
HTTP/1.1 200 OK
Server: nginx/1.0.15
Date: Thu, 27 Feb 2014 08:32:40 GMT
Content-Type: text/html
Connection: keep-alive
Last-Modified: Thu, 27 Feb 2014 08:32:39 GMT
			
			</pre>
			<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">注意</h3>
				
				<p>虽然我们让动态程序返回了 Last-Modified ，但浏览器不认，经过测试 Chrome / Firefox 均不会承认.php文件，并缓存其内容。</p>
				<pre class="screen">
				
# curl -H "If-Modified-Since: Fri, 28 Feb 2014 08:42:55 GMT" -I -v http://192.168.6.9/index.php
* About to connect() to 192.168.6.9 port 80 (#0)
*   Trying 192.168.6.9... connected
* Connected to 192.168.6.9 (192.168.6.9) port 80 (#0)
&gt; HEAD /index.php HTTP/1.1
&gt; User-Agent: curl/7.19.7 (x86_64-redhat-linux-gnu) libcurl/7.19.7 NSS/3.14.0.0 zlib/1.2.3 libidn/1.18 libssh2/1.4.2
&gt; Host: 192.168.6.9
&gt; Accept: */*
&gt; If-Modified-Since: Fri, 28 Feb 2014 08:42:55 GMT
&gt;
&lt; HTTP/1.1 200 OK
HTTP/1.1 200 OK
&lt; Server: nginx/1.0.15
Server: nginx/1.0.15
&lt; Date: Thu, 27 Feb 2014 08:39:36 GMT
Date: Thu, 27 Feb 2014 08:39:36 GMT
&lt; Content-Type: text/html
Content-Type: text/html
&lt; Connection: keep-alive
Connection: keep-alive
&lt; Last-Modified: Thu, 27 Feb 2014 08:39:35 GMT
Last-Modified: Thu, 27 Feb 2014 08:39:35 GMT
* no chunk, no close, no size. Assume close to signal end

&lt;
* Closing connection #0
				
				</pre>
				<p>Last-Modified 对动态程序来说没有起到实际作用</p>
			</div>
		</div>
		<div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp54836944"></a>1.3. 通过rewrite伪静态处理</h3></div></div></div>
			
			<p>index.php仍然是上面的那个php文件，我们只是做了伪静态</p>
			<pre class="screen">
			
location / {
        root   /www;
        index  index.html index.htm;
		rewrite ^/test.html$ /index.php last;
}
			
			</pre>
			<p>现在我们分别通过curl有chrome/firefox进行测试</p>

			<pre class="screen">
			
	# curl -H "If-Modified-Since: Fri, 28 Feb 2014 08:42:55 GMT" -I  http://192.168.6.9/test.html
HTTP/1.1 200 OK
Server: nginx/1.0.15
Date: Thu, 27 Feb 2014 08:55:19 GMT
Content-Type: text/html
Connection: keep-alive
Last-Modified: Thu, 26 Feb 2014 08:39:35 GMT
			
			</pre>
			<p>经过测试无论是 curl 还是 chrome/firefox 均无法返回304.</p>
			<p>下面是我的分析，仅供参考。用户请求index.html Nginx 会找到该文件读取 mtime 与 If-Modified-Since 匹配，如果If-Modified-Since大于 Last-Modified返回 304否则返回200.</p>
			<p>为什么同样操作经过伪静态的test.html就不行呢？ 我分析当用户请求test.html Nginx 首先做Rewrite处理，然后跳转到index.php 整个过程nginx 并没有访问实际物理文件test.html也就没有mtime, 所以Nginx 返回200.</p>
			<p>如果 Nginx 按预想的返回304，nginx 需要读取程序返回的HTTP头，Nginx 并没有这样的处理逻辑。</p>
		</div>

	</div>

	<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="idp54841952"></a>2. ETag / If-None-Match</h2></div></div></div>
		
		<p>etag on; 开启Nginx etag支持，lighttpd 默认开启</p>
		<pre class="screen">
		
server {
    listen       80;
    server_name phalcon;

    charset utf-8;

    access_log  /var/log/nginx/host.access.log  main;
	etag on;
    location / {
        root   /www/phalcon/public;
        index  index.html index.php;
    }
}
		
		</pre>
		<p>检查ETag输出</p>
		<pre class="screen">
# curl -I http://phalcon/img/css.png
HTTP/1.1 200 OK
Server: nginx
Date: Thu, 27 Feb 2014 09:20:49 GMT
Content-Type: image/png
Content-Length: 1133
Last-Modified: Fri, 14 Feb 2014 08:05:03 GMT
Connection: keep-alive
ETag: "52fdce2f-46d"
Accept-Ranges: bytes
		</pre>

		<div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp54844832"></a>2.1. 静态文件</h3></div></div></div>
			
			<p>首先查询etag值</p>
			<pre class="screen">
# curl -I http://phalcon/img/css.png
HTTP/1.1 200 OK
Server: nginx
Date: Thu, 27 Feb 2014 09:25:41 GMT
Content-Type: image/png
Content-Length: 1133
Last-Modified: Fri, 14 Feb 2014 08:05:03 GMT
Connection: keep-alive
ETag: "52fdce2f-46d"
Accept-Ranges: bytes
			</pre>
			<p>然后向服务器发送If-None-Match HTTP头</p>
			<pre class="screen">
# curl -H 'If-None-Match: "52fdce2f-46d"' -I http://phalcon/img/css.png
HTTP/1.1 304 Not Modified
Server: nginx
Date: Thu, 27 Feb 2014 09:25:44 GMT
Last-Modified: Fri, 14 Feb 2014 08:05:03 GMT
Connection: keep-alive
ETag: "52fdce2f-46d"
			</pre>
			<p>这次比较顺利，成功返回HTTP/1.1 304 Not Modified</p>
		</div>
		<div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp54848176"></a>2.2. 动态程序</h3></div></div></div>
			
			<p>默认情况输出如下</p>
			<pre class="screen">
# curl -I http://192.168.6.9/index.php
HTTP/1.1 200 OK
Server: nginx
Date: Thu, 27 Feb 2014 09:29:13 GMT
Content-Type: text/html; charset=utf-8
Connection: keep-alive
			</pre>
			<p>测试程序</p>
			<pre class="screen">
			
&lt;?php
header('Last-Modified: Thu, 26 Feb 2014 08:39:35 GMT' );
header('Etag: "abcdefg"');
#header('Last-Modified: ' .gmdate('D, d M Y H:i:s') . ' GMT' );
?&gt;
Hello 
			
			</pre>
			<p>测试效果</p>
			<pre class="screen">
# curl -I http://192.168.6.9/index.php
HTTP/1.1 200 OK
Server: nginx/1.0.15
Date: Thu, 27 Feb 2014 09:41:06 GMT
Content-Type: text/html
Connection: keep-alive
Last-Modified: Thu, 26 Feb 2014 08:39:35 GMT
Etag: "abcdefg"

[root@centos6 ~]# curl -H 'If-None-Match: "abcdefg"' -I http://192.168.6.9/index.php
HTTP/1.1 200 OK
Server: nginx/1.0.15
Date: Thu, 27 Feb 2014 09:41:42 GMT
Content-Type: text/html
Connection: keep-alive
Last-Modified: Thu, 26 Feb 2014 08:39:35 GMT
Etag: "abcdefg"
			</pre>
			<p>测试情况与之前的Last-Modified结果一样</p>
			<p>动态程序返回Etag真的就没有用了吗？</p>
			<p>答案是：非也， 有一个方法可以让动态程序返回的 Etag 也能发挥作用，程序修改如下</p>
			<pre class="screen">
			
&lt;?php
$etag = md5('http://netkiller.github.io');
cache($etag);
function cache($etag)
{
        $http_if_none_match = null;
        if(array_key_exists ('HTTP_IF_NONE_MATCH',$_SERVER)){
                $http_if_none_match = $_SERVER['HTTP_IF_NONE_MATCH'];
        }
        
        if ($http_if_none_match == $etag)  
        { 
                header('Etag: '.$etag, true, 304); 
                exit; 
        } else {
                header('Etag: '.$etag);  
        }
        
} 
print_r($_SERVER);
echo date("Y-m-d H:i:s");
?&gt;
			
			</pre>
			<p>首先查看Etag值</p>
			<pre class="screen">
# curl  -I http://192.168.6.9/test.php
HTTP/1.1 200 OK
Server: nginx/1.0.15
Date: Thu, 27 Feb 2014 10:07:19 GMT
Content-Type: text/html
Connection: keep-alive
Etag: 7467675324d0f7a3e01ce5151848fedb
			</pre>
			<p>发送If-None-Match头</p>
			<pre class="screen">
# curl -H 'If-None-Match: 7467675324d0f7a3e01ce5151848fedb' -I http://192.168.6.9/test.php
HTTP/1.1 304 Not Modified
Server: nginx/1.0.15
Date: Thu, 27 Feb 2014 10:07:39 GMT
Connection: keep-alive
Etag: 7467675324d0f7a3e01ce5151848fedb
			</pre>
			<p>达成预计效果，此种方法同样可以用于 Last-Modified，伪静态后效果更好</p>
			<p>Etag 值的运算技巧，我习惯上采用URL同时配合伪静态例如</p>
			<pre class="screen">
$etag = $_SERVER['REQUEST_URI']
			</pre>
			<p>URL类似 http://www.example.com/news/100/1000.html 一次请求便缓存页面，这样带来一个更新的问题，于是又做了这样的处理</p>
			<pre class="screen">
http://www.example.com/news/100/1000.1.html			
			</pre>
			<p>.1.是版本号，每次修改后+1操作，.1.没有人格意义rewrite操作是会丢弃这个参数，仅仅是为了始终有新的URL对应内容</p>
		</div>
	</div>
	<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="idp54848432"></a>3. Expires / Cache-Control</h2></div></div></div>
		
		<p>前面所讲 Last-Modified 与 Etag 主要用于分辨文件是否修改过， 无法控制页面在浏览器端缓存的时间。Expires / Cache-Control 可以控制缓存的时间段</p>
		<p>Expires 是 HTTP/1.0标准，Cache-Control是 HTTP/1.1标准。都能正常工作，HTTP/1.1规范中max-age优先级高于Expires,有些浏览器会联动设置，例如你设置了Cache-Control随之自动生成Expires，仅仅为了兼容。</p>
		<div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp54861360"></a>3.1. 静态文件</h3></div></div></div>
			
			<p>首先配置nginx设置html与png文件缓存1天</p>
			<pre class="screen">
location ~ .*\.(html|png)$
{
    expires      1d;
}
			</pre>
			<p>当前情况</p>
			<pre class="screen">
# curl -I http://192.168.6.9/index.html
HTTP/1.1 200 OK
Server: nginx/1.0.15
Date: Thu, 27 Feb 2014 10:47:08 GMT
Content-Type: text/html
Content-Length: 6
Last-Modified: Thu, 27 Feb 2014 07:29:50 GMT
Connection: keep-alive
Accept-Ranges: bytes
			</pre>
			<p>重启Nginx后的HTTP协议头多出Expires与Cache-Control</p>
			<pre class="screen">
# curl -I http://192.168.6.9/index.html
HTTP/1.1 200 OK
Server: nginx/1.0.15
Date: Thu, 27 Feb 2014 10:42:09 GMT
Content-Type: text/html
Content-Length: 3698
Last-Modified: Fri, 26 Apr 2013 20:36:51 GMT
Connection: keep-alive
Expires: Fri, 28 Feb 2014 10:42:09 GMT
Cache-Control: max-age=86400
Accept-Ranges: bytes
			</pre>
		</div>
		<div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp54865168"></a>3.2. 动态文件</h3></div></div></div>
			
			<p>默认返回</p>
			<pre class="screen">
# curl -I http://192.168.6.9/index.php
HTTP/1.1 200 OK
Server: nginx/1.0.15
Date: Thu, 27 Feb 2014 11:45:05 GMT
Content-Type: text/html
Connection: keep-alive	
			</pre>
			<p>index.php 增加 Cache-Control 输出控制</p>
			<pre class="screen">
			
header('Cache-Control: max-age=259200');
			
			</pre>
			<p>再次查看</p>
			<pre class="screen">
# curl -I http://192.168.6.9/index.php
HTTP/1.1 200 OK
Server: nginx/1.0.15
Date: Thu, 27 Feb 2014 11:53:48 GMT
Content-Type: text/html
Connection: keep-alive
Cache-Control: max-age=259200
			</pre>
		</div>
	</div>
</div><div xmlns="" id="bdshare" class="bdshare_t bds_tools_32 get-codes-bdshare"><a class="bds_fbook"></a><a class="bds_twi"></a><a class="bds_ms"></a><a class="bds_msn"></a><a class="bds_buzz"></a><a class="bds_linkedin"></a><a class="bds_deli"></a><a class="bds_qzone"></a><a class="bds_qq"></a><a class="bds_tqq"></a><a class="bds_tqf"></a><a class="bds_tsina"></a><a class="bds_baidu"></a><a class="bds_renren"></a><a class="bds_t163"></a><a class="bds_tfh"></a><a class="bds_douban"></a><a class="bds_hi"></a><a class="bds_tieba"></a><a class="bds_tsohu"></a><span class="bds_more"></span><a class="shareCount"></a></div><script xmlns="" type="text/javascript" id="bdshare_js" data="type=tools"></script><script xmlns="" type="text/javascript" id="bdshell_js"></script><script xmlns="" type="text/javascript">
	document.getElementById("bdshell_js").src = "http://bdimg.share.baidu.com/static/js/shell_v2.js?cdnversion=" + new Date().getHours();
</script><div xmlns="" id="disqus_thread"></div><script xmlns="" type="text/javascript">
	        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
	        var disqus_shortname = 'netkiller'; // required: replace example with your forum shortname
	
	        /* * * DON'T EDIT BELOW THIS LINE * * */
	        (function() {
	            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
	            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
	            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	        })();
	    </script><noscript xmlns="">Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript><a xmlns="" href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a><br xmlns="" /><div xmlns="" id="clustrmaps-widget"></div><script xmlns="" type="text/javascript">var _clustrmaps = {'url' : 'http://netkiller.github.io', 'user' : 1107643, 'server' : '2', 'id' : 'clustrmaps-widget', 'version' : 1, 'date' : '2013-08-14', 'lang' : 'en', 'corners' : 'square' };(function (){ var s = document.createElement('script'); s.type = 'text/javascript'; s.async = true; s.src = 'http://www2.clustrmaps.com/counter/map.js'; var x = document.getElementsByTagName('script')[0]; x.parentNode.insertBefore(s, x);})();</script><noscript xmlns=""><a href="http://www2.clustrmaps.com/user/87410e6bb"><img src="http://www2.clustrmaps.com/stats/maps-no_clusters/netkiller.github.io-thumb.jpg" alt="Locations of visitors to this page" /></a></noscript></body></html>