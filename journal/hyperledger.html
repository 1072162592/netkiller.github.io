<?xml version="1.0" encoding="UTF-8"?>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>hyperledger 区块链入门</title><link rel="stylesheet" type="text/css" href="docbook.css"/><link rel="stylesheet" type="text/css" href="/journal/journal.css"/><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"/><meta name="description" content=""/><meta name="keywords" content="https://cn.hyperledger.org, https://hub.docker.com/u/hyperledger/, https://github.com/hyperledger/, "/></head><body><section xml:lang="zh-cn" class="article" id="idp1"><div class="titlepage"><div><div><h2 class="title">hyperledger 区块链入门</h2></div><div><h3 class="subtitle"><em/></h3></div><div><div class="author"><h3 class="author"><span class="honorific">Mr</span>. <span class="firstname">Neo Chen</span> <span class="surname">(陈景峯)</span>, <span class="lineage">netkiller, BG7NYT</span></h3><div class="affiliation">
			<div class="address"><p><br/>
				<span class="country">中国</span><span class="state">广东省</span><span class="city">深圳市</span><span class="street">龙华新区民治街道溪山美地</span><br/>
				<span class="postcode">518131</span><br/>
				<span class="phone">+86 13113668890</span><br/>
				<br/>
				<code class="email">&lt;<a class="email" href="mailto:netkiller@msn.com">netkiller@msn.com</a>&gt;</code><br/>
			</p></div>
		</div></div></div><div><p class="copyright">版权 © 2018 http://netkiller.github.io</p></div><div><div class="legalnotice" id="legalnotice">
	<p class="legalnotice-title"><strong>版权声明</strong></p>
	<p>转载请与作者联系，转载时请务必标明文章原始出处和作者信息及本声明。</p>
	<table style="border: 0; " class="simplelist"><tr><td>
		<a class="ulink" href="http://creativecommons.org/licenses/by/3.0/" target="_top">
			<div><table style="border: 0; width: 180px; cellpadding: 0; cellspacing: 0;"><tr><td><img src="/images/by-nc-sa.png" width="180"/></td></tr></table></div>
		</a>
		</td><td>
			<table style="border: 0; " class="simplelist"><tr><td>
					文档出处:
				</td></tr><tr><td>
					<a class="ulink" href="http://netkiller.github.io/" target="_top">http://netkiller.github.io</a>
				</td></tr><tr><td>
					<a class="ulink" href="http://netkiller.sourceforge.net/" target="_top">http://netkiller.sourceforge.net</a>
				</td></tr></table>
		</td><td>
			<a class="ulink" href="/images/weixin.jpg" target="_top"><div><table style="border: 0; width: 80px; cellpadding: 0; cellspacing: 0;"><tr><td><img src="/images/weixin.jpg" width="80"/></td></tr></table></div></a>
		</td><td>
			<p>微信扫描二维码进入 Netkiller 微信订阅号 </p>
			<p>QQ群：128659835 请注明“读者”</p>
		</td></tr></table>
	<p/>
</div></div><div><p class="pubdate">2018-01-20</p></div><div><div class="abstract"><div class="abstract-title">摘要</div>

		</div></div></div><hr/></div><div class="toc"><div class="toc-title">目录</div><ul class="toc"><li><span class="section"><a href="#what">1. what-做什么</a></span></li><li><span class="section"><a href="#why">2. why-为什么做</a></span></li><li><span class="section"><a href="#when">3. when-何时做</a></span></li><li><span class="section"><a href="#where">4. where-何地做</a></span></li><li><span class="section"><a href="#who">5. who-谁去做</a></span></li><li><span class="section"><a href="#how">6. how-怎么做</a></span><ul><li><span class="section"><a href="#idp3">6.1. 安装Docker</a></span></li><li><span class="section"><a href="#idp8">6.2. 安装 hyperledger 开发环境</a></span><ul><li><span class="section"><a href="#idp4">6.2.1. 正常安装</a></span></li><li><span class="section"><a href="#idp5">6.2.2. 大陆安装</a></span></li><li><span class="section"><a href="#idp6">6.2.3. 编译安装</a></span></li><li><span class="section"><a href="#idp7">6.2.4. 启动 docker 虚拟机</a></span></li></ul></li><li><span class="section"><a href="#idp9">6.3. 部署 chaincode_example</a></span><ul><li><span class="section"><a href="#">6.3.1. 部署连</a></span></li><li><span class="section"><a href="#">6.3.2. 测试</a></span></li></ul></li></ul></li></ul></div>
	
	<section class="section" id="what"><div class="titlepage"><div><div><h2 class="title" style="clear: both">1. what-做什么</h2></div></div></div>
		
		<p>区块链技术发展至今，形成了公有链、联盟链和邦链三种种主流技术平台。</p>
		<p>公有链：
			面向大众，用户可以匿名参与，非常方便，账本数据也公开，加上强大的智能合约，因此公有链极大地促进了区块链概念和技术的普及，比如比特币、Ethereum平台等。</p>
		<p>联盟链：
			考虑到商业应用对安全、隐私、监管、审计、性能的需求，提高准入门槛，增加了安全、隐私、可监管审计等商业特性，是区块链技术在商业领域的应用探索。</p>
		<p>邦链：暂时资料比较少。</p>
	</section>
	<section class="section" id="why"><div class="titlepage"><div><div><h2 class="title" style="clear: both">2. why-为什么做</h2></div></div></div>
		
	</section>
	<section class="section" id="when"><div class="titlepage"><div><div><h2 class="title" style="clear: both">3. when-何时做</h2></div></div></div>
		
	</section>
	<section class="section" id="where"><div class="titlepage"><div><div><h2 class="title" style="clear: both">4. where-何地做</h2></div></div></div>
		
	</section>
	<section class="section" id="who"><div class="titlepage"><div><div><h2 class="title" style="clear: both">5. who-谁去做</h2></div></div></div>
		
	</section>
	<section class="section" id="how"><div class="titlepage"><div><div><h2 class="title" style="clear: both">6. how-怎么做</h2></div></div></div>
		
		<pre class="screen">
		
+---------------------------------+		
|        	     SDK              |
+---------------------------------+	
| golang | nodejs | python | java |
+---------------------------------+			
	|
	V
+---------------------------------+				
| fabric-membersrvc :             |
+---------------------------------+
     
+-------------------+     +-------------------+
|	Peer            |     |  Peer             |	        
+-------------------+     +-------------------+		

+-------------------+     +-------------------+
| Orderer           |     |                   |
+-------------------+     +-------------------+

+-------------------+		
		
		</pre>
		<section class="section" id="idp3"><div class="titlepage"><div><div><h3 class="title">6.1. 安装Docker</h3></div></div></div>
			
			<pre class="screen">
			
curl -s https://raw.githubusercontent.com/oscm/shell/master/virtualization/docker/docker.centos7.ce.sh	 | bash
curl -s https://raw.githubusercontent.com/oscm/shell/master/virtualization/docker/registry-mirror.sh	 | bash
curl -s https://raw.githubusercontent.com/oscm/shell/master/virtualization/docker/docker-compose.sh	 | bash
or 
curl -fsSL https://get.docker.com/ | sh	

创建2个docker网络,如下：
docker network create fabric_noops
docker network create fabric_pbft					
				
yum -y install epel-release
yum install -y git
yum install -y golang
			
			</pre>
		</section>
		<section class="section" id="idp8"><div class="titlepage"><div><div><h3 class="title">6.2. 安装 hyperledger 开发环境</h3></div></div></div>
			
			<p>对于开发环境，最小化的环境，包括 1 个 peer 节点、1 个 Orderer 节点、1 个 CA 节点。</p>
			<p>准备一个服务器或者虚拟机，安装 CentOS 操作系统。</p>
			<section class="section" id="idp4"><div class="titlepage"><div><div><h4 class="title">6.2.1. 正常安装</h4></div></div></div>
				
				<pre class="screen">
				
docker pull hyperledger/fabric-baseimage:latest \
  &amp;&amp; docker pull hyperledger/fabric-membersrvc:latest \
  &amp;&amp; docker pull hyperledger/fabric-peer:latest \
  &amp;&amp; docker pull hyperledger/fabric-orderer:latest \
  &amp;&amp; docker pull hyperledger/fabric-ca:latest \
  &amp;&amp; docker pull hyperledger/blockchain-explorer:latest
				
				</pre>
				<p>在中国安装会出现下面问题</p>
				<pre class="screen">
				
[root@localhost ~]# docker search fabric-peer | grep hyperledger/fabric-peer
hyperledger/fabric-peer            Fabric Peer docker image for Hyperledger Pro…   69

[root@localhost ~]# docker pull hyperledger/fabric-peer:latest
Error response from daemon: manifest for hyperledger/fabric-peer:latest not found

不清楚什么原因，可以 search 到的镜像 pull 不了，所以只能安装 yeasy 这个人的镜像。				
				
				</pre>
			</section>
			<section class="section" id="idp5"><div class="titlepage"><div><div><h4 class="title">6.2.2. 大陆安装</h4></div></div></div>
				
				<p>很多区块链资源被墙，你懂得，一种是穿墙，另一种方法是绕过，例如使用镜像什么的。</p>
				<pre class="screen">
				
[root@localhost ~]# docker login
Login with your Docker ID to push and pull images from Docker Hub. If you don't have a Docker ID, head over to https://hub.docker.com to create one.
Username: netkiller
Password: 
Login Succeeded

$ docker pull yeasy/hyperledger-fabric-base:latest \
&amp;&amp; docker pull yeasy/hyperledger-fabric-peer:latest \
&amp;&amp; docker pull yeasy/hyperledger-fabric-orderer:latest \
&amp;&amp; docker pull yeasy/hyperledger-fabric-ca:latest \
&amp;&amp; docker pull yeasy/blockchain-explorer:latest \

[root@localhost ~]# docker images
REPOSITORY                         TAG                 IMAGE ID            CREATED             SIZE
yeasy/hyperledger-fabric-peer      latest              8876b7225dc3        37 hours ago        1.08GB
yeasy/hyperledger-fabric-orderer   latest              e897ecff0086        37 hours ago        1.06GB
yeasy/hyperledger-fabric-base      latest              b509bb641b0e        37 hours ago        1.02GB
yeasy/hyperledger-fabric-ca        latest              e526ccde93b6        6 days ago          851MB
yeasy/blockchain-explorer          latest              eb397ff175d1        7 days ago          659MB

docker tag yeasy/hyperledger-fabric-peer hyperledger/fabric-peer \
&amp;&amp; docker tag yeasy/hyperledger-fabric-orderer hyperledger/fabric-orderer \
&amp;&amp; docker tag yeasy/hyperledger-fabric-ca hyperledger/fabric-ca \
&amp;&amp; docker tag yeasy/hyperledger-fabric-base hyperledger/fabric-baseimage \
&amp;&amp; docker tag yeasy/hyperledger-fabric-base hyperledger/fabric-ccenv:x86_64-1.0.0-snapshot-preview		

[root@localhost ~]# docker images
REPOSITORY                         TAG                             IMAGE ID            CREATED             SIZE
hyperledger/fabric-peer            latest                          8876b7225dc3        37 hours ago        1.08GB
yeasy/hyperledger-fabric-peer      latest                          8876b7225dc3        37 hours ago        1.08GB
hyperledger/fabric-orderer         latest                          e897ecff0086        37 hours ago        1.06GB
yeasy/hyperledger-fabric-orderer   latest                          e897ecff0086        37 hours ago        1.06GB
hyperledger/fabric-baseimage       latest                          b509bb641b0e        37 hours ago        1.02GB
hyperledger/fabric-ccenv           x86_64-1.0.0-snapshot-preview   b509bb641b0e        37 hours ago        1.02GB
yeasy/hyperledger-fabric-base      latest                          b509bb641b0e        37 hours ago        1.02GB
hyperledger/fabric-ca              latest                          e526ccde93b6        6 days ago          851MB
yeasy/hyperledger-fabric-ca        latest                          e526ccde93b6        6 days ago          851MB
yeasy/blockchain-explorer          latest                          eb397ff175d1        7 days ago          659MB

				
				</pre>
			</section>
			<section class="section" id="idp6"><div class="titlepage"><div><div><h4 class="title">6.2.3. 编译安装</h4></div></div></div>
				
				<pre class="screen">
				
git config --global core.autocrlf false				
$ git clone https://github.com/hyperledger/fabric.git 
$ make docker 
$ git clone https://github.com/hyperledger/fabric-ca.git		
$ make docker 

cd fabric/devenv
vagrant box add hyperledger/fabric-baseimage centos7.box
vagrant up

yum -y install epel-release
yum -y install git
yum -y install golang
yum -y install python-pip	
pip install --upgrade backports.ssl_match_hostname
pip install docker-compose

docker-compose -version
				
				</pre>
			</section>
			<section class="section" id="idp7"><div class="titlepage"><div><div><h4 class="title">6.2.4. 启动 docker 虚拟机</h4></div></div></div>
				
				<pre class="screen">
				
git clone https://github.com/yeasy/docker-compose-files
				
				</pre>
				<p>创建文件 docker-compose.yml</p>
				<pre class="screen">
				
[root@localhost ~]# mkdir -p docker
[root@localhost ~]# cd docker
[root@localhost docker]# vim docker-compose.yml

membersrvc:
  image: hyperledger/fabric-membersrvc
  ports:
    - "7054:7054"
  command: membersrvc
vp0:
  image: hyperledger/fabric-peer
  ports:
    - "7050:7050"
    - "7051:7051"
    - "7053:7053"
  environment:
    - CORE_PEER_ADDRESSAUTODETECT=true
    - CORE_VM_ENDPOINT=unix:///var/run/docker.sock
    - CORE_LOGGING_LEVEL=DEBUG
    - CORE_PEER_ID=vp0
    - CORE_PEER_PKI_ECA_PADDR=membersrvc:7054
    - CORE_PEER_PKI_TCA_PADDR=membersrvc:7054
    - CORE_PEER_PKI_TLSCA_PADDR=membersrvc:7054
    - CORE_SECURITY_ENABLED=true
    - CORE_SECURITY_ENROLLID=test_vp0
    - CORE_SECURITY_ENROLLSECRET=MwYpmSRjupbT
  volumes:
      - /var/run/:/var/run/
  links:
    - membersrvc
  command: sh -c "sleep 5; peer node start --peer-chaincodedev"				
				
				</pre>
				<p>启动 Docker</p>
				<pre class="screen">
				
[root@localhost docker]# docker-compose up
Creating test_membersrvc_1
Creating test_vp0_1
Attaching to test_membersrvc_1, test_vp0_1
vp0_1         | 2018-01-19 10:07:27.345 UTC [msp] GetLocalMSP -&gt; DEBU 001 Returning existing local MSP
vp0_1         | 2018-01-19 10:07:27.345 UTC [nodeCmd] serve -&gt; INFO 002 Starting peer:
vp0_1         |  Version: 1.1.0
vp0_1         |  Go version: go1.9.2
vp0_1         |  OS/Arch: linux/amd64
vp0_1         |  Experimental features: false
vp0_1         |  Chaincode:
vp0_1         |   Base Image Version: 0.4.2
vp0_1         |   Base Docker Namespace: hyperledger
vp0_1         |   Base Docker Label: org.hyperledger.fabric
vp0_1         |   Docker Namespace: hyperledger				
				
				</pre>
				<p>查看进程</p>
				<pre class="screen">
				
[root@localhost docker]# docker-compose ps 
      Name                     Command               State                                   Ports                                  
-----------------------------------------------------------------------------------------------------------------------------------
test_membersrvc_1   membersrvc                       Up      0.0.0.0:7054-&gt;7054/tcp                                                 
test_vp0_1          sh -c sleep 5; peer node s ...   Up      0.0.0.0:7050-&gt;7050/tcp, 0.0.0.0:7051-&gt;7051/tcp, 0.0.0.0:7053-&gt;7053/tcp				
				
				</pre>
			</section>
		</section>
		<section class="section" id="idp9"><div class="titlepage"><div><div><h3 class="title">6.3. 部署 chaincode_example</h3></div></div></div>
			
			<section class="section" id=""><div class="titlepage"><div><div><h4 class="title">6.3.1. 部署连</h4></div></div></div>
				
				<pre class="screen">
				
[root@localhost docker]# docker-compose exec vp0 bash
root@dcb09db1cbc8:/go/src/github.com/hyperledger/fabric#				
				
				</pre>
				<p>编译 chaincode_example02</p>
				<pre class="screen">
				
root@dcb09db1cbc8:/go/src/github.com/hyperledger/fabric# cd examples/chaincode/go/chaincode_example02/
root@dcb09db1cbc8:/go/src/github.com/hyperledger/fabric/examples/chaincode/go/chaincode_example02# go build ./chaincode_example02.go

root@dcb09db1cbc8:/go/src/github.com/hyperledger/fabric/examples/chaincode/go/chaincode_example02# ls -l
total 22304
-rwxr-xr-x 1 root root 22826520 Jan 19 11:49 chaincode_example02
-rw-r--r-- 1 root root     5078 Jan 17 12:27 chaincode_example02.go
-rw-r--r-- 1 root root     3165 Jan 17 12:27 chaincode_example02_test.go				
				
				</pre>
				<p>启动 chaincode_example02</p>
				
				<pre class="screen">
				
root@dcb09db1cbc8:/go/src/github.com/hyperledger/fabric/examples/chaincode/go/chaincode_example02# ./chaincode_example02 
2018-01-19 11:56:52.103 UTC [shim] SetupChaincodeLogging -&gt; INFO 001 Chaincode log level not provided; defaulting to: INFO
2018-01-19 11:56:52.104 UTC [shim] SetupChaincodeLogging -&gt; INFO 002 Chaincode (build level: ) starting up ...
				
				</pre>
			</section>
			<section class="section" id=""><div class="titlepage"><div><div><h4 class="title">6.3.2. 测试</h4></div></div></div>
				
				<pre class="screen">
				
peer chaincode deploy -n test_cc -p github.com/hyperledger/fabric/examples/chaincode/go/chaincode_example02 -c '{"Args":["init","a","100","b","200"]}'				
peer chaincode invoke -n test_cc -c '{"Args":["query","a"]}'
peer chaincode invoke -n test_cc -c '{"Args":["query","b"]}'
交易，a向b转账10元，如下：
peer chaincode invoke -n test_cc -c '{"Args":["invoke","a","b","10"]}'				
				
				</pre>
			</section>
		</section>
	</section>

</section><div xmlns="" id="disqus_thread"/><script xmlns="">

var disqus_config = function () {
this.page.url = "http://www.netkiller.cn";  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = 'netkiller'; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};

(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = '//netkiller.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script><noscript xmlns="">Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript><br xmlns=""/><script xmlns="" type="text/javascript" id="clustrmaps" src="//cdn.clustrmaps.com/map_v2.js?u=r5HG&amp;d=9mi5r_kkDC8uxG8HuY3p4-2qgeeVypAK9vMD-2P6BYM"/></body></html>