<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>第 33 章 Network Authentication</title><link rel="stylesheet" href="/docbook.css" type="text/css" /><meta name="generator" content="DocBook XSL Stylesheets V1.75.2" /><link rel="home" href="../index.html" title="Netkiller Linux 手札" /><link rel="up" href="network.application.html" title="部分 II. Network Application" /><link rel="prev" href="ch32s06.html" title="6. Linux" /><link rel="next" href="network.authentication.ldap.html" title="2. OpenLDAP" /><script xmlns="" type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-11694057-1']);
  _gaq.push(['_setDomainName', 'netkiller.sourceforge.net']);
  _gaq.push(['_setAllowHash', 'false']);
  _gaq.push(['_setAllowLinker', true]);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">第 33 章 Network Authentication</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch32s06.html">上一页</a> </td><th width="60%" align="center">部分 II. Network Application</th><td width="20%" align="right"> <a accesskey="n" href="network.authentication.ldap.html">下一页</a></td></tr></table><hr /></div><table xmlns="" width="100%" border="0"><tr><td align="left"><a href="http://netkiller.sourceforge.net/">Home</a> |
                <a href="http://netkiller.github.com/">Mirror</a> |
                <a href="/search.html">Search</a></td><td align="right"><form id="searchbox_008589143145807374698:f5uprauilyy" action="/search.html"><input type="hidden" name="cx" value="008589143145807374698:f5uprauilyy" /><input type="hidden" name="cof" value="FORID:11" /><input name="q" type="text" size="25" style="border-top-width: 1px; border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-top-style: solid; border-right-style: solid; border-bottom-style: solid; border-left-style: solid; border-top-color: rgb(126, 157, 185); border-right-color: rgb(126, 157, 185); border-bottom-color: rgb(126, 157, 185); border-left-color: rgb(126, 157, 185); padding-top: 2px; padding-right: 2px; padding-bottom: 2px; padding-left: 2px; background-image: url(http://www.google.com/cse/intl/en/images/google_custom_search_watermark.gif); background-attachment: initial; background-origin: initial; background-clip: initial; background-color: rgb(255, 255, 255); background-position: 0% 50%; background-repeat: no-repeat no-repeat; " /><input type="submit" name="sa" value="Search" /><input name="siteurl" type="hidden" value="http://netkiller.sourceforge.net/" /></form><script type="text/javascript" src="http://www.google.com/coop/cse/brand?form=searchbox_008589143145807374698%3Af5uprauilyy"></script></td></tr></table><div class="chapter" title="第 33 章 Network Authentication"><div class="titlepage"><div><div><h2 class="title"><a id="network.authentication"></a>第 33 章 Network Authentication</h2></div></div></div><div class="toc"><p><b>目录</b></p><dl><dt><span class="section"><a href="network.authentication.html#nis">1. Network Information Service (NIS)</a></span></dt><dd><dl><dt><span class="section"><a href="network.authentication.html#nis.install">1.1. 安装NIS服务器</a></span></dt><dt><span class="section"><a href="network.authentication.html#nis.server.slave">1.2. Slave NIS Server</a></span></dt><dt><span class="section"><a href="network.authentication.html#nis.client">1.3. 客户机软件安装</a></span></dt><dt><span class="section"><a href="network.authentication.html#nis.authentication">1.4. Authentication Configuration</a></span></dt><dt><span class="section"><a href="network.authentication.html#nis.example">1.5. application example</a></span></dt><dt><span class="section"><a href="network.authentication.html#nis.home">1.6. Mount /home volume from NFS</a></span></dt></dl></dd><dt><span class="section"><a href="network.authentication.ldap.html">2. OpenLDAP</a></span></dt><dd><dl><dt><span class="section"><a href="network.authentication.ldap.html#idp986672">2.1. Server</a></span></dt><dt><span class="section"><a href="network.authentication.ldap.html#idp995552">2.2. Client</a></span></dt><dt><span class="section"><a href="network.authentication.ldap.html#idp1001200">2.3. User and Group Management</a></span></dt></dl></dd><dt><span class="section"><a href="kerberos.html">3. Kerberos</a></span></dt><dd><dl><dt><span class="section"><a href="kerberos.html#kerberos.install">3.1. Kerberos 安装</a></span></dt><dd><dl><dt><span class="section"><a href="kerberos.html#idp1006816">3.1.1. CentOS 安装</a></span></dt><dt><span class="section"><a href="kerberos.html#idp1006944">3.1.2. Install by apt-get</a></span></dt></dl></dd><dt><span class="section"><a href="kerberos.html#kerberos.server">3.2. Kerberos Server</a></span></dt><dt><span class="section"><a href="kerberos.html#kerberos.client">3.3. Kerberos Client</a></span></dt><dt><span class="section"><a href="kerberos.html#kerberos.management">3.4. Kerberos Management</a></span></dt><dd><dl><dt><span class="section"><a href="kerberos.html#idp1049168">3.4.1. ktutil - Kerberos keytab file maintenance utility</a></span></dt><dt><span class="section"><a href="kerberos.html#idp1050608">3.4.2. klist - list cached Kerberos tickets</a></span></dt></dl></dd><dt><span class="section"><a href="kerberos.html#kerberos.openssh">3.5. OpenSSH Authentications</a></span></dt><dd><dl><dt><span class="section"><a href="kerberos.html#idp1052560">3.5.1. Configuring the Application server system</a></span></dt><dt><span class="section"><a href="kerberos.html#idp1054976">3.5.2. Configuring the Application client system</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="freeradius.html">4. FreeRADIUS (Remote Authentication Dial In User Service)</a></span></dt><dd><dl><dt><span class="section"><a href="freeradius.html#freeradius.ldap">4.1. ldap</a></span></dt><dt><span class="section"><a href="freeradius.html#freeradius.mysql">4.2. mysql</a></span></dt><dt><span class="section"><a href="freeradius.html#freeradius.wap2">4.3. WAP2 Enterprise</a></span></dt></dl></dd><dt><span class="section"><a href="sasl.html">5. SASL (Simple Authentication and Security Layer)</a></span></dt><dt><span class="section"><a href="gssapi.html">6. GSSAPI (Generic Security Services Application Program Interface)</a></span></dt></dl></div><div class="section" title="1. Network Information Service (NIS)"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="nis"></a>1. Network Information Service (NIS)</h2></div></div></div><div class="section" title="1.1. 安装NIS服务器"><div class="titlepage"><div><div><h3 class="title"><a id="nis.install"></a>1.1. 安装NIS服务器</h3></div></div></div><div class="procedure" title="过程 33.1. 安装NIS服务器"><a id="idp935936"></a><p class="title"><b>过程 33.1. 安装NIS服务器</b></p><ol class="procedure" type="1"><li class="step" title="步骤 1"><p>ypserv</p><pre class="screen">
				
					# yum install ypserv -y
				
				</pre></li><li class="step" title="步骤 2"><p>/etc/hosts</p><pre class="screen">
				
[root@nis ~]# hostname nis.example.com				
[root@nis ~]# echo "192.168.3.5 nis.example.com" &gt;&gt; /etc/hosts
[root@nis ~]# cat /etc/hosts
# Do not remove the following line, or various programs
# that require network functionality will fail.
127.0.0.1 datacenter.example.com datacenter localhost.localdomain localhost
::1 localhost6.localdomain6 localhost6
127.0.0.1 kerberos.example.com
192.168.3.5 nis.example.com
				
				</pre></li><li class="step" title="步骤 3"><p>设置NIS域名</p><pre class="screen">
				
# nisdomainname example.com
# nisdomainname
example.com
				
				</pre><p>加入 /etc/rc.local 开机脚本</p><pre class="screen">
				
# echo '/bin/nisdomainname example.com' &gt;&gt; /etc/rc.local
# echo 'NISDOMAIN=example.com' &gt;&gt; /etc/sysconfig/network
				
				</pre></li><li class="step" title="步骤 4"><p>设置/etc/ypserv.conf主配置文件</p><p>
				</p><pre class="screen">
				
# vim /etc/ypserv.conf

127.0.0.0/255.255.255.0 : * : * : none
192.168.3.0/255.255.255.0 : * : * : none
* : * : * : deny
				
				</pre></li><li class="step" title="步骤 5"><p>创建 /var/yp/securenets 文件</p><p>securenets 安全配置文件</p><pre class="screen">
				
# vim /var/yp/securenets
host 127.0.0.1
255.255.255.0 192.168.3.0
				
				</pre></li><li class="step" title="步骤 6"><p>启动NIS服务器</p><p>NIS服务器需要portmap服务的支持，并且需要启动ypserv和yppasswdd两个服务</p><pre class="screen">
				
[root@nis ~]# service portmap status
portmap (pid 2336)
is running...
[root@nis ~]# service ypserv start
Starting YP
server services: [ OK ]
[root@nis ~]# service yppasswdd start
Starting YP passwd service: [ OK ]
				
				</pre></li><li class="step" title="步骤 7"><p>构建NIS数据库</p><p>32bit: /usr/lib/yp/ypinit -m</p><p>64bit: /usr/lib64/yp/ypinit -m</p><pre class="screen">
				
[root@nis ~]# /usr/lib64/yp/ypinit -m

At this point, we have to construct a list of the hosts which will run NIS
servers.  nis.example.com is in the list of NIS server hosts.  Please continue to add
the names for the other hosts, one per line.  When you are done with the
list, type a &lt;control D&gt;.
        next host to add:  nis.example.com
        next host to add:
        next host to add:
The current list of NIS servers looks like this:

nis.example.com


Is this correct?  [y/n: y]
We need a few minutes to build the databases...
Building /var/yp/example.com/ypservers...
Running /var/yp/Makefile...
gmake[1]: Entering directory `/var/yp/example.com'
Updating passwd.byname...
Updating passwd.byuid...
Updating group.byname...
Updating group.bygid...
Updating hosts.byname...
Updating hosts.byaddr...
Updating rpc.byname...
Updating rpc.bynumber...
Updating services.byname...
Updating services.byservicename...
Updating netid.byname...
Updating protocols.bynumber...
Updating protocols.byname...
Updating mail.aliases...
gmake[1]: Leaving directory `/var/yp/example.com'

nis.example.com has been set up as a NIS master server.

Now you can run ypinit -s nis.example.com on all slave server.

				
				</pre><p>检查</p><pre class="screen">
				
# ls /var/yp/
binding example.com Makefile nicknames securenets ypservers				
				
				</pre></li><li class="step" title="步骤 8"><p>Service</p><pre class="screen">
				
[root@datacenter ~]# chkconfig --list | grep yp
ypbind          0:off   1:off   2:off   3:off   4:off   5:off   6:off
yppasswdd       0:off   1:off   2:off   3:off   4:off   5:off   6:off
ypserv          0:off   1:off   2:off   3:off   4:off   5:off   6:off
ypxfrd          0:off   1:off   2:off   3:off   4:off   5:off   6:off

[root@nis ~]# chkconfig ypserv on
[root@nis ~]# chkconfig yppasswdd on
				
				</pre></li></ol></div></div><div class="section" title="1.2. Slave NIS Server"><div class="titlepage"><div><div><h3 class="title"><a id="nis.server.slave"></a>1.2. Slave NIS Server</h3></div></div></div><p>Now you can run ypinit -s nis.example.com on all slave server.
		</p><pre class="screen">
		
# ypinit -s nis.example.com		
		
		</pre></div><div class="section" title="1.3. 客户机软件安装"><div class="titlepage"><div><div><h3 class="title"><a id="nis.client"></a>1.3. 客户机软件安装</h3></div></div></div><div class="procedure" title="过程 33.2. 安装NIS客户端软件"><a id="idp954912"></a><p class="title"><b>过程 33.2. 安装NIS客户端软件</b></p><ol class="procedure" type="1"><li class="step" title="步骤 1"><p>NIS客户机需要安装ypbind和yp-tools两个软件包</p><pre class="screen">
				
# yum install ypbind yp-tools -y
				
				</pre></li><li class="step" title="步骤 2"><p>NIS域名</p><pre class="screen">
				
# nisdomainname example.com
				
				</pre></li><li class="step" title="步骤 3"><p>/etc/hosts</p><pre class="screen">
				
192.168.3.5 nis.example.com
				
				</pre></li><li class="step" title="步骤 4"><p>/etc/yp.conf</p><pre class="screen">
				
# vim /etc/yp.conf
domain example.com server nis.example.com
				
				</pre></li><li class="step" title="步骤 5"><p>/etc/nsswitch.conf</p><pre class="screen">
				
# vim /etc/nsswitch.conf
passwd: files nis
shadow: files nis
group: files nis
hosts: files nis dns
				
				</pre></li><li class="step" title="步骤 6"><p>启动ypbind服务程序</p><pre class="screen">
				
[root@test ~]# service portmap status
portmap is stopped
[root@test ~]# service portmap start
Starting portmap: [ OK ]
[root@test ~]# service ypbind start
Turning on allow_ypbind SELinux boolean
Binding to the NIS domain: [ OK ]
Listening for an NIS domain server..
				
				</pre></li><li class="step" title="步骤 7"><p>yp-tools 测试工具</p><p>yptest 命令可对NIS服务器进行自动测试</p><pre class="screen">
				
# yptest	
				
				</pre><p>ypwhich 命令可显示NIS客户机所使用的NIS服务器的主机名称和数据库文件列表</p><pre class="screen">
				
# ypwhich
# ypwhich -x			
				
				</pre><p>ypcat命令显示数据库文件列表和指定数据库的内容</p><pre class="screen">
				
# ypcat -x
# ypcat passwd				
				
				</pre></li><li class="step" title="步骤 8"><p>NIS Client Service</p><pre class="screen">
				
# chkconfig ypbind on				
				
				</pre></li></ol></div></div><div class="section" title="1.4. Authentication Configuration"><div class="titlepage"><div><div><h3 class="title"><a id="nis.authentication"></a>1.4. Authentication Configuration</h3></div></div></div><pre class="screen">
		
# authconfig-tui		
		
		</pre><p>Use NIS</p><pre class="screen">
		
                ┌────────────────┤ Authentication Configuration ├─────────────────┐
                │                                                                 │
                │  User Information        Authentication                         │
                │  [ ] Cache Information   [*] Use MD5 Passwords                  │
                │  [ ] Use Hesiod          [*] Use Shadow Passwords               │
                │  [ ] Use LDAP            [ ] Use LDAP Authentication            │
                │  [*] Use NIS             [ ] Use Kerberos                       │
                │  [ ] Use Winbind         [ ] Use SMB Authentication             │
                │                          [ ] Use Winbind Authentication         │
                │                          [ ] Local authorization is sufficient  │
                │                                                                 │
                │            ┌────────┐                      ┌──────┐             │
                │            │ Cancel │                      │ Next │             │
                │            └────────┘                      └──────┘             │
                │                                                                 │
                │                                                                 │
                └─────────────────────────────────────────────────────────────────┘		
		
		</pre><p>NIS Settings</p><pre class="screen">
		
                        ┌─────────────────┤ NIS Settings ├─────────────────┐
                        │                                                  │
                        │ Domain: example.com_____________________________ │
                        │ Server: nis.example.com_________________________ │
                        │                                                  │
                        │         ┌──────┐                 ┌────┐          │
                        │         │ Back │                 │ Ok │          │
                        │         └──────┘                 └────┘          │
                        │                                                  │
                        │                                                  │
                        └──────────────────────────────────────────────────┘
		
		</pre></div><div class="section" title="1.5. application example"><div class="titlepage"><div><div><h3 class="title"><a id="nis.example"></a>1.5. application example</h3></div></div></div><p>nis server:</p><p>在NIS服务器上创建一个test用户</p><pre class="screen">
		
# adduser test
# passwd test
# /usr/lib64/yp/ypinit -m
		
		</pre><p>nis client</p><p>使用test用户登录到客户机</p><pre class="screen">
		
ssh test@client.example.com		
		
		</pre><p>测试</p><pre class="screen">
		
[root@test ~]# yptest
Test 1: domainname
Configured domainname is "example.com"

Test 2: ypbind
Used NIS server:
nis.example.com

Test 3: yp_match
WARNING: No such key in map (Map
passwd.byname, key nobody)

Test 4: yp_first
neo
neo:$1$e1nd3pts$s7NikMnKwpL4vUp2LM/N9.:500:500::/home/neo:/bin/bash

Test 5: yp_next
test
test:$1$g4.VCB7i$I/N5W/imakprFdtP02i8/.:502:502::/home/test:/bin/bash
svnroot svnroot:!!:501:501::/home/svnroot:/bin/bash

Test 6: yp_master
nis.example.com

Test 7: yp_order
1271936660

Test 8: yp_maplist
rpc.byname
protocols.bynumber
ypservers
passwd.byname
hosts.byname
rpc.bynumber
group.bygid
services.byservicename
mail.aliases
passwd.byuid
services.byname
netid.byname
protocols.byname
group.byname
hosts.byaddr

Test 9: yp_all
neo
neo:$1$e1nd3pts$s7NikMnKwpL4vUp2LM/N9.:500:500::/home/neo:/bin/bash
test
test:$1$g4.VCB7i$I/N5W/imakprFdtP02i8/.:502:502::/home/test:/bin/bash
svnroot svnroot:!!:501:501::/home/svnroot:/bin/bash
1 tests failed		
		
		</pre><p>更改密码</p><pre class="screen">
		
$ yppasswd
Changing NIS account information for test on nis.example.com.
Please enter old password:
Changing NIS password for test on
nis.example.com.
Please enter new password:
Please retype new password:

The NIS password has been changed on nis.example.com.		
		
		</pre><pre class="screen">
		
-bash-3.2$ ypcat hosts 
127.0.0.1 localhost.localdomain localhost 
127.0.0.1 kerberos.example.com
192.168.3.5 nis.example.com

-bash-3.2$ ypcat passwd
neo:$1$e1nd3pts$s7NikMnKwpL4vUp2LM/N9.:500:500::/home/neo:/bin/bash
test:$1$g4.VCB7i$I/N5W/imakprFdtP02i8/.:502:502::/home/test:/bin/bash
svnroot:!!:501:501::/home/svnroot:/bin/bash
		
		</pre><pre class="screen">
		
-bash-3.2$
ypwhich
nis.example.com

ypwhich -x
Use "ethers" for map "ethers.byname"
Use "aliases" for map "mail.aliases"
Use "services" for map "services.byname"
Use "protocols" for map "protocols.bynumber"
Use "hosts" for map "hosts.byname"
Use "networks" for map "networks.byaddr"
Use "group" for map "group.byname"
Use "passwd" for map "passwd.byname"
		
		</pre></div><div class="section" title="1.6. Mount /home volume from NFS"><div class="titlepage"><div><div><h3 class="title"><a id="nis.home"></a>1.6. Mount /home volume from NFS</h3></div></div></div><p>在NIS服务器中将“/home”输出为NFS共享目录</p><pre class="screen">
		
# vi /etc/exports
/home 192.168.3.0/24(sync,rw,no_root_squash)		
		
		</pre><p>重启NFS服务</p><pre class="screen">
		
# service nfs restart
		
		</pre><p>在NIS客户端中挂载“/home”目录</p><pre class="screen">
		
		# vi /etc/fstab
192.168.1.10:/home/ /home nfs 	defaults 0 0		
		
		</pre><p>mount home volume</p><pre class="screen">
		
# mount /home
		
		</pre></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch32s06.html">上一页</a> </td><td width="20%" align="center"><a accesskey="u" href="network.application.html">上一级</a></td><td width="40%" align="right"> <a accesskey="n" href="network.authentication.ldap.html">下一页</a></td></tr><tr><td width="40%" align="left" valign="top">6. Linux </td><td width="20%" align="center"><a accesskey="h" href="../index.html">起始页</a></td><td width="40%" align="right" valign="top"> 2. OpenLDAP</td></tr></table></div></body></html>
