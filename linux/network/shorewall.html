<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>5. Shorewall</title><link rel="stylesheet" href="/docbook.css" type="text/css" /><meta name="generator" content="DocBook XSL Stylesheets V1.75.2" /><link rel="home" href="../index.html" title="Netkiller Linux 手札" /><link rel="up" href="firewall.html" title="第 23 章 Firewall" /><link rel="prev" href="ufw.html" title="4. ufw - program for managing a netfilter firewall" /><link rel="next" href="iptables.gui.html" title="6. Firewall GUI Tools" /><script xmlns="" type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-11694057-1']);
  _gaq.push(['_setDomainName', 'netkiller.sourceforge.net']);
  _gaq.push(['_setAllowHash', 'false']);
  _gaq.push(['_setAllowLinker', true]);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">5. Shorewall</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ufw.html">上一页</a> </td><th width="60%" align="center">第 23 章 Firewall</th><td width="20%" align="right"> <a accesskey="n" href="iptables.gui.html">下一页</a></td></tr></table><hr /></div><table xmlns="" width="100%" border="0"><tr><td align="left"><a href="http://netkiller.sourceforge.net/">Home</a> |
                <a href="http://netkiller.github.com/">Mirror</a> |
                <a href="/search.html">Search</a></td><td align="right"><form id="searchbox_008589143145807374698:f5uprauilyy" action="/search.html"><input type="hidden" name="cx" value="008589143145807374698:f5uprauilyy" /><input type="hidden" name="cof" value="FORID:11" /><input name="q" type="text" size="25" style="border-top-width: 1px; border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-top-style: solid; border-right-style: solid; border-bottom-style: solid; border-left-style: solid; border-top-color: rgb(126, 157, 185); border-right-color: rgb(126, 157, 185); border-bottom-color: rgb(126, 157, 185); border-left-color: rgb(126, 157, 185); padding-top: 2px; padding-right: 2px; padding-bottom: 2px; padding-left: 2px; background-image: url(http://www.google.com/cse/intl/en/images/google_custom_search_watermark.gif); background-attachment: initial; background-origin: initial; background-clip: initial; background-color: rgb(255, 255, 255); background-position: 0% 50%; background-repeat: no-repeat no-repeat; " /><input type="submit" name="sa" value="Search" /><input name="siteurl" type="hidden" value="http://netkiller.sourceforge.net/" /></form><script type="text/javascript" src="http://www.google.com/coop/cse/brand?form=searchbox_008589143145807374698%3Af5uprauilyy"></script></td></tr></table><div class="section" title="5. Shorewall"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="shorewall"></a>5. Shorewall</h2></div></div></div><p><a class="ulink" href="http://www.shorewall.net/" target="_top">Shorewall</a></p><div class="section" title="5.1. Installation Instructions"><div class="titlepage"><div><div><h3 class="title"><a id="shorewall.install"></a>5.1. Installation Instructions</h3></div></div></div><div class="section" title="5.1.1. Install using RPM"><div class="titlepage"><div><div><h4 class="title"><a id="shorewall.rpm"></a>5.1.1. Install using RPM</h4></div></div></div><pre class="screen">
# rpm -ivh http://slovakia.shorewall.net/pub/shorewall/CURRENT_STABLE_VERSION_IS_4.4/shorewall-4.4.25/shorewall-4.4.25-3.noarch.rpm
Retrieving http://slovakia.shorewall.net/pub/shorewall/CURRENT_STABLE_VERSION_IS_4.4/shorewall-4.4.25/shorewall-4.4.25-3.noarch.rpm
warning: /var/tmp/rpm-tmp.qc6WVw: Header V4 DSA/SHA1 Signature, key ID 6c562ac4: NOKEY
Preparing...                ########################################### [100%]
   1:shorewall              ########################################### [100%]
			</pre></div><div class="section" title="5.1.2. Install using apt-get"><div class="titlepage"><div><div><h4 class="title"><a id="shorewall.apt"></a>5.1.2. Install using apt-get</h4></div></div></div><pre class="screen">
netkiller@shenzhen:~$ apt-cache search shorewall
shorewall - Shoreline Firewall (Shorewall), a high-level tool for configuring Netfilter
shorewall-doc - documentation for Shorewall firewall
shorewall-lite - Shorewall (lite version), a high-level tool for configuring Netfilter
netkiller@shenzhen:~$
			</pre><p>install</p><pre class="screen">
sudo apt-get install shorewall
			</pre><p>copy config file to /etc/shorewall/</p><pre class="screen">
sudo cp /usr/share/doc/shorewall/default-config/modules /etc/shorewall/
sudo cp /usr/share/doc/shorewall/default-config/policy /etc/shorewall/
sudo cp /usr/share/doc/shorewall/default-config/nat /etc/shorewall/
sudo cp /usr/share/doc/shorewall/default-config/zones /etc/shorewall/
sudo cp /usr/share/doc/shorewall/default-config/maclist /etc/shorewall/
sudo cp /usr/share/doc/shorewall/default-config/blacklist /etc/shorewall/

sudo cp /usr/share/doc/shorewall/default-config/interfaces /etc/shorewall/
sudo cp /usr/share/doc/shorewall/default-config/rules /etc/shorewall/
sudo cp /usr/share/doc/shorewall/default-config/hosts /etc/shorewall/
sudo cp /usr/share/doc/shorewall/default-config/masq /etc/shorewall/
			</pre></div></div><div class="section" title="5.2. Configuring Shorewall"><div class="titlepage"><div><div><h3 class="title"><a id="shorewall.configuring"></a>5.2. Configuring Shorewall</h3></div></div></div><p></p><div class="procedure" title="过程 23.1. shorewall.conf"><a id="idp623312"></a><p class="title"><b>过程 23.1. shorewall.conf</b></p><ol class="procedure" type="1"><li class="step" title="步骤 1"><p>STARTUP_ENABLED</p><p>STARTUP_ENABLED=No</p><p>改为</p><p>STARTUP_ENABLED=Yes</p></li><li class="step" title="步骤 2"><p>IP_FORWARDING</p><p>IP_FORWARDING关闭与开启</p><p>IP_FORWARDING=On</p><p>IP_FORWARDING=Off</p><pre class="screen">
IP_FORWARDING=On
				</pre></li><li class="step" title="步骤 3"><p></p><p></p><pre class="screen">

				</pre></li><li class="step" title="步骤 4"><p></p><pre class="screen">

				</pre></li><li class="step" title="步骤 5"><p></p><p></p><p></p><pre class="screen">
				</pre></li><li class="step" title="步骤 6"><p></p><p></p><p></p><p></p><pre class="screen">
				</pre></li><li class="step" title="步骤 7"><p>启动防火墙</p><p>sudo shorewall start</p></li></ol></div><div class="section" title="5.2.1. zones"><div class="titlepage"><div><div><h4 class="title"><a id="idp633664"></a>5.2.1. zones</h4></div></div></div><pre class="screen">
# cat /etc/shorewall/zones
#
# Shorewall version 4 - Zones File
#
# For information about this file, type "man shorewall-zones"
#
# The manpage is also online at
# http://www.shorewall.net/manpages/shorewall-zones.html
#
###############################################################################
#ZONE   TYPE            OPTIONS         IN                      OUT
#                                       OPTIONS                 OPTIONS
#fw     firewall
ouside  wan
inside  lan
dmz     dmz
			</pre></div><div class="section" title="5.2.2. policy"><div class="titlepage"><div><div><h4 class="title"><a id="idp635120"></a>5.2.2. policy</h4></div></div></div><pre class="screen">
# cat /etc/shorewall/policy
#
# Shorewall version 4 - Policy File
#
# For information about entries in this file, type "man shorewall-policy"
#
# The manpage is also online at
# http://www.shorewall.net/manpages/shorewall-policy.html
#
###############################################################################
#SOURCE DEST    POLICY          LOG     LIMIT:          CONNLIMIT:
#                               LEVEL   BURST           MASK
inside  outside ACCEPT
dmz     outside ACCEPT
inside  dmz     ACCEPT

outside all     DROP
all     all     REJECT

			</pre></div><div class="section" title="5.2.3. interfaces"><div class="titlepage"><div><div><h4 class="title"><a id="idp636640"></a>5.2.3. interfaces</h4></div></div></div><pre class="screen">
# cat /etc/shorewall/interfaces
#
# Shorewall version 4 - Interfaces File
#
# For information about entries in this file, type "man shorewall-interfaces"
#
# The manpage is also online at
# http://www.shorewall.net/manpages/shorewall-interfaces.html
#
###############################################################################
#ZONE   INTERFACE       BROADCAST       OPTIONS
outside eth0    detect
inside  eth1    detect
dmz     eth2    detect
			</pre></div><div class="section" title="5.2.4. masq"><div class="titlepage"><div><div><h4 class="title"><a id="idp638048"></a>5.2.4. masq</h4></div></div></div><pre class="screen">
# cat /etc/shorewall/masq
#
# Shorewall version 4 - Masq file
#
# For information about entries in this file, type "man shorewall-masq"
#
# The manpage is also online at
# http://www.shorewall.net/manpages/shorewall-masq.html
#
#############################################################################################
#INTERFACE:DEST         SOURCE          ADDRESS         PROTO   PORT(S) IPSEC   MARK    USER/
#                                                                                       GROUP
eth0    192.168.0.0/24
			</pre></div><div class="section" title="5.2.5. rules"><div class="titlepage"><div><div><h4 class="title"><a id="idp639552"></a>5.2.5. rules</h4></div></div></div><pre class="screen">
# cat /etc/shorewall/rules
#
# Shorewall version 4 - Rules File
#
# For information on the settings in this file, type "man shorewall-rules"
#
# The manpage is also online at
# http://www.shorewall.net/manpages/shorewall-rules.html
#
######################################################################################################################################################################################
#ACTION         SOURCE          DEST            PROTO   DEST    SOURCE          ORIGINAL        RATE            USER/   MARK    CONNLIMIT       TIME         HEADERS         SWITCH
#                                                       PORT    PORT(S)         DEST            LIMIT           GROUP
#SECTION BLACKLIST
#SECTION ALL
#SECTION ESTABLISHED
#SECTION RELATED
SECTION NEW
ACCEPT  any     outside tcp     http
ACCEPT  any     inside  tcp     http
ACCEPT  dmz     inside  tcp     smtp
ACCEPT 	any 	inside	tcp 	ssh
ACCEPT 	any 	dmz		tcp 	ssh
ACCEPT 	dmz 	any		tcp 	ssh
SSH(ACCEPT) net all        -           -            -         -                s:1/min:3
			</pre></div><div class="section" title="5.2.6. params"><div class="titlepage"><div><div><h4 class="title"><a id="idp641600"></a>5.2.6. params</h4></div></div></div><pre class="screen">
# cat /etc/shorewall/params
#
# Shorewall version 4 - Params File
#
# /etc/shorewall/params
#
#       Assign any variables that you need here.
#
#       It is suggested that variable names begin with an upper case letter
#       to distinguish them from variables used internally within the
#       Shorewall programs
#
#       Example:
#
#               NET_IF=eth0
#               NET_BCAST=130.252.100.255
#               NET_OPTIONS=routefilter,norfc1918
#
#       Example (/etc/shorewall/interfaces record):
#
#               net     $NET_IF         $NET_BCAST      $NET_OPTIONS
#
#       The result will be the same as if the record had been written
#
#               net     eth0            130.252.100.255 routefilter,norfc1918
#
###############################################################################

#LAST LINE -- DO NOT REMOVE

			</pre></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ufw.html">上一页</a> </td><td width="20%" align="center"><a accesskey="u" href="firewall.html">上一级</a></td><td width="40%" align="right"> <a accesskey="n" href="iptables.gui.html">下一页</a></td></tr><tr><td width="40%" align="left" valign="top">4. ufw - program for managing a netfilter firewall </td><td width="20%" align="center"><a accesskey="h" href="../index.html">起始页</a></td><td width="40%" align="right" valign="top"> 6. Firewall GUI Tools</td></tr></table></div></body></html>
