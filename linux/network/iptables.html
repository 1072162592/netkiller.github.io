<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>2. iptables - administration tools for packet filtering and NAT</title><link rel="stylesheet" href="/docbook.css" type="text/css" /><meta name="generator" content="DocBook XSL Stylesheets V1.75.2" /><link rel="home" href="../index.html" title="Netkiller Linux 手札" /><link rel="up" href="firewall.html" title="第 22 章 Firewall" /><link rel="prev" href="firewall.html" title="第 22 章 Firewall" /><link rel="next" href="ulogd.html" title="3. ulogd - The Netfilter Userspace Logging Daemon" /><script xmlns="" type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-11694057-1']);
  _gaq.push(['_setDomainName', 'netkiller.sourceforge.net']);
  _gaq.push(['_setAllowHash', 'false']);
  _gaq.push(['_setAllowLinker', true]);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">2. iptables - administration tools for packet filtering and NAT</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="firewall.html">上一页</a> </td><th width="60%" align="center">第 22 章 Firewall</th><td width="20%" align="right"> <a accesskey="n" href="ulogd.html">下一页</a></td></tr></table><hr /></div><table xmlns="" width="100%" border="0"><tr><td align="left"><a href="http://netkiller.sourceforge.net/">Home</a> |
                <a href="http://netkiller.github.com/">Mirror</a> |
                <a href="/search.html">Search</a></td><td align="right"><form id="searchbox_008589143145807374698:f5uprauilyy" action="/search.html"><input type="hidden" name="cx" value="008589143145807374698:f5uprauilyy" /><input type="hidden" name="cof" value="FORID:11" /><input name="q" type="text" size="25" style="border-top-width: 1px; border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-top-style: solid; border-right-style: solid; border-bottom-style: solid; border-left-style: solid; border-top-color: rgb(126, 157, 185); border-right-color: rgb(126, 157, 185); border-bottom-color: rgb(126, 157, 185); border-left-color: rgb(126, 157, 185); padding-top: 2px; padding-right: 2px; padding-bottom: 2px; padding-left: 2px; background-image: url(http://www.google.com/cse/intl/en/images/google_custom_search_watermark.gif); background-attachment: initial; background-origin: initial; background-clip: initial; background-color: rgb(255, 255, 255); background-position: 0% 50%; background-repeat: no-repeat no-repeat; " /><input type="submit" name="sa" value="Search" /><input name="siteurl" type="hidden" value="http://netkiller.sourceforge.net/" /></form><script type="text/javascript" src="http://www.google.com/coop/cse/brand?form=searchbox_008589143145807374698%3Af5uprauilyy"></script></td></tr></table><div class="section" title="2. iptables - administration tools for packet filtering and NAT"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="iptables"></a>2. iptables - administration tools for packet filtering and NAT</h2></div></div></div><p><a class="ulink" href="http://netkiller.8800.org/book/iptables/" target="_top">Linux Iptables Manual</a></p><pre class="screen">
	
      Incoming
       Traffic
          |
          |
          V
     +----------+
     |PREROUTING|
     +----------+
     |   raw    |  &lt;--------------+
     |  mangle  |                 |
     |   nat    |                 |
     +----------+                 |
          |                       |
          |                       |
       Routing                    |
    +- Decision -+                |
    |            |                |
    |            |                |
    V            V                |
  Local        Remote             |
Destination   Destination         |
    |            |                |
    |            |                |
    V            V                |
+--------+  +---------+           |
| INPUT  |  | FORWARD |           |
+--------+  +---------+           |
| mangle |  | mangle  |           |
| filter |  | filter  |           |
+--------+  +---------+           |
    |            |                |
    |            |                |
    V            |                |
  Local          |                |
 Machine         |                |
    |            |                |
    |            |                |
    V            |                |
 Routing         |                |
 Decision        |                |
    |            |                |
    |            |                |
    V            |                |
+--------+       |                |
| OUTPUT |       |                |
+--------+       |                |
|  raw   |       |                |
| mangle |       |                |
|  nat   |       |                |
| filter |       |                |
+--------+       |                |
    |            |                |
    |      +-------------+        |
    |      | POSTROUTING |      Local
    +----&gt; +-------------+ --&gt; Traffic
           |   mangle    |
           |     nat     |
           +-------------+
                 |
                 |
                 V
              Outgoing
              Traffic	
	
	</pre><div class="section" title="2.1. Getting Started"><div class="titlepage"><div><div><h3 class="title"><a id="idp506256"></a>2.1. Getting Started</h3></div></div></div><p>Redhat / CentOS</p><p>You can check to see if iptables is installed on your system by:</p><pre class="screen">
[root@database ~]# rpm -q iptables
iptables-1.3.5-5.3.el5_4.1		
		</pre><p>And to see if iptables is actually running, we can check that the iptables modules are loaded and use the -L switch to inspect the currently loaded rules:</p><pre class="screen">
[root@database ~]# lsmod | grep ip_tables
ip_tables              55201  2 iptable_nat,iptable_filter
x_tables               50505  6 ipt_MASQUERADE,iptable_nat,xt_state,ipt_REJECT,xt_tcpudp,ip_tables
		
		</pre><pre class="screen">
[root@database ~]# iptables -L
Chain INPUT (policy ACCEPT)
target     prot opt source               destination
ACCEPT     udp  --  anywhere             anywhere            udp dpt:domain
ACCEPT     tcp  --  anywhere             anywhere            tcp dpt:domain
ACCEPT     udp  --  anywhere             anywhere            udp dpt:bootps
ACCEPT     tcp  --  anywhere             anywhere            tcp dpt:bootps

Chain FORWARD (policy ACCEPT)
target     prot opt source               destination
ACCEPT     all  --  anywhere             192.168.122.0/24    state RELATED,ESTABLISHED
ACCEPT     all  --  192.168.122.0/24     anywhere
ACCEPT     all  --  anywhere             anywhere
REJECT     all  --  anywhere             anywhere            reject-with icmp-port-unreachable
REJECT     all  --  anywhere             anywhere            reject-with icmp-port-unreachable

Chain OUTPUT (policy ACCEPT)
target     prot opt source               destination
		
		</pre><p>If iptables is not running, you can enable it by running:</p><pre class="screen">
# system-config-securitylevel		
		</pre></div><div class="section" title="2.2. User-defined Chain"><div class="titlepage"><div><div><h3 class="title"><a id="idp511360"></a>2.2. User-defined Chain</h3></div></div></div><div class="section" title="2.2.1. Chains List"><div class="titlepage"><div><div><h4 class="title"><a id="idp511744"></a>2.2.1. Chains List</h4></div></div></div><p>列出规则链</p><pre class="screen">
 列出INPUT,OUTPUT,FORWARD规则
iptables -L

列出NAT规则
iptables -t nat -L

列出过滤规则
iptables -t filter -L
			</pre></div><div class="section" title="2.2.2. Chains Refresh"><div class="titlepage"><div><div><h4 class="title"><a id="idp513280"></a>2.2.2. Chains Refresh</h4></div></div></div><p>刷新规则</p><pre class="screen">
/sbin/iptables -F
/sbin/iptables -F -t filter 
/sbin/iptables -F -t nat  
/sbin/iptables -t nat -P PREROUTING ACCEPT 
/sbin/iptables -t nat -P POSTROUTING ACCEPT 
/sbin/iptables -t nat -P OUTPUT ACCEPT
/sbin/iptables -P INPUT ACCEPT 
/sbin/iptables -P OUTPUT ACCEPT 
/sbin/iptables -P FORWARD ACCEPT
			</pre></div><div class="section" title="2.2.3. Chains Admin"><div class="titlepage"><div><div><h4 class="title"><a id="idp514832"></a>2.2.3. Chains Admin</h4></div></div></div><p>创建新链</p><pre class="screen">
				iptables -N netkiller		
			</pre><p>删除新链</p><pre class="screen">
				# iptables -X netkiller
			</pre></div></div><div class="section" title="2.3. Common Chains Filtering"><div class="titlepage"><div><div><h3 class="title"><a id="idp516976"></a>2.3. Common Chains Filtering</h3></div></div></div><div class="section" title="2.3.1. INPUT Rule Chains"><div class="titlepage"><div><div><h4 class="title"><a id="idp517360"></a>2.3.1. INPUT Rule Chains</h4></div></div></div><div class="section" title="2.3.1.1. OpenSSH"><div class="titlepage"><div><div><h5 class="title"><a id="idp517952"></a>2.3.1.1. OpenSSH</h5></div></div></div><pre class="screen">
# Accept tcp packets on destination port 22 (SSH)
 iptables -A INPUT -p tcp --dport 22 -j ACCEPT

# Accept tcp packets on destination port 22 (SSH) from private LAN
 iptables -A INPUT -p tcp -s 192.168.0.0/24 --dport 22 -j ACCEPT			
			</pre></div><div class="section" title="2.3.1.2. FTP"><div class="titlepage"><div><div><h5 class="title"><a id="idp519216"></a>2.3.1.2. FTP</h5></div></div></div><pre class="screen">
/sbin/iptables -A INPUT -p tcp --dport 21 -j ACCEPT 
/sbin/iptables -A INPUT -p tcp --dport 20 -j ACCEPT				
			</pre></div><div class="section" title="2.3.1.3. DNS"><div class="titlepage"><div><div><h5 class="title"><a id="idp520288"></a>2.3.1.3. DNS</h5></div></div></div><pre class="screen">
iptables -A INPUT -i eth0 -p tcp --dport 53   -j ACCEPT
iptables -A INPUT -i eth0 -p udp --dport 53   -j ACCEPT				
			</pre></div><div class="section" title="2.3.1.4. WWW"><div class="titlepage"><div><div><h5 class="title"><a id="idp521376"></a>2.3.1.4. WWW</h5></div></div></div><pre class="screen">
# WWW
/sbin/iptables -A INPUT -p tcp --dport 80 -j ACCEPT
# HTTPS
/sbin/iptables -A INPUT -p tcp --dport 443 -j ACCEPT
# Tomcat
/sbin/iptables -A INPUT -p tcp --dport 8080 -j ACCEPT		
			</pre></div><div class="section" title="2.3.1.5. SOCKS5"><div class="titlepage"><div><div><h5 class="title"><a id="idp522528"></a>2.3.1.5. SOCKS5</h5></div></div></div><pre class="screen">  
/sbin/iptables -A INPUT -p tcp --dport 1080 -j ACCEPT				
			</pre></div><div class="section" title="2.3.1.6. Mail Server"><div class="titlepage"><div><div><h5 class="title"><a id="idp523552"></a>2.3.1.6. Mail Server</h5></div></div></div><pre class="screen">
# SMTP
/sbin/iptables -A INPUT -p tcp --dport 25 -j ACCEPT 
# SMTPS
/sbin/iptables -A INPUT -p tcp --dport 465 -j ACCEPT
# POP3
/sbin/iptables -A INPUT -p tcp --dport 110 -j ACCEPT
# POP3S
/sbin/iptables -A INPUT -p tcp --dport 995 -j ACCEPT
# IMAP
/sbin/iptables -A INPUT -p tcp --dport 143 -j ACCEPT
# IMAPS
/sbin/iptables -A INPUT -p tcp --dport 993 -j ACCEPT				
			</pre></div><div class="section" title="2.3.1.7. MySQL"><div class="titlepage"><div><div><h5 class="title"><a id="idp524880"></a>2.3.1.7. MySQL</h5></div></div></div><pre class="screen">
/sbin/iptables -A INPUT -p tcp --dport 3306 -j ACCEPT				
			</pre></div><div class="section" title="2.3.1.8. PostgreSQL"><div class="titlepage"><div><div><h5 class="title"><a id="idp525904"></a>2.3.1.8. PostgreSQL</h5></div></div></div><pre class="screen">
/sbin/iptables -A INPUT -p tcp --dport 5432 -j ACCEPT				
			</pre></div><div class="section" title="2.3.1.9. DHCP"><div class="titlepage"><div><div><h5 class="title"><a id="idp526928"></a>2.3.1.9. DHCP</h5></div></div></div><pre class="screen">
iptables -A INPUT -p UDP -i eth0 --dport 67 -j ACCEPT
iptables -A INPUT -p UDP -i eth0 --dport 68 -j ACCEPT			
			</pre></div><div class="section" title="2.3.1.10. Samba"><div class="titlepage"><div><div><h5 class="title"><a id="idp528000"></a>2.3.1.10. Samba</h5></div></div></div><pre class="screen">
/sbin/iptables -A INPUT -p tcp -s 192.168.0.0/24 --dport 137 -j ACCEPT
iptables -A INPUT -p tcp -s 192.168.0.0/24 --dport 145 -j ACCEPT
iptables -A INPUT -p udp -s 192.168.0.0/24 --dport 138 -j ACCEPT
iptables -A INPUT -p udp -s 192.168.0.0/24 --dport 139 -j ACCEPT
			</pre></div><div class="section" title="2.3.1.11. ICMP"><div class="titlepage"><div><div><h5 class="title"><a id="idp529232"></a>2.3.1.11. ICMP</h5></div></div></div><div class="literallayout"><p><br />
accept_redirects<br />
# echo "0" &gt; /proc/sys/net/ipv4/conf/all/accept_redirects<br />
or<br />
# sysctl net.ipv4.conf.all.accept_redirects="0"<br />
				<br />
			</p></div><pre class="screen">
使自己不能ping 通 127.0.0.1
iptables -A INPUT -s 127.0.0.1 -p icmp -j DROP

192.168.0.0/24 网段无法ping能本机
iptables -A INPUT -s 192.168.0.0/24 -p icmp -j DROP

禁所有机器
# iptables -A INPUT -s 0/0 -p icmp -j DROP

# ICMP(PING) 接受 ! echo-request
iptables -A INPUT -p icmp --icmp-type ! echo-request -j ACCEPT 				
			</pre></div><div class="section" title="2.3.1.12. 禁止IP访问自己"><div class="titlepage"><div><div><h5 class="title"><a id="idp531472"></a>2.3.1.12. 禁止IP访问自己</h5></div></div></div><pre class="screen">
$sudo iptables -A INPUT -d 192.168.0.253 -j DROP			
			</pre></div><div class="section" title="2.3.1.13. DENY"><div class="titlepage"><div><div><h5 class="title"><a id="idp532496"></a>2.3.1.13. DENY</h5></div></div></div><pre class="screen">
iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT 
iptables -A INPUT -j DROP
			</pre></div></div><div class="section" title="2.3.2. OUTPUT Rule Chains"><div class="titlepage"><div><div><h4 class="title"><a id="idp517488"></a>2.3.2. OUTPUT Rule Chains</h4></div></div></div><div class="section" title="2.3.2.1. outbound"><div class="titlepage"><div><div><h5 class="title"><a id="idp533808"></a>2.3.2.1. outbound</h5></div></div></div><pre class="screen">
# Open ports for outbound established connections
$IPT -A OUTPUT -p tcp -s $NET -d 0/0 --destination-port 1:65535 -j ACCEPT
$IPT -A OUTPUT -p udp -s $NET -d 0/0 --destination-port 1:65535 -j ACCEPT				
			</pre></div><div class="section" title="2.3.2.2. ICMP"><div class="titlepage"><div><div><h5 class="title"><a id="idp535072"></a>2.3.2.2. ICMP</h5></div></div></div><div class="literallayout"><p><br />
本地不允许ping 192.168.0.0/24<br />
iptables -A OUTPUT -s 192.168.0.0/24 -p icmp -j DROP<br />
<br />
禁所本地ping任何机器<br />
# iptables -A OUTPUT -s 0/0 -p icmp -j DROP<br />
<br />
# ICMP(PING) 接受 ! echo-request<br />
iptables -A OUTPUT -p icmp --icmp-type ! echo-request -j ACCEPT				<br />
			</p></div></div><div class="section" title="2.3.2.3. 禁止自己访问某个IP"><div class="titlepage"><div><div><h5 class="title"><a id="idp536576"></a>2.3.2.3. 禁止自己访问某个IP</h5></div></div></div><pre class="screen">
# iptables -A OUTPUT -d 192.168.0.253 -j DROP		
iptables -A OUTPUT -p udp -j DROP
iptables -A OUTPUT -d 125.211.210.46 -j DROP		
			</pre></div></div><div class="section" title="2.3.3. Forward"><div class="titlepage"><div><div><h4 class="title"><a id="idp537680"></a>2.3.3. Forward</h4></div></div></div><pre class="screen">
iptables -A FORWARD -i eth1 -j ACCEPT
		</pre><pre class="screen">
# Network 1 forwarded outgoing client request to network 2 
iptables -A FORWARD -i eth1 -p tcp -s 192.168.1.0/24 -d 192.168.2.0/24 -m state --state NEW,ESTABLISHED -j ACCEPT
iptables -A FORWARD -o eth1 -p tcp -s 192.168.2.0/24 -d 192.168.1.0/24 -m state --state ESTABLISHED,RELATED -j ACCEPT			
		</pre><div class="section" title="2.3.3.1. TCPMSS"><div class="titlepage"><div><div><h5 class="title"><a id="idp539504"></a>2.3.3.1. TCPMSS</h5></div></div></div><pre class="screen">
iptables -A FORWARD -p tcp --tcp-flags SYN,RST SYN -j TCPMSS --clamp-mss-to-pmtu
			</pre></div></div><div class="section" title="2.3.4. Malicious Software and Spoofed IP Addresses"><div class="titlepage"><div><div><h4 class="title"><a id="idp540480"></a>2.3.4. Malicious Software and Spoofed IP Addresses</h4></div></div></div><pre class="screen">
# The following rules drop all TCP traffic that attempts to use port 31337:
iptables -A OUTPUT -o eth0 -p tcp --dport 31337 --sport 31337 -j DROP
iptables -A FORWARD -o eth0 -p tcp --dport 31337 --sport 31337 -j DROP
		</pre></div></div><div class="section" title="2.4. Interfaces"><div class="titlepage"><div><div><h3 class="title"><a id="idp541664"></a>2.4. Interfaces</h3></div></div></div><pre class="screen">
iptables -A INPUT -i lo -j ACCEPT
iptables -A INPUT -i eth0 -j ACCEPT
iptables -A INPUT -i ppp0 -j ACCEPT		
		</pre></div><div class="section" title="2.5. IP Addresses"><div class="titlepage"><div><div><h3 class="title"><a id="idp542704"></a>2.5. IP Addresses</h3></div></div></div><pre class="screen">
# Accept packets from trusted IP addresses
 iptables -A INPUT -s 192.168.0.4 -j ACCEPT # change the IP address as appropriate

# Accept packets from trusted IP addresses
 iptables -A INPUT -s 192.168.0.0/24 -j ACCEPT  # using standard slash notation
 iptables -A INPUT -s 192.168.0.0/255.255.255.0 -j ACCEPT # using a subnet mask


# Accept packets from trusted IP addresses
 iptables -A INPUT -s 192.168.0.4 -m mac --mac-source 00:50:8D:FD:E6:32 -j ACCEPT		
		</pre></div><div class="section" title="2.6. Ports and Protocols"><div class="titlepage"><div><div><h3 class="title"><a id="idp544128"></a>2.6. Ports and Protocols</h3></div></div></div><pre class="screen">
# Accept tcp packets on destination port 6881 (bittorrent)
 iptables -A INPUT -p tcp --dport 6881 -j ACCEPT

# Accept tcp packets on destination ports 6881-6890
 iptables -A INPUT -p tcp --dport 6881:6890 -j ACCEPT		
		</pre></div><div class="section" title="2.7. IPTables and Connection Tracking"><div class="titlepage"><div><div><h3 class="title"><a id="idp545312"></a>2.7. IPTables and Connection Tracking</h3></div></div></div><div class="literallayout"><p><br />
NEW — A packet requesting a new connection, such as an HTTP request.<br />
<br />
ESTABLISHED — A packet that is part of an existing connection.<br />
<br />
RELATED — A packet that is requesting a new connection but is part of an existing connection. For example, FTP uses port 21 to establish a connection, but data is transferred on a different port (typically port 20).<br />
<br />
INVALID — A packet that is not part of any connections in the connection tracking table.		<br />
		</p></div><pre class="screen">
iptables -A FORWARD -m state --state ESTABLISHED,RELATED -j ACCEPT		
		</pre></div><div class="section" title="2.8. NAT"><div class="titlepage"><div><div><h3 class="title"><a id="idp547536"></a>2.8. NAT</h3></div></div></div><div class="section" title="2.8.1. Redirect"><div class="titlepage"><div><div><h4 class="title"><a id="idp547920"></a>2.8.1. Redirect</h4></div></div></div><p>重定向规则</p><pre class="screen">
端口重定向
# iptables -t nat -A PREROUTING -i eth0 -p tcp --dport 21 -j REDIRECT --to-port 2401

将80端口重定向到8080
# iptables -t nat -A PREROUTING -j REDIRECT -p tcp --destination-port 80 --to-ports 8080
			</pre><p>端口转发</p><pre class="screen">
echo 1 &gt; /proc/sys/net/ipv4/ip_forward
iptables -t nat -A PREROUTING -d 192.168.3.9 -p tcp -m tcp --dport 1000 -j DNAT --to-destination 192.168.3.137:8080
iptables -t nat -A POSTROUTING -s 192.168.3.0/255.255.255.0 -d 192.168.3.137 -p tcp -m tcp --dport 8080 -j SNAT --to-source 192.168.3.9			
			</pre></div><div class="section" title="2.8.2. Postrouting and IP Masquerading"><div class="titlepage"><div><div><h4 class="title"><a id="idp550688"></a>2.8.2. Postrouting and IP Masquerading</h4></div></div></div><pre class="screen">
			
iptables -P FORWARD ACCEPT
iptables -t nat -A POSTROUTING -o ppp0 -j MASQUERADE
			
iptables -t nat -A POSTROUTING -s 192.168.0.0/24 -j MASQUERADE
iptables -t nat -A POSTROUTING -s 192.168.1.0/24 -o eth0 -j MASQUERADE
				
sudo iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
sudo iptables -t nat -I POSTROUTING -j MASQUERADE
sudo iptables -t nat -A POSTROUTING -j MASQUERADE -s 172.16.0.0/24 -d 0.0.0.0/0
sudo iptables -t nat -A POSTROUTING -j MASQUERADE -o eth1 -s 172.16.1.0/24 -d 0.0.0.0/0
sudo iptables -t nat -A POSTROUTING -j MASQUERADE -p tcp -o eth1 -s 172.16.1.0/24 -d 0.0.0.0/0
			
			</pre></div><div class="section" title="2.8.3. Prerouting"><div class="titlepage"><div><div><h4 class="title"><a id="idp552272"></a>2.8.3. Prerouting</h4></div></div></div><pre class="screen">		
iptables -t nat -A PREROUTING -i eth0 -p tcp --dport 80 -j DNAT --to 172.31.0.23:80		
		</pre><p>If you have a default policy of DROP in your FORWARD chain, you must append a rule to forward all incoming HTTP requests so that destination NAT routing is possible. To do this, use the following command:</p><pre class="screen">
iptables -A FORWARD -i eth0 -p tcp --dport 80 -d 172.31.0.23 -j ACCEPT		
		</pre><p>This rule forwards all incoming HTTP requests from the firewall to the intended destination; the Apache HTTP Server behind the firewall.</p></div><div class="section" title="2.8.4. DNAT and SNAT"><div class="titlepage"><div><div><h4 class="title"><a id="idp554752"></a>2.8.4. DNAT and SNAT</h4></div></div></div><pre class="screen">
echo 1 &gt; /proc/sys/net/ipv4/ip_forward
iptables -t nat -A PREROUTING -d 202.103.96.10 -j DNAT --to-destination 192.168.0.10
iptables -t nat -A POSTROUTING -s 192.168.0.0/24 -j SNAT --to-source 202.96.244.56
		</pre></div><div class="section" title="2.8.5. DMZ zone"><div class="titlepage"><div><div><h4 class="title"><a id="idp556016"></a>2.8.5. DMZ zone</h4></div></div></div><pre class="screen">
#
# DMZ zone
#
$iptables -t nat -A PREROUTING -p TCP -m multiport -i eth0 --dport 22,25,113,80,8080 -j DNAT --to 10.0.0.10
$iptables -t nat -A PREROUTING -p UDP -i eth0 --dport 25 -j DNAT --to-destination 10.0.0.10
			</pre><p>DNAT ppp0/eth0</p><pre class="screen">
			
iptables -t nat -A PREROUTING -p tcp -i ppp0 --dport 80 -j DNAT --to-destination &lt;web server ip&gt;
iptables -t nat -A PREROUTING -i eth0 -p tcp --dport 80 -j DNAT --to-destination 10.0.4.2:80			
			
			</pre></div></div><div class="section" title="2.9. IPV6"><div class="titlepage"><div><div><h3 class="title"><a id="idp558240"></a>2.9. IPV6</h3></div></div></div><pre class="screen">
		
[root@linux iptables]# modprobe ipv6
[root@linux iptables]# modprobe ip6_tables
[root@linux iptables]# [ ! -f /proc/net/ip6_tables_names ] &amp;&amp; echo "Current kernel doesn't support? 'ip6tables' firewalling (IPv6)!"
[root@linux iptables]# ip6tables -A INPUT -i eth0 -p tcp -s 3ffe:ffff:100::1/128 --dport 22 -j ACCEPT			
		
		</pre></div><div class="section" title="2.10. iptables-xml - Convert iptables-save format to XML"><div class="titlepage"><div><div><h3 class="title"><a id="idp559488"></a>2.10. iptables-xml - Convert iptables-save format to XML</h3></div></div></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="firewall.html">上一页</a> </td><td width="20%" align="center"><a accesskey="u" href="firewall.html">上一级</a></td><td width="40%" align="right"> <a accesskey="n" href="ulogd.html">下一页</a></td></tr><tr><td width="40%" align="left" valign="top">第 22 章 Firewall </td><td width="20%" align="center"><a accesskey="h" href="../index.html">起始页</a></td><td width="40%" align="right" valign="top"> 3. ulogd - The Netfilter Userspace Logging Daemon</td></tr></table></div></body></html>
