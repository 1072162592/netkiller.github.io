<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>第 4 章 MySQL Server</title><link rel="stylesheet" href="/docbook.css" type="text/css" /><meta name="generator" content="DocBook XSL Stylesheets V1.75.2" /><meta name="keywords" content="MySQL, PostgreSQL, Oracle, NoSQL, ER, TokyoCabinet/Tyrant, Memcache, Membase, Redis, Flare, Voldemort, LevelDB, MongoDB, GreenSQL, RDBMS, ORDBMS" /><link rel="home" href="../index.html" title="Netkiller Database 手札" /><link rel="up" href="index.html" title="部分 II. MySQL" /><link rel="prev" href="index.html" title="部分 II. MySQL" /><link rel="next" href="my.cnf.html" title="2. my.cnf" /><script xmlns="" type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-11694057-1']);
  _gaq.push(['_setDomainName', 'netkiller.sourceforge.net']);
  _gaq.push(['_setAllowHash', 'false']);
  _gaq.push(['_setAllowLinker', true]);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">第 4 章 MySQL Server</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="index.html">上一页</a> </td><th width="60%" align="center">部分 II. MySQL</th><td width="20%" align="right"> <a accesskey="n" href="my.cnf.html">下一页</a></td></tr></table><hr /></div><table xmlns="" width="100%" border="0"><tr><td align="left"><a href="http://netkiller.sourceforge.net/">Home</a> |
                <a href="http://netkiller.github.com/">Mirror</a> |
                <a href="/search.html">Search</a></td><td align="right"><form id="searchbox_008589143145807374698:f5uprauilyy" action="/search.html"><input type="hidden" name="cx" value="008589143145807374698:f5uprauilyy" /><input type="hidden" name="cof" value="FORID:11" /><input name="q" type="text" size="25" style="border-top-width: 1px; border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-top-style: solid; border-right-style: solid; border-bottom-style: solid; border-left-style: solid; border-top-color: rgb(126, 157, 185); border-right-color: rgb(126, 157, 185); border-bottom-color: rgb(126, 157, 185); border-left-color: rgb(126, 157, 185); padding-top: 2px; padding-right: 2px; padding-bottom: 2px; padding-left: 2px; background-image: url(http://www.google.com/cse/intl/en/images/google_custom_search_watermark.gif); background-attachment: initial; background-origin: initial; background-clip: initial; background-color: rgb(255, 255, 255); background-position: 0% 50%; background-repeat: no-repeat no-repeat; " /><input type="submit" name="sa" value="Search" /><input name="siteurl" type="hidden" value="http://netkiller.sourceforge.net/" /></form><script type="text/javascript" src="http://www.google.com/coop/cse/brand?form=searchbox_008589143145807374698%3Af5uprauilyy"></script></td></tr></table><div class="chapter" title="第 4 章 MySQL Server"><div class="titlepage"><div><div><h2 class="title"><a id="server"></a>第 4 章 MySQL Server</h2></div></div></div><div class="toc"><p><b>目录</b></p><dl><dt><span class="section"><a href="server.html#mysql.install">1. MySQL Installation</a></span></dt><dd><dl><dt><span class="section"><a href="server.html#mysql.ubuntu">1.1. Installation by apt-get under debian/ubuntu</a></span></dt><dt><span class="section"><a href="server.html#mysql.source">1.2. Installation by source code</a></span></dt><dt><span class="section"><a href="server.html#mysql.binary">1.3. MySQL binary distribution</a></span></dt><dt><span class="section"><a href="server.html#idp226896">1.4. mysql-5.5.21-debian6.0-i686.deb</a></span></dt><dt><span class="section"><a href="server.html#idp228352">1.5. mysql-admin</a></span></dt></dl></dd><dt><span class="section"><a href="my.cnf.html">2. my.cnf</a></span></dt><dd><dl><dt><span class="section"><a href="my.cnf.html#idp231728">2.1. Configuring Database Character Encoding</a></span></dt><dt><span class="section"><a href="my.cnf.html#idp237504">2.2. max_connections</a></span></dt><dt><span class="section"><a href="my.cnf.html#idp238496">2.3. storage-engine</a></span></dt><dt><span class="section"><a href="my.cnf.html#idp239504">2.4. reload</a></span></dt><dt><span class="section"><a href="my.cnf.html#idp240512">2.5. max_allowed_packet</a></span></dt><dt><span class="section"><a href="my.cnf.html#idp241504">2.6. skip-name-resolve</a></span></dt><dt><span class="section"><a href="my.cnf.html#idp254816">2.7. 禁用TCP/IP链接</a></span></dt><dt><span class="section"><a href="my.cnf.html#idp255904">2.8. timeout</a></span></dt></dl></dd><dt><span class="section"><a href="log.html">3. mysql log</a></span></dt><dt><span class="section"><a href="security.html">4. Security</a></span></dt><dt><span class="section"><a href="replication.html">5. Replication</a></span></dt><dd><dl><dt><span class="section"><a href="replication.html#replication.master">5.1. Master</a></span></dt><dt><span class="section"><a href="replication.html#replication.slave">5.2. Slave</a></span></dt><dt><span class="section"><a href="replication.html#replication.testing">5.3. Testing</a></span></dt><dt><span class="section"><a href="replication.html#replication.error">5.4. 住从不同步问题</a></span></dt><dt><span class="section"><a href="replication.html#idp300896">5.5. Semisynchronous Replication</a></span></dt></dl></dd><dt><span class="section"><a href="cluster.html">6. MySQL CLuster</a></span></dt><dd><dl><dt><span class="section"><a href="cluster.html#cluster.mgm">6.1. Management node (MGM node)</a></span></dt><dt><span class="section"><a href="cluster.html#cluster.data">6.2. Data node</a></span></dt><dt><span class="section"><a href="cluster.html#cluster.sql">6.3. SQL node</a></span></dt><dt><span class="section"><a href="cluster.html#cluster.start">6.4. Starting</a></span></dt><dt><span class="section"><a href="cluster.html#cluster.shut">6.5. Shutdown</a></span></dt><dt><span class="section"><a href="cluster.html#cluster.testing">6.6. Testing</a></span></dt></dl></dd><dt><span class="section"><a href="monitoring.html">7. Monitoring</a></span></dt><dd><dl><dt><span class="section"><a href="monitoring.html#mon.prog">7.1. Analysis and Optimization</a></span></dt><dd><dl><dt><span class="section"><a href="monitoring.html#mytop">7.1.1. mytop - top like query monitor for MySQL</a></span></dt><dt><span class="section"><a href="monitoring.html#mtop">7.1.2. mtop - MySQL terminal based query monitor</a></span></dt><dt><span class="section"><a href="monitoring.html#idp398944">7.1.3. innotop</a></span></dt><dt><span class="section"><a href="monitoring.html#mysqlreport">7.1.4. mysqlreport</a></span></dt></dl></dd><dt><span class="section"><a href="monitoring.html#monitoring.munin">7.2. Munin</a></span></dt><dt><span class="section"><a href="monitoring.html#monitoring.cacti">7.3. Cacti</a></span></dt><dt><span class="section"><a href="monitoring.html#mysql.snmp">7.4. Monitoring MySQL with SNMP</a></span></dt></dl></dd><dt><span class="section"><a href="import_export.html">8. Import / Export (Backup and Recovery)</a></span></dt><dd><dl><dt><span class="section"><a href="import_export.html#backup">8.1. Export(Backup)</a></span></dt><dt><span class="section"><a href="import_export.html#recovery">8.2. Import(Recovery)</a></span></dt><dt><span class="section"><a href="import_export.html#idp416816">8.3. xml</a></span></dt><dt><span class="section"><a href="import_export.html#idp418128">8.4. 备份表数据</a></span></dt><dt><span class="section"><a href="import_export.html#idp419200">8.5. source</a></span></dt><dt><span class="section"><a href="import_export.html#idp420208">8.6. 使用 mysqlhotcopy 备份 MyISAM 引擎的数据库</a></span></dt><dt><span class="section"><a href="import_export.html#idp422496">8.7. AutoMySQLBackup</a></span></dt><dt><span class="section"><a href="import_export.html#idp423200">8.8. xtrabackup - Open source backup tool for InnoDB and XtraDB.</a></span></dt></dl></dd><dt><span class="section"><a href="backup.snapshot.html">9. Snapshot Backup</a></span></dt></dl></div><div class="section" title="1. MySQL Installation"><div class="titlepage"><div><div><h3 class="title"><a id="mysql.install"></a>1. MySQL Installation</h3></div></div></div><p>http://downloads.mysql.com/archives.php</p><div class="section" title="1.1. Installation by apt-get under debian/ubuntu"><div class="titlepage"><div><div><h4 class="title"><a id="mysql.ubuntu"></a>1.1. Installation by apt-get under debian/ubuntu</h4></div></div></div><p>安装环境 ubuntu 8.10</p><pre class="screen">
sudo apt-get install mysql-server
		</pre><p>New password for the MySQL "root" user</p><pre class="screen">
		
         ┌──────────────────────┤ Configuring mysql-server-5.0 ├─────────────────────┐
         │ While not mandatory, it is highly recommended that you set a password for the MySQL administrative "root" user.  │
         │                                                                                                                  │
         │ If that field is left blank, the password will not be changed.                                                   │
         │                                                                                                                  │
         │ New password for the MySQL "root" user:                                                                          │
         │                                                                                                                  │
         │ ****____________________________________________________________________________________________________________ │
         │                                                                                                                  │
         │                                                      &lt;Ok&gt;                                                        │
         │                                                                                                                  │
         └─────────────────────────────────────────────────────────────┘
		
		</pre><p>Repeat password for the MySQL "root" user</p><pre class="screen">
		
         ┌───┤ Configuring mysql-server-5.0 ├────┐
         │                                             │
         │                                             │
         │ Repeat password for the MySQL "root" user:  │
         │                                             │
         │ ****_______________________________________ │
         │                                             │
         │                   &lt;Ok&gt;                      │
         │                                             │
         └─────────────────────────┘
         
		</pre><p>create database</p><pre class="screen">
		
create database example;

mysql&gt; SHOW GRANTS;
+----------------------------------------------------------------------------------------------------------------------------------------+
| Grants for root@localhost                                                                                                              |
+----------------------------------------------------------------------------------------------------------------------------------------+
| GRANT ALL PRIVILEGES ON *.* TO 'root'@'localhost' IDENTIFIED BY PASSWORD '*C6325DAF39AE6CC34E960D3C65F1398FE467E1D0' WITH GRANT OPTION |
+----------------------------------------------------------------------------------------------------------------------------------------+
1 row in set (0.00 sec)

GRANT ALL PRIVILEGES ON example.* TO 'dbuser'@'localhost' IDENTIFIED BY '******' WITH GRANT OPTION;
FLUSH PRIVILEGES;

./mysql -udbuser -p
Enter password:

./mysql -udbuser -p example &lt; /tmp/example_china_copy.sql

./mysql -uroot
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 6
Server version: 5.0.45 Source distribution

Type 'help;' or '\h' for help. Type '\c' to clear the buffer.

mysql&gt; use example;
Database changed
mysql&gt; show tables;
		
		</pre><p>配置文件样本</p><pre class="screen">
debian:~# ls /usr/share/doc/mysql-server-5.0/examples/
my-huge.cnf.gz  my-innodb-heavy-4G.cnf.gz  my-large.cnf.gz  my-medium.cnf.gz  my-small.cnf  ndb_mgmd.cnf
		</pre></div><div class="section" title="1.2. Installation by source code"><div class="titlepage"><div><div><h4 class="title"><a id="mysql.source"></a>1.2. Installation by source code</h4></div></div></div><pre class="screen">
		
./configure \
--prefix=/usr/local/$MYSQL_DIR \
--enable-assembler \
--enable-local-infile \
--with-charset=utf8 \
--with-collation=utf8_general_ci \
--with-extra-charsets=none \
--with-openssl \
--with-pthread \
--with-unix-socket-path=/var/lib/mysql/mysql.sock \
--with-mysqld-user=mysql \
--with-mysqld-ldflags \
--with-client-ldflags \
--with-comment \
--with-big-tables \
--without-ndb-debug \
--without-docs \
--without-debug \
--without-bench

make &amp;&amp; make install
		
		</pre><p>/usr/local/$MYSQL_DIR/bin/mysql_install_db</p><p>other option</p><pre class="screen">
--without-isam
--without-innodb
--without-ndbcluster
--without-blackhole
--without-ibmdb2i
--without-federated
--without-example
--without-comment
--localstatedir=/usr/local/mysql/data
		</pre></div><div class="section" title="1.3. MySQL binary distribution"><div class="titlepage"><div><div><h4 class="title"><a id="mysql.binary"></a>1.3. MySQL binary distribution</h4></div></div></div><pre class="screen">
		
shell&gt; groupadd mysql
shell&gt; useradd -r -g mysql mysql
shell&gt; cd /usr/local
shell&gt; tar zxvf /path/to/mysql-VERSION-OS.tar.gz
shell&gt; ln -s full-path-to-mysql-VERSION-OS mysql
shell&gt; cd mysql
shell&gt; chown -R mysql .
shell&gt; chgrp -R mysql .
shell&gt; scripts/mysql_install_db --user=mysql
shell&gt; chown -R root .
shell&gt; chown -R mysql data
# Next command is optional
shell&gt; cp support-files/my-medium.cnf /etc/my.cnf
shell&gt; bin/mysqld_safe --user=mysql &amp;
# Next command is optional
shell&gt; cp support-files/mysql.server /etc/init.d/mysql.server
		
		</pre><p>install core database</p><pre class="screen">
		
[root@test mysql]# ./scripts/mysql_install_db
Installing MySQL system tables...
100428 23:16:20 [Warning] '--skip-locking' is deprecated and will be removed in a future release. Please use '--skip-external-locking' instead.
OK
Filling help tables...
100428 23:16:20 [Warning] '--skip-locking' is deprecated and will be removed in a future release. Please use '--skip-external-locking' instead.
OK

To start mysqld at boot time you have to copy
support-files/mysql.server to the right place for your system

PLEASE REMEMBER TO SET A PASSWORD FOR THE MySQL root USER !
To do so, start the server, then issue the following commands:

./bin/mysqladmin -u root password 'new-password'
./bin/mysqladmin -u root -h db.example.com password 'new-password'

Alternatively you can run:
./bin/mysql_secure_installation

which will also give you the option of removing the test
databases and anonymous user created by default.  This is
strongly recommended for production servers.

See the manual for more instructions.

You can start the MySQL daemon with:
cd . ; ./bin/mysqld_safe &amp;

You can test the MySQL daemon with mysql-test-run.pl
cd ./mysql-test ; perl mysql-test-run.pl

Please report any problems with the ./bin/mysqlbug script!
		
		</pre><p>set root's password</p><pre class="screen">
[root@test mysql]# cp support-files/mysql.server /etc/init.d/mysqld
[root@test mysql]# /etc/init.d/mysqld start
Starting MySQL.                                            [  OK  ]

[root@test mysql]# ./bin/mysqladmin -u root password 'chen'
[root@test mysql]# ./bin/mysqladmin -u root -h db.example.com password 'chen'
		</pre><p>test</p><pre class="screen">
		
[root@test mysql]# ./bin/mysql -uroot -pchen
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 3
Server version: 5.1.45 MySQL Community Server (GPL)

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql&gt;
		
		</pre></div><div class="section" title="1.4. mysql-5.5.21-debian6.0-i686.deb"><div class="titlepage"><div><div><h4 class="title"><a id="idp226896"></a>1.4. mysql-5.5.21-debian6.0-i686.deb</h4></div></div></div><pre class="screen">
		
sudo apt-get install libaio1


sudo groupadd mysql
sudo useradd -r -g mysql mysql

sudo dpkg -i mysql-5.5.21-debian6.0-i686.deb

cd /opt/mysql/
sudo chown -R mysql .
sudo chgrp -R mysql .

cd server-5.5/

sudo support-files/binary-configure

sudo chown -R mysql data

# Next command is optional
shell&gt; cp support-files/my-medium.cnf /etc/my.cnf

shell&gt; bin/mysqld_safe --user=mysql &amp;

# Next command is optional
sudo cp support-files/mysql.server /etc/init.d/mysql
		
		</pre></div><div class="section" title="1.5. mysql-admin"><div class="titlepage"><div><div><h4 class="title"><a id="idp228352"></a>1.5. mysql-admin</h4></div></div></div><pre class="screen">
$ sudo apt-get install mysql-admin
		</pre><p>运行mysql-admin</p><pre class="screen">
/usr/bin/mysql-admin
		</pre><p>运行 mysql-query-browser </p><pre class="screen">
mysql-query-browser --query="SELECT * FROM users"	
		</pre></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="index.html">上一页</a> </td><td width="20%" align="center"><a accesskey="u" href="index.html">上一级</a></td><td width="40%" align="right"> <a accesskey="n" href="my.cnf.html">下一页</a></td></tr><tr><td width="40%" align="left" valign="top">部分 II. MySQL </td><td width="20%" align="center"><a accesskey="h" href="../index.html">起始页</a></td><td width="40%" align="right" valign="top"> 2. my.cnf</td></tr></table></div><script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script><script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-2033740-1");
pageTracker._trackPageview();
} catch(err) {}</script></body></html>
