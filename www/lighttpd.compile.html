<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>2. to compile and then install lighttpd</title><link rel="stylesheet" href="/docbook.css" type="text/css" /><meta name="generator" content="DocBook XSL Stylesheets V1.75.2" /><link rel="home" href="index.html" title="Netkiller Linux Web 手札" /><link rel="up" href="lighttpd.html" title="第 3 章 Lighttpd and fastcgi" /><link rel="prev" href="lighttpd.html" title="第 3 章 Lighttpd and fastcgi" /><link rel="next" href="lighttpd.config.html" title="3. /etc/lighttpd/lighttpd.conf" /><script xmlns="" type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-11694057-1']);
  _gaq.push(['_setDomainName', 'netkiller.sourceforge.net']);
  _gaq.push(['_setAllowHash', 'false']);
  _gaq.push(['_setAllowLinker', true]);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">2. to compile and then install lighttpd</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="lighttpd.html">上一页</a> </td><th width="60%" align="center">第 3 章 Lighttpd and fastcgi</th><td width="20%" align="right"> <a accesskey="n" href="lighttpd.config.html">下一页</a></td></tr></table><hr /></div><table xmlns="" width="100%" border="0"><tr><td align="left"><a href="http://netkiller.sourceforge.net/">Home</a> |
                <a href="http://netkiller.github.com/">Mirror</a> |
                <a href="/search.html">Search</a></td><td align="right"><form id="searchbox_008589143145807374698:f5uprauilyy" action="/search.html"><input type="hidden" name="cx" value="008589143145807374698:f5uprauilyy" /><input type="hidden" name="cof" value="FORID:11" /><input name="q" type="text" size="25" style="border-top-width: 1px; border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-top-style: solid; border-right-style: solid; border-bottom-style: solid; border-left-style: solid; border-top-color: rgb(126, 157, 185); border-right-color: rgb(126, 157, 185); border-bottom-color: rgb(126, 157, 185); border-left-color: rgb(126, 157, 185); padding-top: 2px; padding-right: 2px; padding-bottom: 2px; padding-left: 2px; background-image: url(http://www.google.com/cse/intl/en/images/google_custom_search_watermark.gif); background-attachment: initial; background-origin: initial; background-clip: initial; background-color: rgb(255, 255, 255); background-position: 0% 50%; background-repeat: no-repeat no-repeat; " /><input type="submit" name="sa" value="Search" /><input name="siteurl" type="hidden" value="http://netkiller.sourceforge.net/" /></form><script type="text/javascript" src="http://www.google.com/coop/cse/brand?form=searchbox_008589143145807374698%3Af5uprauilyy"></script></td></tr></table><div class="section" title="2. to compile and then install lighttpd"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="lighttpd.compile"></a>2. to compile and then install lighttpd</h2></div></div></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>下载相关软件</p><p><a class="ulink" href="http://www.lighttpd.net/download/lighttpd-1.4.15.tar.gz" target="_top">立即下载</a></p><pre class="screen">
$ sudo apt-get install libpcre3*

cd /usr/local/src/
wget http://www.lighttpd.net/download/lighttpd-1.4.15.tar.gz
tar zxvf lighttpd-1.4.15.tar.gz
cd lighttpd-1.4.15
				</pre></li><li class="listitem"><p>编译安装</p><pre class="screen">
./configure --prefix=/usr/local/lighttpd-1.4.15 \
--with-bzip2 \
--with-memcache
make
make install
				</pre></li><li class="listitem"><p>创建目录与配置文件</p><pre class="screen">
ln -s /usr/local/lighttpd-1.4.15/ /usr/local/lighttpd
mkdir -p /www/pages
mkdir /www/logs
mkdir /usr/local/lighttpd/htdocs
mkdir /usr/local/lighttpd/logs
mkdir /usr/local/lighttpd/etc
cp ./doc/lighttpd.conf /usr/local/lighttpd/etc/
cd /usr/local/lighttpd/
				</pre></li><li class="listitem"><p>配置lighttpd.conf</p><span class="command"><strong>vi etc/lighttpd.conf</strong></span><p>找到 server.modules</p><p>删除 mod_fastcgi 前的注释</p><p>跟据你的需求修改下面定义</p><p>server.document-root = "/usr/local/lighttpd/htdocs/"</p><p>server.errorlog  = "/usr/local/lighttpd/logs/lighttpd.error.log"</p><p>accesslog.filename = "/usr/local/lighttpd/logs/access.log"</p><p>注释 $HTTP["url"]</p><pre class="screen">
#$HTTP["url"] =~ "\.pdf$" {
#  server.range-requests = "disable"
#}
				</pre></li><li class="listitem"><p>运行lighttpd</p><pre class="screen">
/usr/local/lighttpd/sbin/lighttpd -f /usr/local/lighttpd/etc/lighttpd.conf
				</pre><p>测试</p><p>curl http://ip/ 因为/www/pages/下没有HTML页面所以返回:</p><p>404 - Not Found</p></li></ol></div><div class="section" title="2.1. shell script"><div class="titlepage"><div><div><h3 class="title"><a id="id1224737"></a>2.1. shell script</h3></div></div></div><p>lighttpd script</p><div class="example"><a id="id1224742"></a><p class="title"><b>例 3.1. /etc/init.d/lighttpd</b></p><div class="example-contents"><pre class="screen">
					
#!/bin/bash
# lighttpd init file for web server
#
# chkconfig: - 100 100
# description: Security, speed, compliance, and flexibility--all of these describe LightTPD which is rapidly redefining efficiency of a webserver;
#				as it is designed and optimized for high performance environments.
# author: Neo Chen&lt;openunix@163.com&gt;
#
# processname: $PROG
# config:
# pidfile: /var/run/lighttpd

# source function library
. /etc/init.d/functions

PREFIX=/usr/local/lighttpd
PROG=$PREFIX/sbin/lighttpd
OPTIONS="-f /usr/local/lighttpd/etc/lighttpd.conf"
USER=daemon
RETVAL=0
prog="lighttpd"

start() {
        echo -n $"Starting $prog: "
        if [ $UID -ne 0 ]; then
                RETVAL=1
                failure
        else
                daemon --user=$USER $PROG $OPTIONS
                RETVAL=$?
                [ $RETVAL -eq 0 ] &amp;&amp; touch /var/lock/subsys/lighttpd
        fi;
        echo
        return $RETVAL
}

stop() {
        echo -n $"Stopping $prog: "
        if [ $UID -ne 0 ]; then
                RETVAL=1
                failure
        else
                killproc $PROG
                RETVAL=$?
                [ $RETVAL -eq 0 ] &amp;&amp; rm -f /var/lock/subsys/lighttpd
        fi;
        echo
        return $RETVAL
}

reload(){
        echo -n $"Reloading $prog: "
        killproc $PROG -HUP
        RETVAL=$?
        echo
        return $RETVAL
}

restart(){
	stop
	start
}

condrestart(){
    [ -e /var/lock/subsys/lighttpd ] &amp;&amp; restart
    return 0
}

case "$1" in
  start)
	start
	;;
  stop)
	stop
	;;
  restart)
	restart
        ;;
  reload)
	reload
        ;;
  condrestart)
	condrestart
	;;
  status)
        status lighttpd
	RETVAL=$?
        ;;
  *)
	echo $"Usage: $0 {start|stop|status|restart|condrestart|reload}"
	RETVAL=1
esac

exit $RETVAL
					
					</pre></div></div><br class="example-break" /></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="lighttpd.html">上一页</a> </td><td width="20%" align="center"><a accesskey="u" href="lighttpd.html">上一级</a></td><td width="40%" align="right"> <a accesskey="n" href="lighttpd.config.html">下一页</a></td></tr><tr><td width="40%" align="left" valign="top">第 3 章 Lighttpd and fastcgi </td><td width="20%" align="center"><a accesskey="h" href="index.html">起始页</a></td><td width="40%" align="right" valign="top"> 3. /etc/lighttpd/lighttpd.conf</td></tr></table></div></body></html>
