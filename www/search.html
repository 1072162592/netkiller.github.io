<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>第 7 章 Search Engine</title><link rel="stylesheet" type="text/css" href="/docbook.css" /><meta name="generator" content="DocBook XSL Stylesheets V1.76.1" /><meta name="keywords" content="lamp,lnmp,famp,fnmp, cgi,fastcgi,wsgi, apache,lighttpd,nginx,tomcat, awstatus, webalizer" /><link rel="home" href="index.html" title="Netkiller Linux Web 手札" /><link rel="up" href="index.html" title="Netkiller Linux Web 手札" /><link rel="prev" href="jboss.html" title="2. JBoss - JBoss Enterprise Middleware" /><link rel="next" href="nutch.html" title="2. Nutch" /><script xmlns="" type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-11694057-1']);
  _gaq.push(['_setDomainName', 'netkiller.sourceforge.net']);
  _gaq.push(['_setAllowHash', 'false']);
  _gaq.push(['_setAllowLinker', true]);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">第 7 章 Search Engine</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="jboss.html">上一页</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="nutch.html">下一页</a></td></tr></table><hr /></div><table xmlns="" width="100%" border="0"><tr><td align="left"><a href="http://netkiller.sourceforge.net/">Home</a> |
                <a href="http://netkiller.github.com/">Mirror</a> |
                <a href="/search.html">Search</a></td><td><div id="bdshare" class="bdshare_t bds_tools_32 get-codes-bdshare"><a class="bds_fbook"></a><a class="bds_twi"></a><a class="bds_ms"></a><a class="bds_msn"></a><a class="bds_buzz"></a><a class="bds_linkedin"></a><a class="bds_deli"></a><a class="bds_qzone"></a><a class="bds_qq"></a><a class="bds_tqq"></a><a class="bds_tqf"></a><a class="bds_tsina"></a><a class="bds_baidu"></a><a class="bds_renren"></a><a class="bds_t163"></a><a class="bds_tfh"></a><a class="bds_ty"></a><a class="bds_s51"></a><a class="bds_douban"></a><a class="bds_hi"></a><a class="bds_tieba"></a><a class="bds_tsohu"></a><a class="bds_kaixin001"></a><a class="bds_fx"></a><a class="bds_zx"></a><a class="bds_tuita"></a><span class="bds_more"></span><a class="shareCount"></a></div><script type="text/javascript" id="bdshare_js" data="type=tools"></script><script type="text/javascript" id="bdshell_js"></script><script type="text/javascript">
	document.getElementById("bdshell_js").src = "http://bdimg.share.baidu.com/static/js/shell_v2.js?cdnversion=" + new Date().getHours();
</script></td><td><form id="searchbox_008589143145807374698:f5uprauilyy" action="/search.html"><input type="hidden" name="cx" value="008589143145807374698:f5uprauilyy" /><input type="hidden" name="cof" value="FORID:11" /><input name="q" type="text" size="25" style="border-top-width: 1px; border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-top-style: solid; border-right-style: solid; border-bottom-style: solid; border-left-style: solid; border-top-color: rgb(126, 157, 185); border-right-color: rgb(126, 157, 185); border-bottom-color: rgb(126, 157, 185); border-left-color: rgb(126, 157, 185); padding-top: 2px; padding-right: 2px; padding-bottom: 2px; padding-left: 2px; background-image: url(http://www.google.com/cse/intl/en/images/google_custom_search_watermark.gif); background-attachment: initial; background-origin: initial; background-clip: initial; background-color: rgb(255, 255, 255); background-position: 0% 50%; background-repeat: no-repeat no-repeat; " /><input type="submit" name="sa" value="Search" /><input name="siteurl" type="hidden" value="http://netkiller.sourceforge.net/" /></form><script type="text/javascript" src="http://www.google.com/coop/cse/brand?form=searchbox_008589143145807374698%3Af5uprauilyy"></script></td></tr></table><div class="chapter" title="第 7 章 Search Engine"><div class="titlepage"><div><div><h2 class="title"><a id="search"></a>第 7 章 Search Engine</h2></div></div></div><div class="toc"><p><strong>目录</strong></p><dl><dt><span class="section"><a href="search.html#solr">1. Solr</a></span></dt><dd><dl><dt><span class="section"><a href="search.html#idp699232">1.1. Embedded Jetty</a></span></dt><dt><span class="section"><a href="search.html#idp700720">1.2. Jetty</a></span></dt><dt><span class="section"><a href="search.html#idp707536">1.3. Tomcat</a></span></dt><dt><span class="section"><a href="search.html#idp711600">1.4. solr-php-client</a></span></dt><dt><span class="section"><a href="search.html#idp712976">1.5. multicore</a></span></dt><dt><span class="section"><a href="search.html#idp718960">1.6. 中文分词</a></span></dt><dd><dl><dt><span class="section"><a href="search.html#idp719344">1.6.1. ChineseTokenizerFactory</a></span></dt><dt><span class="section"><a href="search.html#idp720512">1.6.2. CJK</a></span></dt><dt><span class="section"><a href="search.html#idp721648">1.6.3. mmseg4j</a></span></dt><dt><span class="section"><a href="search.html#idp721776">1.6.4. 中文分词“庖丁解牛” Paoding Analysis</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="nutch.html">2. Nutch</a></span></dt><dt><span class="section"><a href="lucene.html">3. Lucene</a></span></dt><dt><span class="section"><a href="mg4j.html">4. MG4J</a></span></dt><dt><span class="section"><a href="phpdig.html">5. PhpDig</a></span></dt><dt><span class="section"><a href="sphinx.html">6. Sphinx</a></span></dt><dt><span class="section"><a href="mahout.html">7. Mahout</a></span></dt><dt><span class="section"><a href="elasticsearch.html">8. elasticsearch</a></span></dt></dl></div><div class="section" title="1. Solr"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="solr"></a>1. Solr</h2></div></div></div><p>http://lucene.apache.org/solr/</p><p>java 采用apt-get安装</p><div class="example"><a id="idp697840"></a><p class="title"><strong>例 7.1. /etc/profile.d/java.sh</strong></p><div class="example-contents"><pre class="screen">
################################################
### Java environment by neo
################################################
export JAVA_HOME=/usr
export JRE_HOME=/usr
export PATH=$PATH:/usr/local/apache-tomcat/bin/:/usr/local/jetty-6.1.18/bin
export CLASSPATH="./:/usr/share/java/:/usr/local/apache-solr/example/multicore/lib"
export JAVA_OPTS="-Xms128m -Xmx1024m"
		</pre></div></div><br class="example-break" /><div class="section" title="1.1. Embedded Jetty"><div class="titlepage"><div><div><h3 class="title"><a id="idp699232"></a>1.1. Embedded Jetty</h3></div></div></div><pre class="screen">
		
wget http://apache.freelamp.com/lucene/solr/1.3.0/apache-solr-1.3.0.tgz
tar zxvf apache-solr-1.3.0.tgz
ln -s apache-solr-1.3.0 ../apache-solr
cd ../apache-solr/example/
java -jar start.jar
		
		</pre><p>multicore: java -Dsolr.solr.home=multicore -jar start.jar</p></div><div class="section" title="1.2. Jetty"><div class="titlepage"><div><div><h3 class="title"><a id="idp700720"></a>1.2. Jetty</h3></div></div></div><p>http://jetty.mortbay.org/jetty/</p><div class="procedure" title="过程 7.1. apt-get install"><a id="idp701408"></a><p class="title"><strong>过程 7.1. apt-get install</strong></p><ol class="procedure" type="1"><li class="step" title="步骤 1"><p>install</p><pre class="screen">
				
$ sudo apt-get install libxpp3-java
$ sudo apt-get install solr-jetty
				
				</pre></li><li class="step" title="步骤 2"><p>firewall</p><pre class="screen">
				
$ sudo ufw allow 8280
				
				</pre></li><li class="step" title="步骤 3"><p>Testing.</p><p>http://172.16.0.1:8280/</p><p>http://172.16.0.1:8280/admin/ (user:admin, passwd:admin)</p></li></ol></div><div class="procedure" title="过程 7.2. source codes install"><a id="idp705872"></a><p class="title"><strong>过程 7.2. source codes install</strong></p><ul class="procedure"><li class="step" title="步骤 1"><p>download</p><pre class="screen">
				
wget http://dist.codehaus.org/jetty/jetty-6.1.18/jetty-6.1.18.zip
				
				</pre></li></ul></div></div><div class="section" title="1.3. Tomcat"><div class="titlepage"><div><div><h3 class="title"><a id="idp707536"></a>1.3. Tomcat</h3></div></div></div><p>http://tomcat.apache.org/</p><div class="procedure"><ol class="procedure" type="1"><li class="step" title="步骤 1"><p>download</p><pre class="screen">
				
cd /usr/local/src

wget http://apache.etoak.com/tomcat/tomcat-6/v6.0.20/bin/apache-tomcat-6.0.20.tar.gz
wget http://apache.freelamp.com/lucene/solr/1.3.0/apache-solr-1.3.0.tgz

tar zxvf apache-tomcat-6.0.20.tar.gz
ln -s apache-tomcat-6.0.20 ../apache-tomcat

tar zxvf apache-solr-1.3.0.tgz
ln -s apache-solr-1.3.0 ../apache-solr
				
				</pre></li><li class="step" title="步骤 2"><p>solr.xml</p><pre class="screen">
				
vim /usr/local/apache-tomcat/conf/Catalina/localhost/solr.xml

&lt;Context docBase="/usr/local/apache-solr/dist/apache-solr-1.3.0.war" debug="0" crossContext="true" &gt;
   &lt;Environment name="solr/home" type="java.lang.String" value="/usr/local/apache-solr/example/solr" override="true" /&gt;
&lt;/Context&gt;
				
				</pre></li></ol></div></div><div class="section" title="1.4. solr-php-client"><div class="titlepage"><div><div><h3 class="title"><a id="idp711600"></a>1.4. solr-php-client</h3></div></div></div><p>http://code.google.com/p/solr-php-client/</p><pre class="screen">
wget http://solr-php-client.googlecode.com/files/SolrPhpClient.2009-03-11.tgz
tar zxvf SolrPhpClient.2009-03-11.tgz
sudo mv SolrPhpClient/Apache /usr/share/php/
		</pre></div><div class="section" title="1.5. multicore"><div class="titlepage"><div><div><h3 class="title"><a id="idp712976"></a>1.5. multicore</h3></div></div></div><p>solr.xml</p><pre class="screen">
		
vim /usr/local/apache-solr/example/multicore/solr.xml

&lt;?xml version="1.0" encoding="UTF-8" ?&gt;
&lt;solr persistent="false"&gt;
  &lt;cores adminPath="/admin/cores"&gt;
    &lt;core name="core0" instanceDir="core0" /&gt;
    &lt;core name="core1" instanceDir="core1" /&gt;

    &lt;core name="article" instanceDir="article" /&gt;

  &lt;/cores&gt;
&lt;/solr&gt;
		
		</pre><p>core directory and config file</p><pre class="screen">
		
mkdir -p article/conf

vim article/conf/solrconfig.xml

&lt;?xml version="1.0" encoding="UTF-8" ?&gt;
&lt;config&gt;
  &lt;updateHandler class="solr.DirectUpdateHandler2" /&gt;
  &lt;requestDispatcher handleSelect="true" &gt;
    &lt;requestParsers enableRemoteStreaming="false" multipartUploadLimitInKB="2048" /&gt;
  &lt;/requestDispatcher&gt;
  &lt;requestHandler name="standard" class="solr.StandardRequestHandler" default="true" /&gt;
  &lt;requestHandler name="/update" class="solr.XmlUpdateRequestHandler" /&gt;
  &lt;requestHandler name="/admin/" class="org.apache.solr.handler.admin.AdminHandlers" /&gt;
  &lt;admin&gt;
    &lt;defaultQuery&gt;solr&lt;/defaultQuery&gt;
  &lt;/admin&gt;
&lt;/config&gt;

vim article/conf/schema.xml

&lt;?xml version="1.0" ?&gt;
&lt;schema name="example core zero" version="1.1"&gt;
  &lt;types&gt;
   &lt;fieldType name="sint" class="solr.SortableIntField" sortMissingLast="true" omitNorms="true"/&gt;
   &lt;fieldtype name="string"  class="solr.StrField" sortMissingLast="true" omitNorms="true"/&gt;
   &lt;fieldType name="date" class="solr.DateField" sortMissingLast="true" omitNorms="true"/&gt;
   &lt;fieldType name="text" class="solr.TextField" positionIncrementGap="100" /&gt;
  &lt;/types&gt;
 &lt;fields&gt;
  &lt;!-- general --&gt;
  &lt;field name="id"      type="sint"   indexed="true"  stored="true"  multiValued="false" required="true"/&gt;
  &lt;field name="type"    type="string"   indexed="true"  stored="true"  multiValued="false" /&gt;
  &lt;field name="name"    type="string"   indexed="true"  stored="true"  multiValued="false" /&gt;
  &lt;field name="title"   type="string"   indexed="true"  stored="true"  multiValued="false" /&gt;
  &lt;field name="content"   type="text"   indexed="true"  stored="true"  multiValued="false" /&gt;
  &lt;field name="timestamp" type="date" indexed="true" stored="true" default="NOW"/&gt;
 &lt;/fields&gt;
 &lt;!-- field to use to determine and enforce document uniqueness. --&gt;
 &lt;uniqueKey&gt;id&lt;/uniqueKey&gt;
 &lt;!-- field for the QueryParser to use when an explicit fieldname is absent --&gt;
 &lt;defaultSearchField&gt;content&lt;/defaultSearchField&gt;
 &lt;!-- SolrQueryParser configuration: defaultOperator="AND|OR" --&gt;
 &lt;solrQueryParser defaultOperator="OR"/&gt;
	&lt;copyField source="title" dest="content"/&gt;
	&lt;copyField source="name" dest="content"/&gt;
&lt;/schema&gt;
		
		</pre><p>commit datas</p><pre class="screen">
		
vim test.xml

&lt;add&gt;
	&lt;doc&gt;
	  &lt;field name="id"&gt;1&lt;/field&gt;
	  &lt;field name="name"&gt;Hello world&lt;/field&gt;
	&lt;/doc&gt;

	&lt;doc&gt;
	  &lt;field name="id"&gt;2&lt;/field&gt;
	  &lt;field name="title"&gt;Title Hello world&lt;/field&gt;
	&lt;/doc&gt;

	&lt;doc&gt;
	  &lt;field name="id"&gt;3&lt;/field&gt;
	  &lt;field name="name"&gt;Hello world 1&lt;/field&gt;
	  &lt;field name="content"&gt;Content 1&lt;/field&gt;
	&lt;/doc&gt;

	&lt;doc&gt;
	  &lt;field name="id"&gt;4&lt;/field&gt;
	  &lt;field name="name"&gt;Name Neo&lt;/field&gt;
	&lt;/doc&gt;

	&lt;doc&gt;
	  &lt;field name="id"&gt;5&lt;/field&gt;
	  &lt;field name="name"&gt;Last Chan&lt;/field&gt;
	&lt;/doc&gt;
&lt;/add&gt;


java -Durl=http://localhost:8983/solr/article/update -Dcommit=yes -jar ../exampledocs/post.jar test.xml

		
		</pre></div><div class="section" title="1.6. 中文分词"><div class="titlepage"><div><div><h3 class="title"><a id="idp718960"></a>1.6. 中文分词</h3></div></div></div><div class="section" title="1.6.1. ChineseTokenizerFactory"><div class="titlepage"><div><div><h4 class="title"><a id="idp719344"></a>1.6.1. ChineseTokenizerFactory</h4></div></div></div><pre class="screen">
			
&lt;fieldType name="text" class="solr.TextField" &gt;
    &lt;analyzer&gt;
        &lt;tokenizer class="org.apache.solr.analysis.ChineseTokenizerFactory"/&gt;
    &lt;/analyzer&gt;
&lt;/fieldType&gt;
			
			</pre></div><div class="section" title="1.6.2. CJK"><div class="titlepage"><div><div><h4 class="title"><a id="idp720512"></a>1.6.2. CJK</h4></div></div></div><pre class="screen">
			
&lt;fieldType name="text" class="solr.TextField" positionIncrementGap="100"&gt;
	&lt;analyzer&gt;
    	&lt;tokenizer class="solr.CJKTokenizerFactory"/&gt;
	&lt;/analyzer&gt;
&lt;/fieldType&gt;
			
			</pre></div><div class="section" title="1.6.3. mmseg4j"><div class="titlepage"><div><div><h4 class="title"><a id="idp721648"></a>1.6.3. mmseg4j</h4></div></div></div><p>http://code.google.com/p/mmseg4j/</p><p>install</p><pre class="screen">
			
$ cd /usr/local/src/
$ wget http://mmseg4j.googlecode.com/files/mmseg4j-1.7.2.zip
$ unzip mmseg4j-1.7.2.zip
$ mkdir /usr/local/apache-solr/example/multicore/lib
$ cp /usr/local/src/mmseg4j-1.7.2/mmseg4j-all-1.7.2.jar /usr/local/apache-solr/example/multicore/lib
$ cd mmseg4j-1.7.2/
			
			</pre><p>test</p><pre class="screen">
$ java -Dmmseg.dic.path=/usr/local/apache-solr/example/solr -jar mmseg4j-all-1.7.2.jar 这里是字符串
$ java -Dmmseg.dic.path=/usr/local/apache-solr/example/solr -cp .:mmseg4j-all-1.7.2.jar com.chenlb.mmseg4j.example.Simple 这里是字符串
$ java -Dmmseg.dic.path=/usr/local/apache-solr/example/solr -cp .:mmseg4j-all-1.7.2.jar com.chenlb.mmseg4j.example.MaxWord 这里是字符串
			</pre><p>mmseg4j 在 solr 中主要支持两个参数：mode、dicPath。mode 表示是什么模式分词（有效值：simplex、complex、max-word，如果输入了无效的默认用 max-word。）。dicPath 是词库目录可以是绝对目录，也可以是相对目录（是相对 solr.home 目录下的，dic 就会在 solr.home/dic 目录下找词库文件），如果不指定就是默认在 CWD/data 目录（程序运行当前目录的data子目录）下找。</p><p>分词例子</p><pre class="screen">
			
&lt;fieldtype name="textComplex" class="solr.TextField"&gt;
	&lt;analyzer&gt;
		&lt;tokenizer class="com.chenlb.mmseg4j.solr.MMSegTokenizerFactory"
			mode="complex" dicPath="dic"&gt;
		&lt;/tokenizer&gt;
	&lt;/analyzer&gt;
&lt;/fieldtype&gt;

&lt;fieldtype name="textMaxWord" class="solr.TextField"&gt;
	&lt;analyzer&gt;
		&lt;tokenizer class="com.chenlb.mmseg4j.solr.MMSegTokenizerFactory"
			mode="max-word" dicPath="dic"&gt;
		&lt;/tokenizer&gt;
	&lt;/analyzer&gt;
&lt;/fieldtype&gt;

&lt;fieldtype name="textSimple" class="solr.TextField"&gt;
	&lt;analyzer&gt;
		&lt;tokenizer class="com.chenlb.mmseg4j.solr.MMSegTokenizerFactory"
			mode="simple" dicPath="/usr/local/apache-solr/example/solr/my_dic"&gt;
		&lt;/tokenizer&gt;
	&lt;/analyzer&gt;
&lt;/fieldtype&gt;
			
			</pre><p>添加到schema.xml</p><pre class="screen">
			
&lt;fieldType name="text" class="solr.TextField" positionIncrementGap="100" &gt;
    &lt;analyzer&gt;
        &lt;tokenizer class="com.chenlb.mmseg4j.solr.MMSegTokenizerFactory" mode="complex" dicPath="dic"/&gt;
        &lt;filter class="solr.LowerCaseFilterFactory"/&gt;
    &lt;/analyzer&gt;
&lt;/fieldType&gt;
			
			</pre><p>http://localhost:8080/solr/admin/analysis.jsp 在 Field 的下拉菜单选择 name，然后在应用输入 complex。可以看 mmseg4j 的分词的结果.</p></div><div class="section" title="1.6.4. 中文分词“庖丁解牛” Paoding Analysis"><div class="titlepage"><div><div><h4 class="title"><a id="idp721776"></a>1.6.4. 中文分词“庖丁解牛” Paoding Analysis</h4></div></div></div><pre class="screen">
$ cd /usr/local/src/
$ mkdir paoding-analysis-2.0.4-beta
$ cd paoding-analysis-2.0.4-beta/
$ wget http://paoding.googlecode.com/files/paoding-analysis-2.0.4-beta.zip
$ unzip paoding-analysis-2.0.4-beta.zip
$ cp paoding-analysis.jar /usr/local/apache-solr/example/multicore/lib/
			</pre><p>ChineseTokenizerFactory</p><pre class="screen">
			</pre></div></div></div></div><div xmlns="" id="disqus_thread"></div><script xmlns="" type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */

            if(document.domain == 'netkiller.github.com'){
            var disqus_shortname = 'netkiller'; // required: replace example with your forum shortname
            }else{
			var disqus_shortname = 'neochan';
            }

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script><noscript xmlns="">Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript><a xmlns="" href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="jboss.html">上一页</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="nutch.html">下一页</a></td></tr><tr><td width="40%" align="left" valign="top">2. JBoss - JBoss Enterprise Middleware </td><td width="20%" align="center"><a accesskey="h" href="index.html">起始页</a></td><td width="40%" align="right" valign="top"> 2. Nutch</td></tr></table></div></body></html>
