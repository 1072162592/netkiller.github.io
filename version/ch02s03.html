<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>3. hooks</title><link rel="stylesheet" href="/docbook.css" type="text/css" /><meta name="generator" content="DocBook XSL Stylesheets V1.75.2" /><link rel="home" href="index.html" title="Netkiller Version 手札" /><link rel="up" href="ch02.html" title="第 2 章 Invoking the Server" /><link rel="prev" href="ch02s02.html" title="2. classic Unix-like inetd daemon" /><link rel="next" href="ch02s04.html" title="4. WebDav" /></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">3. hooks</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch02s02.html">上一页</a> </td><th width="60%" align="center">第 2 章 Invoking the Server</th><td width="20%" align="right"> <a accesskey="n" href="ch02s04.html">下一页</a></td></tr></table><hr /></div><div class="section" title="3. hooks"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id1447497"></a>3. hooks</h2></div></div></div>
			
			<pre class="screen">
$ sudo apt-get install subversion-tools		
			</pre>
			<div class="section" title="3.1. post-commit"><div class="titlepage"><div><div><h3 class="title"><a id="id1447509"></a>3.1. post-commit</h3></div></div></div>
				
				<p>install SVN::Notify</p>
				<pre class="screen">
perl -MCPAN -e 'install SVN::Notify'				
				</pre>
				<pre class="screen">
				
$ sudo cp post-commit.tmpl post-commit
$ sudo chown svnroot:svn post-commit
$ sudo vim post-commit

REPOS="$1"
REV="$2"

#/usr/share/subversion/hook-scripts/commit-email.pl "$REPOS" "$REV" openunix@163.com
/usr/share/subversion/hook-scripts/commit-email.pl "$1" "$2" --from neo@netkiller.8800.org -h localhost  -s "[SVN]" --diff y openunix@163.com openx@163.com
				
				</pre>
				<p>另一种方法</p>
				<pre class="screen">
				
#!/bin/sh

REPOS="$1"
REV="$2"

/usr/local/bin/svnnotify                    \
    --repos-path    "$REPOS"                \
    --revision      "$REV"                  \
    --subject-cx                            \
    --with-diff                             \
    --handler       HTML::ColorDiff         \
    --to            &lt;your e-mail address&gt;   \
    --from          &lt;from e-mail address&gt;			
    				
				</pre>
				<pre class="screen">
/usr/bin/svnnotify --repos-path "$REPOS" --revision "$REV" \
--from neo@netkiller.8800.org --to openunix@163.com --smtp localhost \
--handler "HTML::ColorDiff"  --with-diff --charset zh_CN:GB2312  -g zh_CN --svnlook /usr/bin/svnlook --subject-prefix '[SVN]'			
				</pre>
				<p>如果你没有安装邮件服务器，你可以使用服务商的SMTP如163.com</p>
				<pre class="screen">
/usr/bin/svnnotify --repos-path "$REPOS" --revision "$REV" \
--from openx@163.com --to openunix@163.com --smtp smtp.163.com  --smtp-user openunix --smtp-pass ****** \
--handler "HTML::ColorDiff"  --with-diff --charset UTF-8 --language zh_CN --svnlook /usr/bin/svnlook --subject-prefix '[SVN]'			
				</pre>
				<p>Charset</p>
				<pre class="screen">
REPOS="$1"
REV="$2"

svnnotify --repos-path "$REPOS" --revision "$REV" \
        --subject-cx \
        --from neo.chen@example.com \
        --to group@example.com,manager@example.com \
        --with-diff \
        --svnlook /usr/bin/svnlook \
        --subject-prefix '[SVN]' \
        --charset UTF-8  --language zh_CN				
				</pre>
			</div>
		</div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch02s02.html">上一页</a> </td><td width="20%" align="center"><a accesskey="u" href="ch02.html">上一级</a></td><td width="40%" align="right"> <a accesskey="n" href="ch02s04.html">下一页</a></td></tr><tr><td width="40%" align="left" valign="top">2. classic Unix-like inetd daemon </td><td width="20%" align="center"><a accesskey="h" href="index.html">起始页</a></td><td width="40%" align="right" valign="top"> 4. WebDav</td></tr></table></div></body></html>
