<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>第 35 章 MongoDB</title><meta name="generator" content="DocBook XSL Stylesheets V1.76.1"><meta name="keywords" content="MySQL, PostgreSQL, Oracle, NoSQL, ER, TokyoCabinet/Tyrant, Memcache, Membase, Redis, Flare, Voldemort, LevelDB, MongoDB, GreenSQL, RDBMS, ORDBMS"><link rel="home" href="../../index.html" title="Netkiller Database 手札"><link rel="up" href="../pt05.html" title="部分 V. NoSQL"><link rel="prev" href="../pt05.html" title="部分 V. NoSQL"><link rel="next" href="ch35s02.html" title="35.2. Security and Authentication"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="chapter" title="第 35 章 MongoDB"><div class="titlepage"><div><div><h2 class="title"><a name="index"></a>第 35 章 MongoDB</h2></div></div></div><div class="toc"><p><b>目录</b></p><dl><dt><span class="section"><a href="ch35.html#mongodb.quickstart">35.1. Quickstart</a></span></dt><dd><dl><dt><span class="section"><a href="ch35.html#mongodb.bin">35.1.1. 二进制tar包安装</a></span></dt><dt><span class="section"><a href="ch35.html#mongodb.ubuntu">35.1.2. Ubuntu MongoDB</a></span></dt><dt><span class="section"><a href="ch35.html#mongodb.centos">35.1.3. CentOS MongoDB</a></span></dt><dt><span class="section"><a href="ch35.html#idp1563584">35.1.4. MongoDB + Hadoop</a></span></dt></dl></dd><dt><span class="section"><a href="ch35s02.html">35.2. Security and Authentication</a></span></dt><dd><dl><dt><span class="section"><a href="ch35s02.html#idp1571008">35.2.1. 超级管理员</a></span></dt><dt><span class="section"><a href="ch35s02.html#idp1572864">35.2.2. 数据库用户</a></span></dt><dt><span class="section"><a href="ch35s02.html#idp1575088">35.2.3. 删除用户</a></span></dt></dl></dd><dt><span class="section"><a href="ch35s03.html">35.3. Replication</a></span></dt><dt><span class="section"><a href="ch35s04.html">35.4. Drivers</a></span></dt><dd><dl><dt><span class="section"><a href="ch35s04.html#idp1580160">35.4.1. Using MongoDB in PHP</a></span></dt></dl></dd><dt><span class="section"><a href="ch35s05.html">35.5. mongo 命令行</a></span></dt><dd><dl><dt><span class="section"><a href="ch35s05.html#idp1588976">35.5.1. help</a></span></dt><dt><span class="section"><a href="ch35s05.html#idp1590736">35.5.2. show 查看命令</a></span></dt><dd><dl><dt><span class="section"><a href="ch35s05.html#idp1591728">35.5.2.1. show dbs</a></span></dt><dt><span class="section"><a href="ch35s05.html#idp1593680">35.5.2.2. show collections</a></span></dt><dt><span class="section"><a href="ch35s05.html#idp1596352">35.5.2.3. show users</a></span></dt><dt><span class="section"><a href="ch35s05.html#idp1598208">35.5.2.4. show profile</a></span></dt></dl></dd><dt><span class="section"><a href="ch35s05.html#idp1600304">35.5.3. 切换数据库</a></span></dt><dt><span class="section"><a href="ch35s05.html#idp1601840">35.5.4. 索引管理</a></span></dt><dt><span class="section"><a href="ch35s05.html#idp1607744">35.5.5. 记录管理</a></span></dt><dd><dl><dt><span class="section"><a href="ch35s05.html#idp1608656">35.5.5.1. save</a></span></dt><dt><span class="section"><a href="ch35s05.html#idp1611680">35.5.5.2. insert</a></span></dt><dt><span class="section"><a href="ch35s05.html#idp1613760">35.5.5.3. update</a></span></dt><dt><span class="section"><a href="ch35s05.html#idp1615664">35.5.5.4. remove</a></span></dt><dt><span class="section"><a href="ch35s05.html#idp1618544">35.5.5.5. find</a></span></dt><dt><span class="section"><a href="ch35s05.html#idp1618736">35.5.5.6. count()</a></span></dt><dt><span class="section"><a href="ch35s05.html#idp1628336">35.5.5.7. group()</a></span></dt></dl></dd><dt><span class="section"><a href="ch35s05.html#idp1630288">35.5.6. 管道操作</a></span></dt></dl></dd><dt><span class="section"><a href="ch35s06.html">35.6. Map-Reduce</a></span></dt><dd><dl><dt><span class="section"><a href="ch35s06.html#idp1632912">35.6.1. 使用 Map-Reduce 统计Web 服务器 access.log 日志文件</a></span></dt></dl></dd><dt><span class="section"><a href="ch35s07.html">35.7. Mongo Admin UI</a></span></dt><dd><dl><dt><span class="section"><a href="ch35s07.html#rockmongo">35.7.1. RockMongo</a></span></dt><dt><span class="section"><a href="ch35s07.html#mongovue">35.7.2. MongoVUE</a></span></dt></dl></dd></dl></div>
	
	<p>http://www.mongodb.org/</p>
	<div class="section" title="35.1. Quickstart"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="mongodb.quickstart"></a>35.1. Quickstart</h2></div></div></div>
		
		<div class="section" title="35.1.1. 二进制tar包安装"><div class="titlepage"><div><div><h3 class="title"><a name="mongodb.bin"></a>35.1.1. 二进制tar包安装</h3></div></div></div>
			
			<p>Install MongoDB</p>
			<pre class="screen">
wget http://fastdl.mongodb.org/linux/mongodb-linux-x86_64-1.5.5.tgz

debian:/srv# tar zxf mongodb-linux-x86_64-1.5.5.tgz
debian:/srv# ln -s mongodb-linux-x86_64-1.5.5 mongodb
			</pre>
			<p>Create a data directory</p>
			<p>By default MongoDB will store data in /data/db, but it won't automatically create that directory. To create it, do:</p>
			<pre class="screen">
$ sudo mkdir -p /data/db/
$ sudo chown `id -u` /data/db
			</pre>
			<p>You can also tell MongoDB to use a different data directory, with the --dbpath option.</p>
			<p>Run and connect to the server</p>
			<p>First, start the MongoDB server in one terminal:</p>
			<pre class="screen">
$ ./mongodb/bin/mongod
			</pre>
			<p>In a separate terminal, start the shell, which will connect to localhost by default:</p>
			<pre class="screen">
$ ./mongodb/bin/mongo
&gt; db.foo.save( { a : 1 } )
&gt; db.foo.find()
			</pre>
			<p>Congratulations, you've just saved and retrieved your first document with MongoDB!</p>
			<div class="example"><a name="idp1553472"></a><p class="title"><b>例 35.1. MongoDB Test</b></p><div class="example-contents">
				
				<pre class="screen">
				
debian:/srv/mongodb/bin# ./mongo
MongoDB shell version: 1.5.5
connecting to: test
[initandlisten] Thu Jul 22 16:42:07 connection accepted from 127.0.0.1:42876 #1
&gt; db.foo.save({a:1})
Thu Jul 22 16:42:23 allocating new datafile /data/db/test.ns, filling with zeroes...
Thu Jul 22 16:42:23 done allocating datafile /data/db/test.ns, size: 16MB,  took 0.025 secs
Thu Jul 22 16:42:23 allocating new datafile /data/db/test.0, filling with zeroes...
Thu Jul 22 16:42:23 done allocating datafile /data/db/test.0, size: 64MB,  took 0.105 secs
[conn1] Thu Jul 22 16:42:23 building new index on { _id: 1 } for test.foo
[conn1] Thu Jul 22 16:42:23 Buildindex test.foo idxNo:0 { name: "_id_", ns: "test.foo", key: { _id: 1 } }
[conn1] Thu Jul 22 16:42:23 done for 0 records 0secs
[conn1] Thu Jul 22 16:42:23 insert test.foo 136ms
&gt; Thu Jul 22 16:42:23 allocating new datafile /data/db/test.1, filling with zeroes...
Thu Jul 22 16:42:24 done allocating datafile /data/db/test.1, size: 128MB,  took 0.228 secs
&gt; db.foo.find()
{ "_id" : ObjectId("4c48046f74050cbf6c9a0ef6"), "a" : 1 }

&gt; use neo
switched to db neo
&gt; db.foo.save({a:1})
Thu Jul 22 16:54:50 allocating new datafile /data/db/neo.ns, filling with zeroes...
Thu Jul 22 16:54:50 done allocating datafile /data/db/neo.ns, size: 16MB,  took 0.026 secs
Thu Jul 22 16:54:50 allocating new datafile /data/db/neo.0, filling with zeroes...
Thu Jul 22 16:54:50 done allocating datafile /data/db/neo.0, size: 64MB,  took 0.122 secs
[conn1] Thu Jul 22 16:54:50 building new index on { _id: 1 } for neo.foo
[conn1] Thu Jul 22 16:54:50 Buildindex neo.foo idxNo:0 { name: "_id_", ns: "neo.foo", key: { _id: 1 } }
Thu Jul 22 16:54:50 allocating new datafile /data/db/neo.1, filling with zeroes...
[conn1] Thu Jul 22 16:54:50 done for 0 records 0.01secs
[conn1] Thu Jul 22 16:54:50 insert neo.foo 164ms
&gt; Thu Jul 22 16:54:50 done allocating datafile /data/db/neo.1, size: 128MB,  took 0.217 secs

&gt; db.foo.find()
{ "_id" : ObjectId("4c48075a74050cbf6c9a0ef7"), "a" : 1 }
&gt;

&gt; db.neo.save({a:1})
[conn1] Thu Jul 22 16:58:32 building new index on { _id: 1 } for neo.neo
[conn1] Thu Jul 22 16:58:32 Buildindex neo.neo idxNo:0 { name: "_id_", ns: "neo.neo", key: { _id: 1 } }
[conn1] Thu Jul 22 16:58:32 done for 0 records 0.024secs
&gt; db.neo.find()
{ "_id" : ObjectId("4c48083874050cbf6c9a0ef8"), "a" : 1 }

				
				</pre>
			</div></div><br class="example-break">
			<p>Starting Mongo</p>
			<p>Running as a Daemon</p>
			<pre class="screen">
 $ ./mongod --fork --logpath /var/log/mongodb.log --logappend
			</pre>
		</div>
		<div class="section" title="35.1.2. Ubuntu MongoDB"><div class="titlepage"><div><div><h3 class="title"><a name="mongodb.ubuntu"></a>35.1.2. Ubuntu MongoDB</h3></div></div></div>
			
			<p></p>
			<pre class="screen">
$ sudo apt-get install mongodb-server mongodb-clients
			</pre>
			<pre class="screen">
$ /etc/init.d/mongodb
Usage: /etc/init.d/mongodb {start|stop|force-stop|restart|force-reload|status}
			</pre>
		</div>
		<div class="section" title="35.1.3. CentOS MongoDB"><div class="titlepage"><div><div><h3 class="title"><a name="mongodb.centos"></a>35.1.3. CentOS MongoDB</h3></div></div></div>
			
			<pre class="screen">
# yum install mongodb-server

# chkconfig mongod on

# service mongod start
			</pre>
			<p>单独安装客户端</p>
			<pre class="screen">
# yum install mongodb
			</pre>
		</div>
		<div class="section" title="35.1.4. MongoDB + Hadoop"><div class="titlepage"><div><div><h3 class="title"><a name="idp1563584"></a>35.1.4. MongoDB + Hadoop</h3></div></div></div>
			
			<p>Hadoop Connector</p>
			<p>http://docs.mongodb.org/ecosystem/tutorial/getting-started-with-hadoop/</p>

			<pre class="screen">
git clone https://github.com/mongodb/mongo-hadoop.git
git checkout release-1.0
			</pre>
			<pre class="screen">
# vim build.sbt
hadoopRelease in ThisBuild := "cdh4"
			</pre>
			<pre class="screen">
./sbt package
			</pre>
			<pre class="screen">
			
wget --no-check-certificate https://github.com/downloads/mongodb/mongo-java-driver/mongo-2.7.3.jar
cp mongo-2.7.3.jar /usr/lib/hadoop/lib/
cp core/target/mongo-hadoop-core_cdh3u3-1.0.0.jar /usr/lib/hadoop/lib/
			
			</pre>
			<p>待续......</p>
		</div>
	</div>

	
	
	
	



	

</div></body></html>
