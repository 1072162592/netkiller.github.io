<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>61.4. Gearman</title><meta name="generator" content="DocBook XSL Stylesheets V1.76.1"><meta name="keywords" content="rabbitmq, zeromq, ActiveMQ, Kafka, Gearman"><meta name="keywords" content="PHP, Python, Perl, Ruby, Java, HTML, XHTML, HTML5, CSS, Javascript, JQuery, C, C++, D"><link rel="home" href="../index.html" title="Netkiller Developer 手札"><link rel="up" href="ch61.html" title="第 61 章 Message Queuing &amp; RPC"><link rel="prev" href="ch61s03.html" title="61.3. nanomsg"><link rel="next" href="ch61s05.html" title="61.5. ActiveMQ"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="section" title="61.4. Gearman"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="gearman"></a>61.4. Gearman</h2></div></div></div>
	
	<p>http://gearman.org/</p>
	<div class="section" title="61.4.1. Getting Started with Gearman"><div class="titlepage"><div><div><h3 class="title"><a name="idp1532176"></a>61.4.1. Getting Started with Gearman</h3></div></div></div>
		
		<div class="section" title="61.4.1.1. CentOS"><div class="titlepage"><div><div><h4 class="title"><a name="idp1532816"></a>61.4.1.1. CentOS</h4></div></div></div>
			
			<pre class="screen">
rpm -Uvh http://dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm

yum install gearmand -y
chkconfig gearmand on
service gearmand start
			</pre>
			<p>配置启动参数</p>
			<pre class="screen">
			
cat &gt;&gt; /etc/sysconfig/gearmand &lt;&lt;EOF

OPTIONS="--log-file=/var/log/gearman.log --threads=512"
EOF
			
			</pre>
		</div>
		<div class="section" title="61.4.1.2. Ubuntu"><div class="titlepage"><div><div><h4 class="title"><a name="idp1535360"></a>61.4.1.2. Ubuntu</h4></div></div></div>
			
			<pre class="screen">
$ apt-cache search gearman | grep gearman
drizzle-plugin-gearman-udf - Gearman User Defined Functions for Drizzle
drizzle-plugin-logging-gearman - Gearman Logging for Drizzle
gearman - Distributed job queue
gearman-job-server - Job server for the Gearman distributed job queue
gearman-server - Gearman distributed job server and Perl interface
gearman-tools - Tools for the Gearman distributed job queue
libgearman-client-async-perl - asynchronous client for the Gearman distributed job system
libgearman-client-perl - client for the Gearman distributed job system
libgearman-dbg - Debug symbols for the Gearman Client Library
libgearman-dev - Development files for the Gearman Library
libgearman-doc - API Documentation for the Gearman Library
libgearman6 - Library providing Gearman client and worker functions
mod-gearman-doc - Documentation and examples for Mod-Gearman
mod-gearman-module - Nagios/Icinga event broker module for Mod-Gearman
mod-gearman-tools - Tools for mod-gearman
mod-gearman-worker - Worker agent for Mod-Gearman
python-gearman - Python interface to the Gearman system
python-gearman.libgearman - Python wrapper of libgearman
python3-gearman.libgearman - Python 3 wrapper of libgearman
			</pre>
		</div>
		<div class="section" title="61.4.1.3. 防火墙设置"><div class="titlepage"><div><div><h4 class="title"><a name="idp1537904"></a>61.4.1.3. 防火墙设置</h4></div></div></div>
			
			<p>查看gearman工作端口</p>
			<pre class="screen">
# grep gearman /etc/services
gearman         4730/tcp                # Gearman Job Queue System
gearman         4730/udp                # Gearman Job Queue System
			</pre>
			<p>iptables 设置</p>
			<pre class="screen">
iptables -A INPUT -m state --state NEW -m tcp -p tcp --dport 4730 -j ACCEPT
			</pre>
		</div>
	</div>
	<div class="section" title="61.4.2. gearman"><div class="titlepage"><div><div><h3 class="title"><a name="idp1540832"></a>61.4.2. gearman</h3></div></div></div>
		
		<p>控制台 A</p>
		<pre class="screen">
gearman -w -f wc -- wc -l
		</pre>
		<p>控制台 B</p>
		<pre class="screen">
		
#wc -l &lt; /etc/passwd
30

# wc -l &lt; /etc/passwd
30
		
		</pre>
		<p>停止 gearman 进程再试</p>
		<pre class="screen">
		
# /etc/init.d/gearmand stop
Stopping gearmand:                                         [  OK  ]

[root@haproxy ~]# gearman -f wc &lt; /etc/passwd
gearman:gearman_client_run_tasks:gearman_connection_flush:could not connect
		
		</pre>
		<p>压力测试</p>
		<pre class="screen">
		
find / -type f | awk '{ print "gearman -f wc &lt; " $1 }' | bash
		
		</pre>
	</div>
	<div class="section" title="61.4.3. Gearman PHP Extension"><div class="titlepage"><div><div><h3 class="title"><a name="idp1545600"></a>61.4.3. Gearman PHP Extension</h3></div></div></div>
		
		<pre class="screen">
		
rpm -Uvh http://dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm

install libgearman-devel
pecl install channel://pecl.php.net/gearman-0.8.3

cat &gt;&gt; /srv/php/etc/conf.d/gearman.ini &lt;&lt;EOF
extension=gearman.so
EOF
		
		</pre>
		<p>测试安装</p>
		<pre class="screen">
# php -r 'printf("%s \r\n", gearman_version());'
0.14
		</pre>
	</div>
</div></body></html>
