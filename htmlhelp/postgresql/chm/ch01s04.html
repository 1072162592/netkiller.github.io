<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>1.4. PostgreSQL 配置</title><meta name="generator" content="DocBook XSL Stylesheets V1.76.1"><link rel="home" href="index.html" title="Netkiller PostgreSQL 手札"><link rel="up" href="ch01.html" title="第 1 章 PostgreSQL 安装"><link rel="prev" href="ch01s03.html" title="1.3. PostgreSQL YUM 源安装"><link rel="next" href="ch01s05.html" title="1.5. 创建dba用户"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="section" title="1.4. PostgreSQL 配置"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="pgsql.conf"></a>1.4. PostgreSQL 配置</h2></div></div></div>
		
		<p>su 到 postgres 用户</p>
		<pre class="screen">
$ su - postgres
Password:
$ pwd
/var/lib/postgresql
$
		</pre>
		<p>备份配置文件，防止修改过程中损毁</p>
		<pre class="screen">
cp /etc/postgresql/9.1/main/postgresql.conf /etc/postgresql/9.1/main/postgresql.conf.original
cp /etc/postgresql/9.1/main/pg_hba.conf /etc/postgresql/9.1/main/pg_hba.conf.original
		</pre>
		<div class="section" title="1.4.1. postgresql.conf"><div class="titlepage"><div><div><h3 class="title"><a name="idp197264"></a>1.4.1. postgresql.conf</h3></div></div></div>
			
			<p>启用tcp/ip连接，去掉下面注释,修改为你需要的IP地址，默认为localhost</p>
			<pre class="screen">
listen_addresses = 'localhost'
			</pre>
			<p>如果有多个网络适配器可以指定 'ip' 或 '*' 任何接口上的IP地址都可能listen.</p>
			<pre class="screen">
$ sudo vim /etc/postgresql/9.1/main/postgresql.conf

listen_addresses = '*'
			</pre>
		</div>
		<div class="section" title="1.4.2. pg_hba.conf"><div class="titlepage"><div><div><h3 class="title"><a name="idp200144"></a>1.4.2. pg_hba.conf</h3></div></div></div>
			
			<p>pg_hba.conf配置文件的权限需要注意以下，-rw-r----- 1 postgres postgres  4649 Dec  5 18:00 pg_hba.conf</p>
			<pre class="screen">
$ ll /etc/postgresql/9.1/main/
total 52
drwxr-xr-x 2 postgres postgres  4096 Dec  6 09:40 ./
drwxr-xr-x 3 postgres postgres  4096 Dec  5 18:00 ../
-rw-r--r-- 1 postgres postgres   316 Dec  5 18:00 environment
-rw-r--r-- 1 postgres postgres   143 Dec  5 18:00 pg_ctl.conf
-rw-r----- 1 postgres postgres  4649 Dec  5 18:00 pg_hba.conf
-rw-r----- 1 postgres postgres  1636 Dec  5 18:00 pg_ident.conf
-rw-r--r-- 1 postgres postgres 19259 Dec  5 18:00 postgresql.conf
-rw-r--r-- 1 postgres postgres   378 Dec  5 18:00 start.conf
			</pre>
			<p>pg_hba.conf配置文件负责访问权限控制</p>
			<pre class="screen">
# TYPE  DATABASE        USER            ADDRESS                 METHOD

# "local" is for Unix domain socket connections only
local   all             all                                     peer
# IPv4 local connections:
host    all             all             127.0.0.1/32            md5
# IPv6 local connections:
host    all             all             ::1/128                 md5
			</pre>
			<div class="glosslist"><dl><dt>TYPE</dt><dd><p>
							local 本地使用unix/socket 方式连接, host 使用tcp/ip socket 方式连接
						</p></dd><dt>DATABASE</dt><dd><p>
							数据库名.
						</p></dd><dt>USER</dt><dd><p>
							用户名.
						</p></dd><dt>ADDRESS</dt><dd><p>
							允许连接的IP地址，可以使用子网掩码.
						</p></dd><dt>METHOD</dt><dd><p>
							认真加密方式.
						</p></dd></dl></div>
			<p>下面我们做一个简单测试，首先配置pg_hba。conf文件</p>
			<pre class="screen">
$ sudo vi /etc/postgresql/9.1/main/pg_hba.conf
host    *			dba         0.0.0.0/0       md5
host    test		test        0.0.0.0/0       md5
			</pre>
			<p>运行创建数据,用户 的SQL语句</p>
			<pre class="screen">
CREATE ROLE test LOGIN PASSWORD 'test' NOSUPERUSER NOINHERIT NOCREATEDB NOCREATEROLE;

CREATE DATABASE test WITH OWNER = test ENCODING = 'UTF8' TABLESPACE = pg_default;
			</pre>
			<p>进入psql</p>
			<pre class="screen">
$ psql
psql (9.1.6)
Type "help" for help.

postgres=# CREATE ROLE test LOGIN PASSWORD 'test' NOSUPERUSER NOINHERIT NOCREATEDB NOCREATEROLE;
CREATE ROLE
postgres=# CREATE DATABASE test WITH OWNER = test ENCODING = 'UTF8' TABLESPACE = pg_default;
CREATE DATABASE
postgres=# \q
			</pre>
			<p>使用psql登录</p>
			<pre class="screen">
			
$ psql -hlocalhost -Utest test
Password for user test:
psql (9.1.6)
SSL connection (cipher: DHE-RSA-AES256-SHA, bits: 256)
Type "help" for help.

test=&gt; \l
                                  List of databases
   Name    |  Owner   | Encoding |   Collate   |    Ctype    |   Access privileges
-----------+----------+----------+-------------+-------------+-----------------------
 postgres  | postgres | UTF8     | en_US.UTF-8 | en_US.UTF-8 |
 template0 | postgres | UTF8     | en_US.UTF-8 | en_US.UTF-8 | =c/postgres          +
           |          |          |             |             | postgres=CTc/postgres
 template1 | postgres | UTF8     | en_US.UTF-8 | en_US.UTF-8 | =c/postgres          +
           |          |          |             |             | postgres=CTc/postgres
 test      | test     | UTF8     | en_US.UTF-8 | en_US.UTF-8 |
(4 rows)

test=&gt;
			
			</pre>


		</div>
	</div></body></html>
