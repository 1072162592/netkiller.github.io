<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>11.11. 标准与规范</title><link rel="stylesheet" type="text/css" href="..//docbook.css" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="home" href="../index.html" title="Netkiller Management 手札" /><link rel="up" href="index.html" title="Chapter 11. 开发篇(Development)" /><link rel="prev" href="ch11s10.html" title="11.10. 每周例会" /><link rel="next" href="../ops/index.html" title="Chapter 12. 运维篇(Operations)" /></head><body><a xmlns="" href="//www.netkiller.cn/">Home</a> |
		<a xmlns="" href="//netkiller.github.io/">简体中文</a> |
	    <a xmlns="" href="http://netkiller.sourceforge.net/">繁体中文</a> |
	    <a xmlns="" href="/journal/index.html">杂文</a> |
	    <a xmlns="" href="//www.netkiller.cn/home/donations.html">打赏(Donations)</a> |
	    <a xmlns="" href="http://netkiller-github-com.iteye.com/">ITEYE 博客</a> |
	    <a xmlns="" href="http://my.oschina.net/neochen/">OSChina 博客</a> |
	    <a xmlns="" href="https://www.facebook.com/bg7nyt">Facebook</a> |
	    <a xmlns="" href="http://cn.linkedin.com/in/netkiller/">Linkedin</a> |
	    <a xmlns="" href="https://zhuanlan.zhihu.com/netkiller">知乎专栏</a> |
	    <a xmlns="" href="/search.html">Search</a> |
		<a xmlns="" href="mailto:netkiller@msn.com">Email</a><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">11.11. 标准与规范</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch11s10.html">Prev</a> </td><th width="60%" align="center">Chapter 11. 开发篇(Development)</th><td width="20%" align="right"> <a accesskey="n" href="../ops/index.html">Next</a></td></tr></table><hr /></div><table xmlns=""><tr><td><iframe src="//ghbtns.com/github-btn.html?user=netkiller&amp;repo=netkiller.github.io&amp;type=watch&amp;count=true&amp;size=large" height="30" width="170" frameborder="0" scrolling="0" style="width:170px; height: 30px;" allowTransparency="true"></iframe></td><td><iframe src="//ghbtns.com/github-btn.html?user=netkiller&amp;repo=netkiller.github.io&amp;type=fork&amp;count=true&amp;size=large" height="30" width="170" frameborder="0" scrolling="0" style="width:170px; height: 30px;" allowTransparency="true"></iframe></td><td><iframe src="//ghbtns.com/github-btn.html?user=netkiller&amp;type=follow&amp;count=true&amp;size=large" height="30" width="240" frameborder="0" scrolling="0" style="width:240px; height: 30px;" allowTransparency="true"></iframe></td></tr></table><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="standard"></a>11.11. 标准与规范</h2></div></div></div>
	
	<div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="redis"></a>11.11.1. Redis Key</h3></div></div></div>
		
		<p>Redis Key 使用“：”分割例如 </p>
		<pre class="screen">
set SMS:CAPTCHA 1234
		</pre>
	</div>
	<div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="code"></a>11.11.2. 错误编码</h3></div></div></div>
		
		<p>格式 ABCD</p>
		<p>A: 编码 </p>
		<p>1 用户错误</p>
		<p>2 网络错误</p>
		<p>3 系统错误</p>
		<p>4 应用服务器错误</p>
		<p>5 应用程序错误</p>
		<p>6 缓存错误</p>
		<p>7 数据库错误</p>
		<p>8 搜索引擎</p>
		<p>B 编码 </p>
		<p>0 成功</p>
		<p>1 失败 </p>
		<p> 剩余 C D 用户自行编码 </p>
	</div>
	
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="html"></a>11.11.3. HTML 标准</h3></div></div></div>
	
	<p></p>
	<div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp71"></a>11.11.3.1. 校验</h4></div></div></div>
		
		<pre class="screen">
https://html5.validator.nu/?doc=https%3A%2F%2Fwww.netkiller.cn%2Findex.html	
		</pre>
	</div>
	<div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp72"></a>11.11.3.2. XHTML/HTML</h4></div></div></div>
		
	</div>
	<div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp73"></a>11.11.3.3. CSS</h4></div></div></div>
		
	</div>
	<div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp74"></a>11.11.3.4. Script</h4></div></div></div>
		
	</div>

</div>

	

<div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="coding"></a>11.11.4. 编码风格</h3></div></div></div>
	
	<pre class="screen">
https://code.google.com/p/google-styleguide/
http://lxr.linux.no/linux/Documentation/CodingStyle
http://perldoc.perl.org/perlstyle.html
http://www.gnu.org/prep/standards/
	</pre>
	<div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="java"></a>11.11.4.1. java 编程规范</h4></div></div></div>
		
		<div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="idp75"></a>11.11.4.1.1. Spring Data JPA</h5></div></div></div>
			
			<pre class="programlisting">
			
	@Autowired
	private TableRepostitory tableRepostitory;
	
	@Autowired
	private JdbcTemplate jdbcTemplate;
	
	@PersistenceContext 
	private EntityManager entityManager; 
			
			</pre>
		</div>
	</div>
	<div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="php"></a>11.11.4.2. php 文件</h4></div></div></div>
		
		<p>http://www.php-fig.org</p>
		<div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="idp76"></a>11.11.4.2.1. 格式与 编码</h5></div></div></div>
			
			<p>使用 UNIX 风格换行, 请在你的编辑器内调整</p>
			<pre class="screen">
UNIX (LF或"\n")
MAC OS (CR 或"\r")
Windows CRLF \r\n
			</pre>
			<p>源码文件使用 UTF-8</p>
			<p>有些IDE环境 UTF-8 BOM</p>
		</div>
		<div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="idp77"></a>11.11.4.2.2. 循环嵌套</h5></div></div></div>
			
			<p>if, while, for, foreach, do ... loop, switch... 等的嵌套必须小于等于3层</p>
			<p>如下面的例子，可读性极差。</p>
			<pre class="screen">
if (xxx){
	if (xxx){
		if(xxx){
			if(xxx){
				if(xxx){

				}
			}
		}
		if(xxx){
			if(xxx){
			}
		}
	}
	if (xxx){
		if(xxx){
			if(xxx){
			}
		}
		if(xxx){
			if(xxx){
			}
		}
	}
}
			</pre>
			<p>加以改造</p>
			<pre class="screen">
func aaa(p){
	if(p){
		if(xxx){
		}
	}
}
func bbb(b){
	if(b){
		if(xxx){
			if(xxx){

			}
		}
	}
}

if(xxx){
	aaa(xxx)
}
if(b){
	bbb(b)
}			</pre>
		</div>
		<div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="idp78"></a>11.11.4.2.3. 取出行尾的空格以及多余的换行符</h5></div></div></div>
			
			<p>一个空格占用一个字节,换行符Window是两个字节\r\n, Unix与Mac占用一个字节</p>
		</div>
		<div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="idp79"></a>11.11.4.2.4. php 标签</h5></div></div></div>
			
			<p>禁止这样使用</p>
			<pre class="screen">
			
&lt;?
...
?&gt;
			
			</pre>
			<p>正确的使用方法</p>
			<pre class="screen">
			
&lt;?php
...

or

&lt;?php
...
?&gt;
			
			</pre>
		</div>

		<div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="idp80"></a>11.11.4.2.5. 头部注释</h5></div></div></div>
			
			<pre class="screen">
			
&lt;?php
/**
 * Project Name
 *
 * @author     $Author: netkiller $
 * @copyright  Copyright (c) 2012 Company
 * @version    $Id: chapter.coding.xml 584 2013-05-15 05:13:17Z netkiller $
 */

&lt;?php
/**
 * Project Name
 *
 * @author     $Author: netkiller $
 * @license    GNU General Public License 2.0
 * @version    $Id: chapter.coding.xml 584 2013-05-15 05:13:17Z netkiller $
 */
			
			</pre>
		</div>
	</div>
	<div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="coding.string"></a>11.11.4.3. String</h4></div></div></div>
		
		<p>双引号要处理字符串转义，性能上不如单引号，如果你不需要转义字符串，或者字符串中不含原转译字符，建议你使用单引号</p>
		<pre class="screen">
print("string")
		</pre>
		<p>每次输出会检索特殊字符串如： \r, \n, \t, \0xFF 等等</p>
		<pre class="screen">
print('string')
		</pre>
	</div>
	<div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="coding.db"></a>11.11.4.4. Database</h4></div></div></div>
		
		<p>使用pdo_mysql替代mysql</p>
		<p>错误的写法，通过字符串链接拼接sql语句极容易出现注入漏洞</p>
		<pre class="screen">
$sql = "select * from table where id=".$id;
$sql = "select * from table where id='".$id."'";
$sql = "INSERT INTO fruit(name, colour) VALUES ('".$name."', '".$colour."')";
		</pre>
		<p>正确的写法</p>
		<pre class="screen">
$sql = "select * from table where id=?";
$sql = "INSERT INTO fruit(name, colour) VALUES (?, ?)";
		</pre>
		<pre class="screen">
		
$sql = &lt;&lt;&lt;____SQL
     CREATE TABLE IF NOT EXISTS `ticket_hist` (
       `tid` int(11) NOT NULL,
       `trqform` varchar(40) NOT NULL,
       `trsform` varchar(40) NOT NULL,
       `tgen` datetime NOT NULL,
       `tterm` datetime,
       `tstatus` tinyint(1) NOT NULL
     ) ENGINE=ARCHIVE COMMENT='ticket archive';
____SQL;
		
		</pre>

		<div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="idp81"></a>11.11.4.4.1. 结果集使用注意事项</h5></div></div></div>
			
			<p>返回数据库查询结果有几种形式</p>
			<p>数组形式</p>
			<pre class="screen">
			
Array
(
    [0] =&gt; banana
    [1] =&gt; yellow
)

Array
(
    [NAME] =&gt; banana
    [COLOUR] =&gt; yellow
)
			
			</pre>
			<p>对象形式</p>
			<pre class="screen">
Object
(
	Obj-&gt;NAME
	Obj-&gt;COLOUR
)
			</pre>
			<p>正确的使用方式</p>
			<pre class="screen">
print($row[name])
print($row-&gt;name)
			</pre>
			<p>错误的使用使方式</p>
			<pre class="screen">
print($row[0])
			</pre>
			<p>避免使用 "*"查询，一会影响性能，二增加带宽开销</p>
			<pre class="screen">
$sql = "select * from tab where status=0 limit 1";
			</pre>
			<p>如果程序使用$row[1]读取结果，有可能当数据库结构改变，增加字段，字段顺序发生变化，输出数据都会出错</p>
		</div>
		<div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="idp82"></a>11.11.4.4.2. 索引</h5></div></div></div>
			
			<p>下面的例子，不会使用索引</p>
			<pre class="screen">
$sql = "select id, name, created from tab where id != 100";
			</pre>
			<pre class="screen">
EXPLAIN select * from members where id != '1010';			索引失效
EXPLAIN select count(*) from members where id != '1010';	索引有效
			</pre>
		</div>
		<div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="idp83"></a>11.11.4.4.3. 缓存</h5></div></div></div>
			
			<pre class="screen">

			</pre>
			<p>下面的例子，数据不会缓存查询结果</p>
			<pre class="screen">
$sql = "select id, name, created from tab where created=now()";
			</pre>
		</div>
	</div>
</div>

	<div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="performance"></a>11.11.5. 安全</h3></div></div></div>
		
		<div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp84"></a>11.11.5.1. Interface</h4></div></div></div>
			
			<div><img src="../images/development/interface.png" /></div>
		</div>
		<div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp85"></a>11.11.5.2. SQL注入</h4></div></div></div>
			
		</div>
	</div>
</div><div xmlns="" id="disqus_thread"></div><script xmlns="">

var disqus_config = function () {
this.page.url = "http://www.netkiller.cn";  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = 'netkiller'; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};

(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = '//netkiller.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script><noscript xmlns="">Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript><br xmlns="" /><script xmlns="" type="text/javascript" id="clustrmaps" src="//cdn.clustrmaps.com/map_v2.js?u=r5HG&amp;d=9mi5r_kkDC8uxG8HuY3p4-2qgeeVypAK9vMD-2P6BYM"></script><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch11s10.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="index.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="../ops/index.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">11.10. 每周例会 </td><td width="20%" align="center"><a accesskey="h" href="../index.html">Home</a></td><td width="40%" align="right" valign="top"> Chapter 12. 运维篇(Operations)</td></tr></table></div><script xmlns="">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-11694057-1', 'auto');
  ga('send', 'pageview');

</script><script xmlns="" async="async">
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?93967759a51cda79e49bf4e34d0b0f2c";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script xmlns="" async="async">
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script><script xmlns="" type="text/javascript" src="/js/q.js" async="async"></script></body></html>