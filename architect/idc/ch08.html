<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>第 8 章 服务器快速安装与部署</title><link rel="stylesheet" href="/docbook.css" type="text/css" /><meta name="generator" content="DocBook XSL Stylesheets V1.75.2" /><link rel="home" href="../index.html" title="Netkiller Web Architect 手札" /><link rel="up" href="idc.html" title="部分 II. IDC 运维" /><link rel="prev" href="ch07s02.html" title="2. 接入线路测试" /><link rel="next" href="ntpd.html" title="2. NTPD" /></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">第 8 章 服务器快速安装与部署</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch07s02.html">上一页</a> </td><th width="60%" align="center">部分 II. IDC 运维</th><td width="20%" align="right"> <a accesskey="n" href="ntpd.html">下一页</a></td></tr></table><hr /></div><div class="chapter" title="第 8 章 服务器快速安装与部署"><div class="titlepage"><div><div><h2 class="title"><a id="id1244208"></a>第 8 章 服务器快速安装与部署</h2></div></div></div><div class="toc"><p><b>目录</b></p><dl><dt><span class="section"><a href="ch08.html#id1244214">1. Linux</a></span></dt><dd><dl><dt><span class="section"><a href="ch08.html#id1244217">1.1. NIC</a></span></dt><dt><span class="section"><a href="ch08.html#id1244227">1.2. DNS</a></span></dt><dt><span class="section"><a href="ch08.html#id1244236">1.3. limits.conf</a></span></dt><dt><span class="section"><a href="ch08.html#id1244255">1.4. sysctl</a></span></dt><dd><dl><dt><span class="section"><a href="ch08.html#id1244258">1.4.1. /etc/sysctl.conf</a></span></dt><dt><span class="section"><a href="ch08.html#id1244274">1.4.2. sysctl.conf</a></span></dt></dl></dd><dt><span class="section"><a href="ch08.html#id1244285">1.5. profile</a></span></dt><dt><span class="section"><a href="ch08.html#id1244296">1.6. Crontab</a></span></dt><dt><span class="section"><a href="ch08.html#id1244315">1.7. NFS</a></span></dt><dt><span class="section"><a href="ch08.html#id1244333">1.8. 释放内存</a></span></dt></dl></dd><dt><span class="section"><a href="ntpd.html">2. NTPD</a></span></dt><dt><span class="section"><a href="snmp.html">3. snmp</a></span></dt><dt><span class="section"><a href="ch08s04.html">4. nrpe</a></span></dt><dt><span class="section"><a href="ch08s05.html">5. vsftpd</a></span></dt><dt><span class="section"><a href="ch08s06.html">6. 安装 LAMP</a></span></dt><dd><dl><dt><span class="section"><a href="ch08s06.html#id1244425">6.1. Apache</a></span></dt><dt><span class="section"><a href="ch08s06.html#id1244444">6.2. MySQL</a></span></dt><dt><span class="section"><a href="ch08s06.html#id1244456">6.3. PHP</a></span></dt><dt><span class="section"><a href="ch08s06.html#id1244474">6.4. resin-pro</a></span></dt><dt><span class="section"><a href="ch08s06.html#id1244483">6.5. httpd</a></span></dt><dt><span class="section"><a href="ch08s06.html#id1244508">6.6. php</a></span></dt></dl></dd><dt><span class="section"><a href="ch08s07.html">7. Linux 日常管理</a></span></dt><dt><span class="section"><a href="ch08s08.html">8. web 服务器排名</a></span></dt></dl></div><p>直接复制下面命令，右键粘贴到终端中运用即可。</p><div class="section" title="1. Linux"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id1244214"></a>1. Linux</h2></div></div></div><div class="section" title="1.1. NIC"><div class="titlepage"><div><div><h3 class="title"><a id="id1244217"></a>1.1. NIC</h3></div></div></div><pre class="screen">
DEVICE=eth0
BOOTPROTO=static
HWADDR=00:15:17:3E:90:90
ONBOOT=yes
NETMASK=255.255.255.0
IPADDR=172.16.1.26
GATEWAY=172.16.1.1
TYPE=Ethernet
USERCTL=no
IPV6INIT=no
PEERDNS=yes
		</pre></div><div class="section" title="1.2. DNS"><div class="titlepage"><div><div><h3 class="title"><a id="id1244227"></a>1.2. DNS</h3></div></div></div><pre class="screen">
		
echo -ne "
search example.com
nameserver 208.67.222.222
nameserver 202.67.220.220
" &gt; /etc/resolv.conf
		
		</pre></div><div class="section" title="1.3. limits.conf"><div class="titlepage"><div><div><h3 class="title"><a id="id1244236"></a>1.3. limits.conf</h3></div></div></div><pre class="screen">
		
echo ulimit -HSn 65536 &gt;&gt; /etc/rc.local  
echo ulimit -HSn 65536 &gt;&gt;/root/.bash_profile  
ulimit -HSn 65536

echo -ne "
* soft nofile 65536
* hard nofile 65536
" &gt;&gt;/etc/security/limits.conf
	
	</pre><p>/etc/security/limits.d</p><pre class="screen">
	
cat &gt;&gt; /etc/security/limits.conf &lt;&lt;EOF
root 	soft nofile 10240
root 	hard nofile 65536
nobody 	soft nofile 10240
nobody 	hard nofile 65536
EOF

echo "ulimit -SHn 65530" &gt;&gt; /etc/rc.local
echo "ulimit -SHm 16000000" &gt;&gt; /etc/rc.local
ulimit -SHn 65535 &gt; /dev/null 2&gt;&amp;1
		
		</pre></div><div class="section" title="1.4. sysctl"><div class="titlepage"><div><div><h3 class="title"><a id="id1244255"></a>1.4. sysctl</h3></div></div></div><div class="section" title="1.4.1. /etc/sysctl.conf"><div class="titlepage"><div><div><h4 class="title"><a id="id1244258"></a>1.4.1. /etc/sysctl.conf</h4></div></div></div><pre class="screen">
net.core.rmem_max=16777216
net.core.wmem_max=16777216

net.core.netdev_max_backlog = 30000
net.core.somaxconn = 262144

net.ipv4.ip_local_port_range = 4096 65536
net.ipv4.tcp_mem=4096 65536 16777216
net.ipv4.tcp_rmem=4096 87380 16777216
net.ipv4.tcp_wmem=4096 65536 16777216
net.ipv4.tcp_fin_timeout = 30

net.ipv4.tcp_tw_reuse = 1
net.ipv4.tcp_tw_recycle = 1
net.ipv4.tcp_timestamps = 0
net.ipv4.tcp_window_scaling = 0
net.ipv4.tcp_sack = 0
net.ipv4.tcp_no_metrics_save=1
net.ipv4.tcp_syncookies = 1
net.ipv4.tcp_max_orphans = 262144
net.ipv4.tcp_max_syn_backlog = 262144
net.ipv4.tcp_synack_retries = 2
net.ipv4.tcp_syn_retries = 2
net.ipv4.tcp_keepalive_time = 300

net.ipv4.conf.lo.arp_ignore = 1 
net.ipv4.conf.lo.arp_announce = 2 
net.ipv4.conf.all.arp_ignore = 1 
net.ipv4.conf.all.arp_announce = 2
  			</pre></div><div class="section" title="1.4.2. sysctl.conf"><div class="titlepage"><div><div><h4 class="title"><a id="id1244274"></a>1.4.2. sysctl.conf</h4></div></div></div><pre class="screen">
			
cat &gt;&gt; /etc/sysctl.conf &lt;&lt;EOF
net.ipv4.ip_local_port_range = 1024 65500
net.ipv4.tcp_max_syn_backlog = 8192
net.ipv4.tcp_tw_reuse = 1
net.ipv4.tcp_tw_recycle = 1
net.ipv4.tcp_fin_timeout = 30
net.ipv4.tcp_keepalive_time = 1200
net.ipv4.tcp_max_tw_buckets = 4096
EOF
/sbin/sysctl -p	
			
			</pre></div></div><div class="section" title="1.5. profile"><div class="titlepage"><div><div><h3 class="title"><a id="id1244285"></a>1.5. profile</h3></div></div></div><pre class="screen">
			
echo -ne '
export JAVA_HOME=/usr/local/java
export RESIN_HOME=/usr/local/resin
export CLASSPATH=$JAVA_HOME/lib:$JAVA_HOME/jre/lib:$CLASSPATH
export PATH=$PATH:$JAVA_HOME/bin:$JAVA_HOME/jre/bin:$HOMR/bin:
export PATH=$PATH:/usr/local/httpd:/usr/local/php:/usr/local/mysql:/usr/local/resin
export JAVA_OPTS="-server -Xms512m -Xmx4096m  -XX:PermSize=64M -XX:MaxPermSize=512m"
' &gt;&gt; /etc/profile
			
			</pre></div><div class="section" title="1.6. Crontab"><div class="titlepage"><div><div><h3 class="title"><a id="id1244296"></a>1.6. Crontab</h3></div></div></div><p>crontab 中输出信息很保存到 /var/spool/clientmqueue 需要定时清除</p><pre class="screen">
# du -sh /var/* | sort -rn|head -n 10
# cd /var/spool/clientmqueue
# ls | xargs rm -f
		</pre><p>避免上述情况可以在crontab 中加入 &gt;/dev/null 2&gt;&amp;1</p><pre class="screen">
		
# crontab -l
* */2 * * * /usr/local/apache/bin/apachectl restart &gt;/dev/null 2&gt;&amp;1
		
		</pre></div><div class="section" title="1.7. NFS"><div class="titlepage"><div><div><h3 class="title"><a id="id1244315"></a>1.7. NFS</h3></div></div></div><p>Images</p><pre class="screen">
/images            172.16.1.0/24(rw,sync,fsid=0,anonuid=99,anongid=99)
/images/2008     *(rw,sync)
/images/2009     *(rw,nohide,sync)
/images/2010	 *(rw,nohide,sync)
		</pre><pre class="screen">
chkconfig portmap on
chkconfig nfs on
chkconfig nfslock on	
chkconfig rpcidmapd on

service portmap start
service rpcidmapd start
service nfs start
service nfslock start
		</pre></div><div class="section" title="1.8. 释放内存"><div class="titlepage"><div><div><h3 class="title"><a id="id1244333"></a>1.8. 释放内存</h3></div></div></div><pre class="screen">
sync
echo 3 &gt; /proc/sys/vm/drop_caches 

名称 : sync 
使用权限 : 系统管理者 
使用方式 : sync 
说明 : Linux 系统中欲写入硬盘的资料有的时候会了效率起见，会写到 filesystem buffer 中，这个 buffer 是一块记忆体空间，如果欲写入硬盘的资料存于此 buffer 中，而系统又突然断电的话，那么资料就会流失了，sync 指令会将存于 buffer 中的资料强制写入硬盘中。  

To free pagecache: echo 1 &gt; /proc/sys/vm/drop_caches 
To free dentries and inodes: echo 2 &gt; /proc/sys/vm/drop_caches 
To free pagecache, dentries and inodes: echo 3 &gt; /proc/sys/vm/drop_caches		
		</pre></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch07s02.html">上一页</a> </td><td width="20%" align="center"><a accesskey="u" href="idc.html">上一级</a></td><td width="40%" align="right"> <a accesskey="n" href="ntpd.html">下一页</a></td></tr><tr><td width="40%" align="left" valign="top">2. 接入线路测试 </td><td width="20%" align="center"><a accesskey="h" href="../index.html">起始页</a></td><td width="40%" align="right" valign="top"> 2. NTPD</td></tr></table></div></body></html>
