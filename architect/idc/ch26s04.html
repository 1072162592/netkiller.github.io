<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>4. nrpe</title><link rel="stylesheet" href="/docbook.css" type="text/css" /><meta name="generator" content="DocBook XSL Stylesheets V1.75.2" /><link rel="home" href="../index.html" title="Netkiller Web Architect 手札" /><link rel="up" href="ch26.html" title="第 26 章 服务器快速安装与部署" /><link rel="prev" href="snmp.html" title="3. snmp" /><link rel="next" href="ch26s05.html" title="5. vsftpd" /></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">4. nrpe</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="snmp.html">上一页</a> </td><th width="60%" align="center">第 26 章 服务器快速安装与部署</th><td width="20%" align="right"> <a accesskey="n" href="ch26s05.html">下一页</a></td></tr></table><hr /></div><div class="section" title="4. nrpe"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id1295730"></a>4. nrpe</h2></div></div></div><pre class="screen">
	
rpm -Uvh http://download.fedora.redhat.com/pub/epel/5/x86_64/epel-release-5-4.noarch.rpm	
yum install nrpe -y
yum install -y nagios-plugins-disk nagios-plugins-load nagios-plugins-ping nagios-plugins-procs nagios-plugins-swap nagios-plugins-users

chkconfig nrpe on

vim /etc/nagios/nrpe.cfg &lt;&lt;VIM &gt; /dev/null 2&gt;&amp;1
:79,79s/allowed_hosts=127.0.0.1/allowed_hosts=172.16.1.2/
:wq
VIM

cat &gt;&gt; /etc/nagios/nrpe.cfg &lt;&lt;EOF

#command[check_http]=/usr/lib64/nagios/plugins/check_http -I 127.0.0.1 -p 80 -u http://www.example.com/index.html
command[check_swap]=/usr/lib64/nagios/plugins/check_swap -w 20% -c 10%
command[check_all_disks]=/usr/lib64/nagios/plugins/check_disk -w 20% -c 10% -e
EOF

service nrpe start
    
	</pre><p>NAGIOS3 Template</p><pre class="screen">
define host{

        use             generic-host

        host_name       www.example.com

        alias           www.example.com

        address         172.16.1.5

        hostgroups      mysql-servers

        }
define service{

        use                     generic-service ; Inherit values from a template

        host_name               www.example.com ; The name of the host the service is associated with

        service_description     PING            ; The service description

        check_command           check_ping!200.0,20%!600.0,60%  ; The command used to monitor the service

        normal_check_interval   5       ; Check the service every 5 minutes under normal conditions

        retry_check_interval    1       ; Re-check the service every minute until its final/hard state is determined

        }

define service{

        use             generic-service

        host_name               www.example.com

        service_description     MySQL

        check_command   check_mysql_database!monitor!xmNhjDCjfYHjcSG!test

        }


# NRPE disk check.
define service {
        use                             generic-service
        host_name                       www.example.com
        service_description             nrpe-disk
        check_command                   check_nrpe_1arg!check_all_disks
}
define service {
        use                             generic-service
        host_name                       www.example.com
        service_description             nrpe-users
        check_command                   check_nrpe_1arg!check_users
}
define service {
        use                             generic-service
        host_name                       www.example.com
        service_description             nrpe-swap
        check_command                   check_nrpe_1arg!check_swap
}
;define service {
;        use                             generic-service
;        host_name                       www.example.com
;        service_description             nrpe-procs
;        check_command                   check_nrpe_1arg!check_total_procs
;}
define service {
        use                             generic-service
        host_name                       www.example.com
        service_description             nrpe-load
        check_command                   check_nrpe_1arg!check_load
}
define service {
        use                             generic-service
        host_name                       www.example.com
        service_description             nrpe-zombie_procs
        check_command                   check_nrpe_1arg!check_zombie_procs
}
	
	</pre></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="snmp.html">上一页</a> </td><td width="20%" align="center"><a accesskey="u" href="ch26.html">上一级</a></td><td width="40%" align="right"> <a accesskey="n" href="ch26s05.html">下一页</a></td></tr><tr><td width="40%" align="left" valign="top">3. snmp </td><td width="20%" align="center"><a accesskey="h" href="../index.html">起始页</a></td><td width="40%" align="right" valign="top"> 5. vsftpd</td></tr></table></div></body></html>
