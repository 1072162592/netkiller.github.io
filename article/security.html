<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Linux 系统与数据库安全</title><link rel="stylesheet" href="article.css" type="text/css" /><meta name="generator" content="DocBook XSL Stylesheets V1.75.2" /><meta name="description" content="Linux 系统安全问题" /><meta name="keywords" content="linux, mysql, security" /></head><body><div xml:lang="zh-cn" class="article" title="Linux 系统与数据库安全" lang="zh-cn"><div class="titlepage"><div><div><h2 class="title"><a id="idp3552"></a>Linux 系统与数据库安全</h2></div><div><div class="author"><h3 class="author"><span class="honorific">Mr</span>. <span class="firstname">Neo Chen</span> <span class="surname">(netkiller)</span>, <span class="lineage">陈景峰(BG7NYT)</span></h3><div class="affiliation"><div class="address"><p><br />
				<code class="email">&lt;<a class="email" href="mailto:openunix@163.com">openunix@163.com</a>&gt;</code><br />
			</p></div></div></div></div><div><p class="copyright">版权 © 2011, 2012 http://netkiller.github.com</p></div><div><div class="abstract" title="摘要"><p class="title"><b>摘要</b></p><p>Linux 系统安全问题</p></div></div><div><div class="abstract" title="下面是我多年积累下来的经验总结，整理成文档供大家参考:"><a id="abstract"></a><p class="title"><b>下面是我多年积累下来的经验总结，整理成文档供大家参考:</b></p><p>
		</p><table border="0" summary="Simple list" class="simplelist"><tr><td>
				<a class="ulink" href="../architect/index.html" target="_top">Netkiller Architect 手札</a>
			</td><td>
				<a class="ulink" href="../linux/index.html" target="_top">Netkiller Linux 手札</a>
			</td><td>
				<a class="ulink" href="../developer/index.html" target="_top">Netkiller Developer 手札</a>
			</td><td>
				<a class="ulink" href="../database/index.html" target="_top">Netkiller Database 手札</a>
			</td></tr><tr><td>
				<a class="ulink" href="../debian/index.html" target="_top">Netkiller Debian 手札</a>
			</td><td>
				<a class="ulink" href="../centos/index.html" target="_top">Netkiller CentOS 手札</a>
			</td><td>
				<a class="ulink" href="../freebsd/index.html" target="_top">Netkiller FreeBSD 手札</a>
			</td><td>
				<a class="ulink" href="../shell/index.html" target="_top">Netkiller Shell 手札</a>
			</td></tr><tr><td>
				<a class="ulink" href="../www/index.html" target="_top">Netkiller Web 手札</a>
			</td><td>
				<a class="ulink" href="../monitoring/index.html" target="_top">Netkiller Monitoring 手札</a>
			</td><td>
				<a class="ulink" href="../storage/index.html" target="_top">Netkiller Storage 手札</a>
			</td><td>
				<a class="ulink" href="../mail/index.html" target="_top">Netkiller Mail 手札</a>
			</td></tr><tr><td>
				<a class="ulink" href="../security/index.html" target="_top">Netkiller Security 手札</a>
			</td><td>
				<a class="ulink" href="../multimedia/index.html" target="_top">Netkiller Multimedia 手札</a>
			</td><td>
				<a class="ulink" href="../docbook/index.html" target="_top">Netkiller Writer 手札</a>
			</td><td>
				<a class="ulink" href="../version/index.html" target="_top">Netkiller Version 手札</a>
			</td></tr><tr><td>
				<a class="ulink" href="../postgres/index.html" target="_top">Netkiller PostgreSQL 手札</a>
			</td><td>
				<a class="ulink" href="../mysql/index.html" target="_top">Netkiller MySQL 手札</a>
			</td><td>
				<a class="ulink" href="../cryptography/index.html" target="_top">Netkiller Cryptography 手札</a>
			</td><td>
				<a class="ulink" href="../cisco/index.html" target="_top">Netkiller Cisco IOS 手札</a>
			</td></tr><tr><td>
				<a class="ulink" href="../ldap/index.html" target="_top">Netkiller LDAP 手札</a>
			</td><td>
				<a class="ulink" href="../intranet/index.html" target="_top">Netkiller Intranet 手札</a>
			</td><td> </td><td> </td></tr></table><p>
	</p></div></div></div><hr /></div><div class="toc"><p><b>目录</b></p><dl><dt><span class="section"><a href="#idp52384">1. 帐号安全</a></span></dt><dd><dl><dt><span class="section"><a href="#idp53744">1.1. Shell 安全</a></span></dt><dt><span class="section"><a href="#idp54000">1.2. .history 文件</a></span></dt></dl></dd><dt><span class="section"><a href="#idp81344">2. 数据库安全</a></span></dt><dd><dl><dt><span class="section"><a href="#idp87168">2.1. 数据库客户端安全</a></span></dt><dd><dl><dt><span class="section"><a href="#idp88512">2.1.1. mysql 管理</a></span></dt><dt><span class="section"><a href="#idp88768">2.1.2. ~/.mysql_history</a></span></dt></dl></dd><dt><span class="section"><a href="#idp107968">2.2. mysqldump 安全</a></span></dt><dd><dl><dt><span class="section"><a href="#idp108608">2.2.1. 数据备份</a></span></dt><dt><span class="section"><a href="#idp116048">2.2.2. 数据恢复</a></span></dt></dl></dd><dt><span class="section"><a href="#idp123776">2.3. 数据库归档文件</a></span></dt><dt><span class="section"><a href="#idp129200">2.4. 开发与测试环境的数据库安全问题</a></span></dt></dl></dd><dt><span class="section"><a href="#idp134896">3. 其他安全问题</a></span></dt><dd><dl><dt><span class="section"><a href="#idp135536">3.1. 与数据库有关的服务器安全问题</a></span></dt></dl></dd></dl></div><div class="section" title="1. 帐号安全"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="idp52384"></a>1. 帐号安全</h2></div></div></div><p>帐号权限安全</p><div class="section" title="1.1. Shell 安全"><div class="titlepage"><div><div><h3 class="title"><a id="idp53744"></a>1.1. Shell 安全</h3></div></div></div><p>需求：限制用户权限,仅提供一些linux常用命令，用户监控linux系统于网络运行情况，不允许用户ssh登录后随意运行linux命令</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>用户不能进入到Shell环境</p><p>例如普通用户一旦登录web服务器可以看到web程序中的数据库配置</p></li><li class="listitem"><p>用户可以了解OS工作状态如内存,cpu,网络等等</p><p>例如：ping, tracepath, top, free, netstat</p></li><li class="listitem"><p>可以查看系统部分日志</p><p>例如：access.log, error.log, php-error.log ...</p></li></ol></div><p>使用mgmt替代bash</p><pre class="screen">
			
#!/bin/bash
TITLE="Client"

#USER=$(whiptail --inputbox "User:" 8 60 --title "$TITLE" 3&gt;&amp;1 1&gt;&amp;2 2&gt;&amp;3)

#PASSWD=$(whiptail --title "$TITLE" --passwordbox "Passsword:" 8 60 3&gt;&amp;1 1&gt;&amp;2 2&gt;&amp;3)

COMMAND=$(whiptail --title "$TITLE" --menu "Administrator Tools" 22 50 10 \
"ping" "ping" \
"tracepath" "tracepath" \
"top" "top" \
"free" "free"  \
"ps" "ps"  \
"netstat" "netstat"  \
"lsof" "lsof"  \
"iftop" "iftop"  \
"log" "log" \
3&gt;&amp;1 1&gt;&amp;2 2&gt;&amp;3)

function option(){
OPTION=$(whiptail --inputbox "COMMAND-LINE Options: " 8 60 --title "$TITLE" 3&gt;&amp;1 1&gt;&amp;2 2&gt;&amp;3)
}

function weblog(){
LOG=$(whiptail --title "$TITLE" --menu "Logs" 22 50 8 \
"/var/log/messages" "message"  \
"/var/log/syslog" "syslog"  \
"/var/log/nginx/access.log" "access.log" \
"/var/log/nginx/error.log" "error.log"  \
3&gt;&amp;1 1&gt;&amp;2 2&gt;&amp;3)

}

case $COMMAND in
ping)
    option	
    $COMMAND $OPTION
    ;;
tracepath)
    option
    $COMMAND $OPTION
    ;;
free)
    $COMMAND -m
    read
    ;;
top|iftop)
    $COMMAND
    ;;
log)
    weblog
    tail -f $LOG	
    ;;
ps|lsof)
    option
    $COMMAND $OPTION
    read
    ;;
netstat)
    option
    $COMMAND $OPTION
    read
    ;;
*)
    exit $?
esac

			
			</pre><p>Shell 启动文件，主要用户隐藏 /srv/sbin/mgmt 文件（针对菜鸟）</p><pre class="screen">		
			
$ cat shell.c
#include &lt;stdlib.h&gt;
main()
{
	for (;;){
		system("/srv/sbin/mgmt");
	}
}
				
			</pre><p>编译.c文件</p><pre class="screen">
gcc shell.c -o /bin/nsh
			</pre><p>添加Shell到/etc/shells</p><pre class="screen">		
echo /bin/nsh &gt;&gt; /etc/shells
			</pre><p>将用户shell更改为我们刚刚创建的nsh</p><pre class="screen">
$ vim /etc/passwd

www:x:33:33:www:/var/www:/bin/nsh
 			</pre><p>现在来作一个测试,如果正确应该现在为下面的TUI界面 </p><pre class="screen">
			
ssh www@example.com

              ┌───────────────────┤ Client ├───────────────────┐               
              │ Administrator Tools                            │               
              │                                                │               
              │               ping      ping                   │               
              │               tracepath tracepath              │               
              │               top       top                    │               
              │               free      free                   │               
              │               ps        ps                     │               
              │               netstat   netstat                │               
              │               lsof      lsof                   │               
              │               iftop     iftop                  │               
              │               log       log                    │               
              │                                                │               
              │                                                │               
              │           &lt;Ok&gt;               &lt;Cancel&gt;          │               
              │                                                │               
              └────────────────────────────────────────────────┘        
			
			</pre><div class="tip" title="提示" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">提示</h3><p>这里采用的方式是给用户提供一个界面的方式，另外还有更好的方案,你可以些一个Shell的外壳，你需要实现</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>与Shell相同的提示符</p></li><li class="listitem"><p>提供TAB补齐</p></li><li class="listitem"><p>上下光标键翻看历史命令，左右光标改变位置，Home/End 键到行首与行尾</p></li><li class="listitem"><p>Ctrl+R 搜索， Ctrl+D 退出</p></li><li class="listitem"><p>Ctrl+S,Ctrl+Q 等等</p></li></ol></div><p>流程</p><pre class="screen">		
用户输入 -&gt; 关键字过滤 -&gt; 放行
				</pre><p>例如用户输入 cd / 经过过滤器后， cd /home/usr/</p><p>例如用户输入 cd /aaa 经过过滤器后， cd /home/usr/aaa</p><p>rm -rf /usr/local 提示拒绝等等</p><p>我已经使用python实现上面的大部分功能（因为python受到很多限制）如果使用C可以100%实现，需要你的想想力了</p></div></div><div class="section" title="1.2. .history 文件"><div class="titlepage"><div><div><h3 class="title"><a id="idp54000"></a>1.2. .history 文件</h3></div></div></div><p>SA的操作记录问题</p><p>通过~/.bash_history文件记录系统管理员的操作记录，定制.bash_history格式</p><pre class="screen">
HISTSIZE=1000
HISTFILESIZE=2000
HISTTIMEFORMAT="%Y-%m-%d-%H:%M:%S "
export HISTTIMEFORMAT
			</pre><p>看看实际效果</p><pre class="screen">
$ history | head
    1  2012-02-27-09:10:45 do-release-upgrade 
    2  2012-02-27-09:10:45 vim /etc/network/interfaces 
    3  2012-02-27-09:10:45 vi /etc/network/interfaces 
    4  2012-02-27-09:10:45 ping www.163.com
			</pre></div></div><div class="section" title="2. 数据库安全"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="idp81344"></a>2. 数据库安全</h2></div></div></div><p>我们以MySQL为例，讲解怎样控制DBA权限。稍加修改即可用于oracle等服务器</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>DBA 没有系统SSH帐号，只有数据库帐号</p></li><li class="listitem"><p>系统管理员只能有SSH系统帐号，没有数据库帐号</p></li><li class="listitem"><p>DBA 可备份数据库，还原数据库指定的备份文件，但是接触不到备份文件</p></li><li class="listitem"><p>DBA 有权重启数据库以及修复损坏库/表文件，通过工具完成，而不是登录SSH运行命令</p></li></ol></div><div class="section" title="2.1. 数据库客户端安全"><div class="titlepage"><div><div><h3 class="title"><a id="idp87168"></a>2.1. 数据库客户端安全</h3></div></div></div><p>DBA不需要通过SSH登录数据库服务器，然后运行mysql/sqlplus在登录数据库</p><div class="section" title="2.1.1. mysql 管理"><div class="titlepage"><div><div><h4 class="title"><a id="idp88512"></a>2.1.1. mysql 管理</h4></div></div></div><pre class="screen">
				
$ cat ../database/mysqltui
#!/bin/bash
TITLE="MySQL Client"

HOST=$(whiptail --title "$TITLE" --menu "MySQL Host" 22 50 8 \
"127.0.0.1" "localhost" \
"172.16.0.1" "MySQL Master" \
"172.16.0.2" "MySQL Slave 1" \
"172.16.0.3" "MySQL Slave 2"  \
3&gt;&amp;1 1&gt;&amp;2 2&gt;&amp;3)



USER=$(whiptail --inputbox "MySQL User:" 8 60 --title "$TITLE" 3&gt;&amp;1 1&gt;&amp;2 2&gt;&amp;3)

PASSWD=$(whiptail --title "$TITLE" --passwordbox "MySQL Password:" 8 60 3&gt;&amp;1 1&gt;&amp;2 2&gt;&amp;3)

#DATABASE=$(mysqlshow -h$HOST -u$USER | egrep -o "|\w(.*)\w|" | grep -v "Databases" |awk '{print "\""$1"\" \""$1"\""}')
#DATABASE=$(mysqlshow -h$HOST -u$USER | egrep -o "|\w(.*)\w|" | grep -v "Databases" |awk "{print \"$1\" \"$1\"}")

#DB=$(whiptail --title "$TITLE" --menu "MySQL DATABASE" 22 50 8 $DATABASE  3&gt;&amp;1 1&gt;&amp;2 2&gt;&amp;3)

DATABASE=$(whiptail --inputbox "MySQL Database:" 8 60 --title "$TITLE" 3&gt;&amp;1 1&gt;&amp;2 2&gt;&amp;3)

echo $HOST $USER $PASSWD $DATABASE

mysql -h$HOST -u$USER -p$PASSWD $DATABASE

				
				</pre><p></p><pre class="screen">
				                                 
             ┌───┤ MySQL Adminstrator ├───┐             
             │ Menu                       │             
             │                            │             
             │       1 MySQL Manager      │             
             │       2 MySQL Backup       │             
             │       2 MySQL Restore      │             
             │                            │                       
             │                            │             
             │    &lt;Ok&gt;        &lt;Cancel&gt;    │             
             │                            │             
             └────────────────────────────┘             
				
				</pre><pre class="screen">
				           
        ┌────────┤ MySQL Adminstrator ├────────┐        
        │ Database Host                        │        
        │                                      │        
        │        127.0.0.1  localhost          │        
        │        172.16.0.1 mysql master       │        
        │        172.16.0.2 mysql slave        │        
        │                                      │        
        │       &lt;Ok&gt;           &lt;Cancel&gt;        │        
        │                                      │        
        └──────────────────────────────────────┘  
				
				</pre><p>/etc/php5/fpm/pool.d/www.conf</p><pre class="screen">
				 
        ┌────────┤ MySQL Adminstrator ├────────┐        
        │ User                                 │        
        │                                      │        
        │ root________________________________ │        
        │                                      │        
        │       &lt;Ok&gt;           &lt;Cancel&gt;        │        
        │                                      │        
        └──────────────────────────────────────┘   

        ┌────────┤ MySQL Adminstrator ├────────┐        
        │ Password                             │        
        │                                      │        
        │ ****________________________________ │        
        │                                      │        
        │       &lt;Ok&gt;           &lt;Cancel&gt;        │        
        │                                      │        
        └──────────────────────────────────────┘ 
				
				</pre><p>进入mysql客户端</p><pre class="screen">
				
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 503
Server version: 5.1.58-1ubuntu1 (Ubuntu)

Copyright (c) 2000, 2010, Oracle and/or its affiliates. All rights reserved.
This software comes with ABSOLUTELY NO WARRANTY. This is free software,
and you are welcome to modify and redistribute it under the GPL v2 license

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql&gt; 				
				
				</pre><div class="note" title="安全提示" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">安全提示</h3><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>从安全角度看，你可以去掉输入密码的过程。在终端提示符下输入</p><p>Enter password:</p></li><li class="listitem"><p>还可以写入～/.my.conf文件</p><p>这样ssh mysql@example.com的时候输入第一道密码，然后进入mysql不需要输入密码</p></li><li class="listitem"><p>如果需要输入密码对话到建议删除.bash_history</p><p>rm -rf .bash_history</p><p>ln -s /dev/null .bash_history</p></li></ol></div></div></div><div class="section" title="2.1.2. ~/.mysql_history"><div class="titlepage"><div><div><h4 class="title"><a id="idp88768"></a>2.1.2. ~/.mysql_history</h4></div></div></div><p>通过~/.mysql_history文件记录DBA操作记录</p><p>插入时间点，在~/.bashrc中加入下面命令</p><pre class="screen">
							
cat &gt;&gt; ~/.bashrc &lt;&lt;EODdd
echo `date` &gt;&gt; ~/.mysql_dhistory
EOD
				
				</pre><pre class="screen">
$ tail ~/.bashrc
echo `date` &gt;&gt; ~/.mysql_history
				</pre><p>查看实际效果</p><pre class="screen">
$ tail ~/.mysql_history 
EXPLAIN SELECT * FROM stuff where id=3 \G
EXPLAIN SELECT * FROM stuff where id='3' \G
EXPLAIN SELECT * FROM stuff where id='2' \G
Mon Feb 27 09:15:18 CST 2012
EXPLAIN SELECT * FROM stuff where id='2' and created = '2012-02-01' \G
EXPLAIN SELECT * FROM stuff where id='1' and created = '2012-02-01' \G
EXPLAIN SELECT * FROM stuff where id='3' and created = '2012-02-01' \G
EXPLAIN SELECT * FROM stuff where id='2' and created = '2012-02-01' \G
EXPLAIN SELECT * FROM stuff where id='2' or created = '2012-02-01' \G
EXPLAIN SELECT * FROM stuff where id='2' and created = '2012-02-01' \G
Mon Feb 27 11:48:37 CST 2012
				</pre></div></div><div class="section" title="2.2. mysqldump 安全"><div class="titlepage"><div><div><h3 class="title"><a id="idp107968"></a>2.2. mysqldump 安全</h3></div></div></div><div class="section" title="2.2.1. 数据备份"><div class="titlepage"><div><div><h4 class="title"><a id="idp108608"></a>2.2.1. 数据备份</h4></div></div></div><pre class="screen">
				
MySQL Client                                            
             ┌───┤ MySQL Adminstrator ├───┐             
             │ Menu                       │             
             │                            │             
             │       1 MySQL Manager      │             
             │       2 MySQL Backup       │             
             │       2 MySQL Restore      │             
             │                            │                       
             │                            │             
             │    &lt;Ok&gt;        &lt;Cancel&gt;    │             
             │                            │             
             └────────────────────────────┘             
				
				</pre><pre class="screen">
				
MySQL Client                                            
        ┌────────┤ MySQL Adminstrator ├────────┐        
        │ Database Host                        │        
        │                                      │        
        │        127.0.0.1  localhost          │        
        │        172.16.0.1 mysql master       │        
        │        172.16.0.2 mysql slave        │        
        │                                      │        
        │       &lt;Ok&gt;           &lt;Cancel&gt;        │        
        │                                      │        
        └──────────────────────────────────────┘        
				
				</pre><pre class="screen">
				
                                                        
        ┌────────┤ MySQL Adminstrator ├────────┐        
        │ User                                 │        
        │                                      │        
        │ root________________________________ │        
        │                                      │        
        │       &lt;Ok&gt;           &lt;Cancel&gt;        │        
        │                                      │        
        └──────────────────────────────────────┘   

        ┌────────┤ MySQL Adminstrator ├────────┐        
        │ Password                             │        
        │                                      │        
        │ ****________________________________ │        
        │                                      │        
        │       &lt;Ok&gt;           &lt;Cancel&gt;        │        
        │                                      │        
        └──────────────────────────────────────┘              			
				
				</pre><pre class="screen">
				
                                                        
        ┌────────┤ MySQL Adminstrator ├────────┐        
        │ Backup File Name                     │        
        │                                      │        
        │ 2010-12-12.01:00:00_________________ │        
        │                                      │        
        │       &lt;Ok&gt;           &lt;Cancel&gt;        │        
        │                                      │        
        └──────────────────────────────────────┘        
				
				</pre><pre class="screen">
				
                                                       
        ┌────────┤ MySQL Adminstrator ├────────┐        
        │                                      │        
        │ Backup?                              │        
        │                                      │        
        │                                      │        
        │        &lt;Yes&gt;           &lt;No&gt;          │        
        │                                      │        
        └──────────────────────────────────────┘       			
				
				</pre></div><div class="section" title="2.2.2. 数据恢复"><div class="titlepage"><div><div><h4 class="title"><a id="idp116048"></a>2.2.2. 数据恢复</h4></div></div></div><p></p><pre class="screen">
				
MySQL Client                                            
             ┌───┤ MySQL Adminstrator ├───┐             
             │ Menu                       │             
             │                            │             
             │       1 MySQL Manager      │             
             │       2 MySQL Backup       │             
             │       2 MySQL Restore      │             
             │                            │                       
             │                            │             
             │    &lt;Ok&gt;        &lt;Cancel&gt;    │             
             │                            │             
             └────────────────────────────┘  		
				
				</pre><pre class="screen">
				
        ┌────────┤ MySQL Adminstrator ├────────┐        
        │ Database Host                        │        
        │                                      │        
        │        127.0.0.1  localhost          │        
        │        172.16.0.1 mysql master       │        
        │        172.16.0.2 mysql slave        │        
        │                                      │        
        │       &lt;Ok&gt;           &lt;Cancel&gt;        │        
        │                                      │        
        └──────────────────────────────────────┘ 
				
				</pre><p></p><pre class="screen">
				
        ┌────────┤ MySQL Adminstrator ├────────┐        
        │ Backup History                       │        
        │                                      │        
        │        1  2010-12-03 03:00:00        │        
        │        2  2012-01-01 02:00:00        │        
        │        3  2012-02-01 02:00:00        │        
        │                                      │        
        │       &lt;Ok&gt;           &lt;Cancel&gt;        │        
        │                                      │        
        └──────────────────────────────────────┘ 
				
				</pre><pre class="screen">
				
        ┌────────┤ MySQL Adminstrator ├────────┐        
        │ User                                 │        
        │                                      │        
        │ root________________________________ │        
        │                                      │        
        │       &lt;Ok&gt;           &lt;Cancel&gt;        │        
        │                                      │        
        └──────────────────────────────────────┘  
                                                        
        ┌────────┤ MySQL Adminstrator ├────────┐        
        │ Password                             │        
        │                                      │        
        │ ****________________________________ │        
        │                                      │        
        │       &lt;Ok&gt;           &lt;Cancel&gt;        │        
        │                                      │        
        └──────────────────────────────────────┘                                  			
				
				</pre><pre class="screen">
				
        ┌────────┤ MySQL Adminstrator ├────────┐        
        │                                      │        
        │ Restore?                             │        
        │                                      │        
        │                                      │        
        │        &lt;Yes&gt;           &lt;No&gt;          │        
        │                                      │        
        └──────────────────────────────────────┘  
				
				</pre></div></div><div class="section" title="2.3. 数据库归档文件"><div class="titlepage"><div><div><h3 class="title"><a id="idp123776"></a>2.3. 数据库归档文件</h3></div></div></div><p>一般数据库服务器上可以保留一周的备份数据，历史数据需要保存到服务器以外的带库或者阵列柜中，怎么样保证这些数据的安全呢？ 我们采用下面方式</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>制作PGP/GPG密钥，密钥放置在数据库服务器上，证书做好备份，否则一旦丢失，将无法在将备份文件恢复</p></li><li class="listitem"><p>数据库备份后，首先进行压缩处理</p></li><li class="listitem"><p>然后使用公钥证书进行GPG/PGP数据加密</p></li><li class="listitem"><p>这时可以放心的将备份数据库搬出数据库服务器到带库或磁盘阵列柜中</p></li></ol></div><p>恢复数据，将数据库备份文件复制到该数据库服务器，然后用私钥解密备份文件，再恢复到数据库到中</p></div><div class="section" title="2.4. 开发与测试环境的数据库安全问题"><div class="titlepage"><div><div><h3 class="title"><a id="idp129200"></a>2.4. 开发与测试环境的数据库安全问题</h3></div></div></div><p>有时候需要将生产环境的数据复制到开发环境上，例如，测试的时候，重现bug需要真实数据，开发环境的模拟数据无法满足要求，这时需要将生产环境的数据拉到测试或开发环境。如果保证数据的安全非常重要。</p><p>最有效的手段是数据混淆，将重要的数据进行混淆扰乱顺序等等</p><p>扰乱手段有</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
				颠倒顺序
				</li><li class="listitem">
				曾加干扰词
				</li><li class="listitem">
				重置或替换数据，例如密码可以全部改为test (update user set passwd='test')
				</li><li class="listitem">
				拼装数据 如 （131，137，135，133，139，138，168）后面加8位随机数
				</li></ol></div></div></div><div class="section" title="3. 其他安全问题"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="idp134896"></a>3. 其他安全问题</h2></div></div></div><div class="section" title="3.1. 与数据库有关的服务器安全问题"><div class="titlepage"><div><div><h3 class="title"><a id="idp135536"></a>3.1. 与数据库有关的服务器安全问题</h3></div></div></div><p>其他服务器不能安装mysql客户端与mysqldump备份工具</p><pre class="screen">
			
例如：web服务器只能通过php/jdbc/odbc等链接mysql数据库
web服务器卸载 mysql，mysqldump工具，防止用户登录查询以及将数据库远程备份，然后通过web下载数据库
			
			</pre><p>同时封锁22等端口，避免相互跳转</p><pre class="screen">
lokkit --enabled
iptables -F
iptables -A OUTPUT -p tcp -m multiport --dports 22,21,2049 -j REJECT
/etc/init.d/iptables save
iptables -L -n
			</pre><p>web 服务器禁止使用ssh，作为跳板机</p><p></p><pre class="screen">
			

			
			</pre></div></div></div></body></html>
